---
uid: web-api/overview/error-handling/web-api-global-error-handling
title: Globale Fehlerbehandlung in ASP.NET Web-API 2 | Microsoft-Dokumentation
author: davidmatson
description: ''
ms.author: riande
ms.date: 02/03/2014
ms.assetid: bffd7863-f63b-4b23-a13c-372b5492e9fb
msc.legacyurl: /web-api/overview/error-handling/web-api-global-error-handling
msc.type: authoredcontent
ms.openlocfilehash: a52c2a1589327421b7f498ff551145676c80e3e8
ms.sourcegitcommit: 45ac74e400f9f2b7dbded66297730f6f14a4eb25
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/16/2018
ms.locfileid: "41835788"
---
<a name="global-error-handling-in-aspnet-web-api-2"></a><span data-ttu-id="0a3f2-102">Globale Fehlerbehandlung in ASP.NET Web-API 2</span><span class="sxs-lookup"><span data-stu-id="0a3f2-102">Global Error Handling in ASP.NET Web API 2</span></span>
====================
<span data-ttu-id="0a3f2-103">durch [David Matson](https://github.com/davidmatson), [Rick Anderson](https://github.com/Rick-Anderson)</span><span class="sxs-lookup"><span data-stu-id="0a3f2-103">by [David Matson](https://github.com/davidmatson), [Rick Anderson](https://github.com/Rick-Anderson)</span></span>

<span data-ttu-id="0a3f2-104">Heute ist gibt es keine einfache Möglichkeit in Web-API, um zu protokollieren oder Behandeln von Fehlern Global.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-104">Today there's no easy way in Web API to log or handle errors globally.</span></span> <span data-ttu-id="0a3f2-105">Eine nicht behandelten Ausnahmen verarbeitet werden können, über [Ausnahmefilter](exception-handling.md), aber es gibt eine Anzahl von Fällen, in denen Ausnahmefilter nicht verarbeiten können.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-105">Some unhandled exceptions can be processed via [exception filters](exception-handling.md), but there are a number of cases that exception filters can't handle.</span></span> <span data-ttu-id="0a3f2-106">Zum Beispiel:</span><span class="sxs-lookup"><span data-stu-id="0a3f2-106">For example:</span></span>

1. <span data-ttu-id="0a3f2-107">Von controllerkonstruktoren ausgelöste Ausnahmen.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-107">Exceptions thrown from controller constructors.</span></span>
2. <span data-ttu-id="0a3f2-108">Von meldungshandlern ausgelöste Ausnahmen.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-108">Exceptions thrown from message handlers.</span></span>
3. <span data-ttu-id="0a3f2-109">Während des Routings ausgelöste Ausnahmen.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-109">Exceptions thrown during routing.</span></span>
4. <span data-ttu-id="0a3f2-110">Während der Serialisierung von Antwortinhalten ausgelöste Ausnahmen.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-110">Exceptions thrown during response content serialization .</span></span>

<span data-ttu-id="0a3f2-111">Wir bieten eine einfache, konsistente Möglichkeit, sich anzumelden und (sofern möglich) zu behandeln möchten diese Ausnahmen.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-111">We want to provide a simple, consistent way to log and handle (where possible) these exceptions.</span></span> 

<span data-ttu-id="0a3f2-112">Es gibt zwei wichtige Fälle für die Ausnahmebehandlung, der Fall, in dem wir senden eine Fehlerantwort sind und der Fall, in dem alle wir tun können, Log die Ausnahme.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-112">There are two major cases for handling exceptions, the case where we are able to send an error response and the case where all we can do is log the exception.</span></span> <span data-ttu-id="0a3f2-113">Ein Beispiel für letzteren Fall ist, wenn eine Ausnahme ausgelöst wird, in der Mitte der streaming-Inhalts der Antwort. In diesem Fall ist es zu spät, eine neue Antwortnachricht gesendet werden, da er den Statuscode, Header und Teil des Inhalts bereits über das Netzwerk, durchgeführt haben, damit wir einfach die Verbindung abzubrechen.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-113">An example for the latter case is when an exception is thrown in the middle of streaming response content; in that case it is too late to send a new response message since the status code, headers, and partial content have already gone across the wire, so we simply abort the connection.</span></span> <span data-ttu-id="0a3f2-114">Obwohl die Ausnahme kann nicht verarbeitet werden, um eine neue Antwortnachricht zu erzeugen, unterstützen wir weiterhin Protokollierung der Ausnahme.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-114">Even though the exception can't be handled to produce a new response message, we still support logging the exception.</span></span> <span data-ttu-id="0a3f2-115">In Fällen, in denen einen Fehler erkannt werden können, können wir eine entsprechende Fehlerantwort zurückgeben, wie im folgenden dargestellt:</span><span class="sxs-lookup"><span data-stu-id="0a3f2-115">In cases where we can detect an error, we can return an appropriate error response as shown in the following:</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample1.cs?highlight=6)]

### <a name="existing-options"></a><span data-ttu-id="0a3f2-116">Vorhandene Optionen</span><span class="sxs-lookup"><span data-stu-id="0a3f2-116">Existing Options</span></span>

<span data-ttu-id="0a3f2-117">Zusätzlich zu [Ausnahmefilter](exception-handling.md), [message-Handler](../advanced/http-message-handlers.md) kann heute verwendet werden, um alle auf 500-Antworten zu beobachten, aber auf diese Antworten ist schwierig, da ihnen Kontextdaten zu der ursprüngliche Fehler fehlt.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-117">In addition to [exception filters](exception-handling.md), [message handlers](../advanced/http-message-handlers.md) can be used today to observe all 500-level responses, but acting on those responses is difficult, as they lack context about the original error.</span></span> <span data-ttu-id="0a3f2-118">Meldungshandler haben auch einige der dieselben Einschränkungen wie die Ausnahmefilter in Bezug auf die Fälle, die sie behandeln können. Während der Web-API-Ablaufverfolgungsinfrastruktur verfügen, die möglichen Fehlerzustände erfasst ist die Infrastruktur für ereignisablaufverfolgung wird zu Diagnosezwecken und nicht entwickelt und für die Ausführung in produktionsumgebungen.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-118">Message handlers also have some of the same limitations as exception filters regarding the cases they can handle.While Web API does have tracing infrastructure that captures error conditions the tracing infrastructure is for diagnostics purposes and is not designed or suited for running in production environments.</span></span> <span data-ttu-id="0a3f2-119">Globalen Ausnahmeklassen Fehlerbehandlung und-Protokollierung muss Dienste, die während der Produktion ausführen können und in bestehende überwachungslösungen angeschlossen werden (z. B. [ELMAH](https://code.google.com/p/elmah/) ).</span><span class="sxs-lookup"><span data-stu-id="0a3f2-119">Global exception handling and logging should be services that can run during production and be plugged into existing monitoring solutions (for example, [ELMAH](https://code.google.com/p/elmah/) ).</span></span>

### <a name="solution-overview"></a><span data-ttu-id="0a3f2-120">Übersicht über die Lösung</span><span class="sxs-lookup"><span data-stu-id="0a3f2-120">Solution Overview</span></span>

 <span data-ttu-id="0a3f2-121">Wir bieten zwei neue Benutzer vor Ort austauschbaren Dienste [' iexceptionlogger '](../releases/whats-new-in-aspnet-web-api-21.md) und IExceptionHandler, zu melden und behandeln unbehandelte Ausnahmen.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-121">We provide two new user-replaceable services, [IExceptionLogger](../releases/whats-new-in-aspnet-web-api-21.md) and IExceptionHandler, to log and handle unhandled exceptions.</span></span> <span data-ttu-id="0a3f2-122">Die Dienste sind sehr ähnlich, zwei Hauptunterschiede:</span><span class="sxs-lookup"><span data-stu-id="0a3f2-122">The services are very similar, with two main differences:</span></span>

1. <span data-ttu-id="0a3f2-123">Wir unterstützen die Registrierung der Protokollierungen für mehrere Ausnahmen aber nur einen einzigen Ausnahmehandler.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-123">We support registering multiple exception loggers but only a single exception handler.</span></span>
2. <span data-ttu-id="0a3f2-124">Protokollierungen Ausnahmen erhalten immer aufgerufen, selbst wenn wir sind dabei, die Verbindung abzubrechen.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-124">Exception loggers always get called, even if we're about to abort the connection.</span></span> <span data-ttu-id="0a3f2-125">Ausnahmehandler nur aufgerufen werden, wenn wir weiterhin wählen Sie die Response-Nachricht senden können.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-125">Exception handlers only get called when we're still able to choose which response message to send.</span></span>

<span data-ttu-id="0a3f2-126">Beide Dienste bieten Zugriff auf einen Ausnahmekontext mit relevanten Informationen an der Stelle, wo die Ausnahme erkannt wurde, insbesondere die [HttpRequestMessage](https://msdn.microsoft.com/library/system.net.http.httprequestmessage(v=vs.110).aspx), [HttpRequestContext](https://msdn.microsoft.com/library/system.web.http.controllers.httprequestcontext(v=vs.118).aspx), wird die ausgelöste Ausnahme und die Quelle der Ausnahme (Details unten).</span><span class="sxs-lookup"><span data-stu-id="0a3f2-126">Both services provide access to an exception context containing relevant information from the point where the exception was detected, particularly the [HttpRequestMessage](https://msdn.microsoft.com/library/system.net.http.httprequestmessage(v=vs.110).aspx), the [HttpRequestContext](https://msdn.microsoft.com/library/system.web.http.controllers.httprequestcontext(v=vs.118).aspx), the thrown exception and the exception source (details below).</span></span>

### <a name="design-principles"></a><span data-ttu-id="0a3f2-127">Entwurfsprinzipien</span><span class="sxs-lookup"><span data-stu-id="0a3f2-127">Design Principles</span></span>

1. <span data-ttu-id="0a3f2-128">**Keine aktuellen Änderungen** , da diese Funktion in eine Nebenversion, eine wichtige Einschränkung, die Auswirkungen auf die Lösung ist, die es keine grundlegenden Änderungen, entweder in den Typ der Verträge oder Verhalten hinzugefügt wird.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-128">**No breaking changes** Because this functionality is being added in a minor release, one important constraint impacting the solution is that there be no breaking changes, either to type contracts or to behavior.</span></span> <span data-ttu-id="0a3f2-129">Diese Einschränkung ausgeschlossen wird einige Bereinigungsschritte an, die wir im Hinblick auf vorhandene Catch-Blöcke, die Aktivieren von Ausnahmen in mit 500 Antworten getan haben möchten.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-129">This constraint ruled out some cleanup we would like to have done in terms of existing catch blocks turning exceptions into 500 responses.</span></span> <span data-ttu-id="0a3f2-130">Diese zusätzliche Bereinigung ist etwas, das wir für eine nachfolgende Hauptversion erwägen.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-130">This additional cleanup is something we might consider for a subsequent major release.</span></span> <span data-ttu-id="0a3f2-131">Ist dies wichtig, Sie stimmen Sie dafür auf [ASP.NET Web-API-uservoice](http://aspnet.uservoice.com/forums/147201-asp-net-web-api/suggestions/5451321-add-flag-to-enable-iexceptionlogger-and-iexception).</span><span class="sxs-lookup"><span data-stu-id="0a3f2-131">If this is important to you please vote on it at [ASP.NET Web API user voice](http://aspnet.uservoice.com/forums/147201-asp-net-web-api/suggestions/5451321-add-flag-to-enable-iexceptionlogger-and-iexception).</span></span>
2. <span data-ttu-id="0a3f2-132">**Aufrechterhaltung der Konsistenz mit Web-API erstellt** Filterpipeline Web-API ist eine hervorragende Möglichkeit, querschnittliche Belange mit der Flexibilität der Anwendung der Logik an eine spezifische Aktion, Controller-spezifische oder im globalen Gültigkeitsbereich zu behandeln.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-132">**Maintaining consistency with Web API constructs** Web API's filter pipeline is a great way to handle cross-cutting concerns with the flexibility of applying the logic at an action-specific, controller-specific or global scope.</span></span> <span data-ttu-id="0a3f2-133">Filter, einschließlich der Ausnahmefilter, haben immer Aktion und Controller-Kontexten, selbst wenn auf den globalen Bereich registriert.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-133">Filters, including exception filters, always have action and controller contexts, even when registered at the global scope.</span></span> <span data-ttu-id="0a3f2-134">Dass der Vertrag ist sinnvoll für Filter, aber dies bedeutet, dass die Ausnahmefilter auch global bereichsbezogenen werden, eine gute Wahl für eine Ausnahme, die Behandlung von Fällen, z. B. Ausnahmen von meldungshandlern, wenn kein Kontext Aktions- oder Controllerebene sind nicht vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-134">That contract makes sense for filters, but it means that exception filters, even globally scoped ones, aren't a good fit for some exception handling cases, such as exceptions from message handlers, where no action or controller context exists.</span></span> <span data-ttu-id="0a3f2-135">Wenn wir verwenden die verfügbaren Filter für die Ausnahmebehandlung flexible Bereichsdefinition möchten, benötigen wir weiterhin Ausnahmefilter.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-135">If we want to use the flexible scoping afforded by filters for exception handling, we still need exception filters.</span></span> <span data-ttu-id="0a3f2-136">Aber wenn wir Ausnahme außerhalb einer Controllerkontext behandeln müssen, wir benötigen auch ein separates Konstrukt für vollständigen globalen Fehlerbehandlung (etwas ohne den Controller und das Aktionsergebnis Kontext Einschränkungen).</span><span class="sxs-lookup"><span data-stu-id="0a3f2-136">But if we need to handle exception outside of a controller context, we also need a separate construct for full global error handling (something without the controller context and action context constraints).</span></span>

### <a name="when-to-use"></a><span data-ttu-id="0a3f2-137">Verwendung</span><span class="sxs-lookup"><span data-stu-id="0a3f2-137">When to Use</span></span>

- <span data-ttu-id="0a3f2-138">Protokollierungen Ausnahmen sind die Lösung für alle nicht behandelten Ausnahme von Web-API angezeigt.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-138">Exception loggers are the solution to seeing all unhandled exception caught by Web API.</span></span>
- <span data-ttu-id="0a3f2-139">Ausnahmehandler sind die Lösung für alle möglichen Antworten auf nicht behandelte Ausnahmen abgefangen, die von Web-API anpassen.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-139">Exception handlers are the solution for customizing all possible responses to unhandled exceptions caught by Web API.</span></span>
- <span data-ttu-id="0a3f2-140">Ausnahmefilter sind die einfachste Lösung für die Verarbeitung der Teilmenge, die nicht behandelte Ausnahmen im Zusammenhang mit der eine bestimmte Aktion oder einen Controller.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-140">Exception filters are the easiest solution for processing the subset unhandled exceptions related to a specific action or controller.</span></span>

### <a name="service-details"></a><span data-ttu-id="0a3f2-141">Dienstdetails</span><span class="sxs-lookup"><span data-stu-id="0a3f2-141">Service Details</span></span>

 <span data-ttu-id="0a3f2-142">Die Ausnahme Protokollierung und -Handler die Dienstschnittstellen sind einfache Async-Methoden, die die jeweiligen Kontexte dauert:</span><span class="sxs-lookup"><span data-stu-id="0a3f2-142">The exception logger and handler service interfaces are simple async methods taking the respective contexts:</span></span> 

[!code-csharp[Main](web-api-global-error-handling/samples/sample2.cs)]

 <span data-ttu-id="0a3f2-143">Wir bieten auch die Basisklassen für diese beiden Schnittstellen.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-143">We also provide base classes for both of these interfaces.</span></span> <span data-ttu-id="0a3f2-144">Überschreiben der Methoden Core, (synchron oder asynchron), ist alles, was erforderlich ist, um zu protokollieren oder verarbeiten, auf die empfohlene Häufigkeit.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-144">Overriding the core (sync or async) methods is all that is required to log or handle at the recommended times.</span></span> <span data-ttu-id="0a3f2-145">Für die Protokollierung der `ExceptionLogger` Basisklasse wird sichergestellt, dass die zentrale Protokollierung-Methode nur einmal für jede Ausnahme aufgerufen wird (selbst wenn Sie es später noch Mal verteilt weiter die Aufrufliste nach oben und erneut erfasst).</span><span class="sxs-lookup"><span data-stu-id="0a3f2-145">For logging, the `ExceptionLogger` base class will ensure that the core logging method is only called once for each exception (even if it later propagates further up the call stack and is caught again).</span></span> <span data-ttu-id="0a3f2-146">Die `ExceptionHandler` Basisklasse aufrufen, werden die wichtigsten Behandlung Methode nur Ausnahmen am Anfang der Aufrufliste, ignoriert der Vorgängerversion, die geschachtelte catch-Blocks.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-146">The `ExceptionHandler` base class will call the core handling method only for exceptions at the top of the call stack, ignoring legacy nested catch blocks.</span></span> <span data-ttu-id="0a3f2-147">(Vereinfachte Versionen von diesen Basisklassen finden Sie im Anhang unten.) Beide `IExceptionLogger` und `IExceptionHandler` erhalten Sie Informationen zur Ausnahme über einen `ExceptionContext`.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-147">(Simplified versions of these base classes are in the appendix below.) Both `IExceptionLogger` and `IExceptionHandler` receive information about the exception via an `ExceptionContext`.</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample3.cs)]

<span data-ttu-id="0a3f2-148">Wenn das Framework eine ausnahmeprotokollierung oder einen Ausnahmehandler aufgerufen wird, geben sie immer eine `Exception` und `Request`.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-148">When the framework calls an exception logger or an exception handler, it will always provide an `Exception` and a `Request`.</span></span> <span data-ttu-id="0a3f2-149">Hier sind auch immer bereitgestellt, mit Ausnahme der Komponententests eine `RequestContext`.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-149">Except for unit testing, it will also always provide a `RequestContext`.</span></span> <span data-ttu-id="0a3f2-150">Sie erhalten nur selten eine `ControllerContext` und `ActionContext` (nur, wenn die vom Catch-Block für Ausnahmefilter aufgerufen wird).</span><span class="sxs-lookup"><span data-stu-id="0a3f2-150">It will rarely provide a `ControllerContext` and `ActionContext` (only when calling from the catch block for exception filters).</span></span> <span data-ttu-id="0a3f2-151">Sie erhalten nur sehr selten eine `Response`(nur in bestimmten IIS-Fällen, wenn in der Mitte beim Schreiben der Antwort).</span><span class="sxs-lookup"><span data-stu-id="0a3f2-151">It will very rarely provide a `Response`(only in certain IIS cases when in the middle of trying to write the response).</span></span> <span data-ttu-id="0a3f2-152">Beachten Sie, dass einige dieser Eigenschaften möglicherweise `null` es obliegt der Consumer zu suchende `null` vor dem Zugriff auf Mitglieder der Exception-Klasse.`CatchBlock`</span><span class="sxs-lookup"><span data-stu-id="0a3f2-152">Note that because some of these properties may be `null` it is up to the consumer to check for `null` before accessing members of the exception class.`CatchBlock`</span></span> <span data-ttu-id="0a3f2-153">ist eine Zeichenfolge, der angibt, welche Catch-Block die Ausnahme gesehen haben.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-153">is a string indicating which catch block saw the exception.</span></span> <span data-ttu-id="0a3f2-154">Die Catch-Block Zeichenfolgen lauten wie folgt aus:</span><span class="sxs-lookup"><span data-stu-id="0a3f2-154">The catch block strings are as follows:</span></span>

- <span data-ttu-id="0a3f2-155">HttpServer (SendAsync-Methode)</span><span class="sxs-lookup"><span data-stu-id="0a3f2-155">HttpServer (SendAsync method)</span></span>
- <span data-ttu-id="0a3f2-156">HttpControllerDispatcher (SendAsync-Methode)</span><span class="sxs-lookup"><span data-stu-id="0a3f2-156">HttpControllerDispatcher (SendAsync method)</span></span>
- <span data-ttu-id="0a3f2-157">HttpBatchHandler (SendAsync-Methode)</span><span class="sxs-lookup"><span data-stu-id="0a3f2-157">HttpBatchHandler (SendAsync method)</span></span>
- <span data-ttu-id="0a3f2-158">Iexceptionfilter (des "ApiController" Verarbeitung der Ausnahme Filterpipeline in ExecuteAsync).</span><span class="sxs-lookup"><span data-stu-id="0a3f2-158">IExceptionFilter (ApiController's processing of the exception filter pipeline in ExecuteAsync)</span></span>
- <span data-ttu-id="0a3f2-159">OWIN-Host:</span><span class="sxs-lookup"><span data-stu-id="0a3f2-159">OWIN host:</span></span>

    - <span data-ttu-id="0a3f2-160">HttpMessageHandlerAdapter.BufferResponseContentAsync (for buffering output)</span><span class="sxs-lookup"><span data-stu-id="0a3f2-160">HttpMessageHandlerAdapter.BufferResponseContentAsync (for buffering output)</span></span>
    - <span data-ttu-id="0a3f2-161">HttpMessageHandlerAdapter.CopyResponseContentAsync (for streaming output)</span><span class="sxs-lookup"><span data-stu-id="0a3f2-161">HttpMessageHandlerAdapter.CopyResponseContentAsync (for streaming output)</span></span>
- <span data-ttu-id="0a3f2-162">Web-Host:</span><span class="sxs-lookup"><span data-stu-id="0a3f2-162">Web host:</span></span>

    - <span data-ttu-id="0a3f2-163">HttpControllerHandler.WriteBufferedResponseContentAsync (for buffering output)</span><span class="sxs-lookup"><span data-stu-id="0a3f2-163">HttpControllerHandler.WriteBufferedResponseContentAsync (for buffering output)</span></span>
    - <span data-ttu-id="0a3f2-164">HttpControllerHandler.WriteStreamedResponseContentAsync (für streaming-Ausgabe)</span><span class="sxs-lookup"><span data-stu-id="0a3f2-164">HttpControllerHandler.WriteStreamedResponseContentAsync (for streaming output)</span></span>
    - <span data-ttu-id="0a3f2-165">HttpControllerHandler.WriteErrorResponseContentAsync (für Fehler in der Fehlerbehebung im Modus für gepufferte Ausgabe)</span><span class="sxs-lookup"><span data-stu-id="0a3f2-165">HttpControllerHandler.WriteErrorResponseContentAsync (for failures in error recovery under buffered output mode)</span></span>

<span data-ttu-id="0a3f2-166">Die Liste der Zeichenfolgen der Catch-Block ist auch über statische, schreibgeschützte Eigenschaften verfügbar.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-166">The list of catch block strings is also available via static readonly properties.</span></span> <span data-ttu-id="0a3f2-167">(Die Core-Catch-Block Zeichenfolge befinden sich auf die statische ExceptionCatchBlocks; im weiteren Verlauf angezeigt werden, auf eine statische Klasse jedes für OWIN und Web-Host).`IsTopLevelCatchBlock`</span><span class="sxs-lookup"><span data-stu-id="0a3f2-167">(The core catch block string are on the static ExceptionCatchBlocks; the remainder appear on one static class each for OWIN and web host).`IsTopLevelCatchBlock`</span></span> <span data-ttu-id="0a3f2-168">ist hilfreich für die folgenden des empfohlenen Musters der Ausnahmebehandlung nur am Anfang der Aufrufliste.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-168">is helpful for following the recommended pattern of handling exceptions only at the top of the call stack.</span></span> <span data-ttu-id="0a3f2-169">Anstatt Ausnahmen in 500-Antworten an jeder Stelle, die ein geschachtelten Catch-Block auftritt, können ein Ausnahmehandler Ausnahmen weitergegeben werden, bis sie sind im Begriff, die vom Host angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-169">Rather than turning exceptions into 500 responses anywhere a nested catch block occurs, an exception handler can let exceptions propagate until they are about to be seen by the host.</span></span>

<span data-ttu-id="0a3f2-170">Zusätzlich zu den `ExceptionContext`, eine Protokollierung Ruft eine weitere Information über die vollständige `ExceptionLoggerContext`:</span><span class="sxs-lookup"><span data-stu-id="0a3f2-170">In addition to the `ExceptionContext`, a logger gets one more piece of information via the full `ExceptionLoggerContext`:</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample4.cs)]

<span data-ttu-id="0a3f2-171">Die zweite Eigenschaft, `CanBeHandled`, ermöglicht es einem Protokollierungsmodul eine Ausnahme zu ermitteln, die nicht behandelt werden kann.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-171">The second property, `CanBeHandled`, allows a logger to identify an exception that cannot be handled.</span></span> <span data-ttu-id="0a3f2-172">Wenn die Verbindung wird abgebrochen wird oder keine neue Antwortnachricht gesendet werden kann, die Protokollierungen werden aufgerufen, aber wird des Handlers ***nicht*** aufgerufen werden, und die Protokollierungen dieses Szenario der von dieser Eigenschaft identifizieren können.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-172">When the connection is about to be aborted and no new response message can be sent, the loggers will be called but the handler will ***not*** be called, and the loggers can identify this scenario from this property.</span></span>

<span data-ttu-id="0a3f2-173">Im weiteren der `ExceptionContext`, ein Handler Ruft eine weitere Eigenschaft sie, auf das vollständige festlegen können `ExceptionHandlerContext` zur Behandlung von Ausnahmen:</span><span class="sxs-lookup"><span data-stu-id="0a3f2-173">In additional to the `ExceptionContext`, a handler gets one more property it can set on the full `ExceptionHandlerContext` to handle the exception:</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample5.cs)]

<span data-ttu-id="0a3f2-174">Ein Ausnahmehandler gibt an, dass es eine Ausnahme, indem behandelt wurde die `Result` Eigenschaft, um ein Aktionsergebnis (z. B. eine [ExceptionResult](https://msdn.microsoft.com/library/system.web.http.results.exceptionresult(v=vs.118).aspx), [InternalServerErrorResult](https://msdn.microsoft.com/library/system.web.http.results.internalservererrorresult(v=vs.118).aspx), [ StatusCodeResult](https://msdn.microsoft.com/library/system.web.http.results.statuscoderesult(v=vs.118).aspx), oder ein benutzerdefiniertes Ergebnis).</span><span class="sxs-lookup"><span data-stu-id="0a3f2-174">An exception handler indicates that it has handled an exception by setting the `Result` property to an action result (for example, an [ExceptionResult](https://msdn.microsoft.com/library/system.web.http.results.exceptionresult(v=vs.118).aspx), [InternalServerErrorResult](https://msdn.microsoft.com/library/system.web.http.results.internalservererrorresult(v=vs.118).aspx), [StatusCodeResult](https://msdn.microsoft.com/library/system.web.http.results.statuscoderesult(v=vs.118).aspx), or a custom result).</span></span> <span data-ttu-id="0a3f2-175">Wenn die `Result` -Eigenschaft ist null, der die Ausnahme nicht behandelt wird und die ursprüngliche Ausnahme erneut ausgelöst werden.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-175">If the `Result` property is null, the exception is unhandled and the original exception will be re-thrown.</span></span>

<span data-ttu-id="0a3f2-176">Für Ausnahmen, die am oberen Rand der Aufrufliste haben wir einen zusätzlichen Schritt, um sicherzustellen, dass die Antwort für API-Aufrufer geeignet ist.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-176">For exceptions at the top of the call stack, we took an extra step to ensure the response is appropriate for API callers.</span></span> <span data-ttu-id="0a3f2-177">Die Ausnahme verteilt, auf dem Host, der Aufrufer sähen die gelbe Bildschirm fehl oder ein anderen Host bereitgestellt wird, in der Regel HTML-Antwort und nicht in der Regel eine entsprechende Antwort der API-Fehler.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-177">If the exception propagates up to the host, the caller would see the yellow screen of death or some other host provided response which is typically HTML and not usually an appropriate API error response.</span></span> <span data-ttu-id="0a3f2-178">In diesen Fällen beginnt der Ergebnis ungleich Null ist, und nur dann, wenn Sie ein benutzerdefinierten Ausnahmehandler explizit festlegt zurück, in `null` (nicht behandelte) wird die Ausnahme weitergeleitet an den Host.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-178">In these cases, the Result starts out non-null, and only if a custom exception handler explicitly sets it back to `null` (unhandled) will the exception propagate to the host.</span></span> <span data-ttu-id="0a3f2-179">Festlegen von `Result` zu `null` in solchen Fällen kann für zwei Szenarien sinnvoll sein:</span><span class="sxs-lookup"><span data-stu-id="0a3f2-179">Setting `Result` to `null` in such cases can be useful for two scenarios:</span></span>

1. <span data-ttu-id="0a3f2-180">OWIN gehosteten Web-API mit benutzerdefinierter Ausnahmebehandlung eine Middleware vor und externen Web-API registriert.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-180">OWIN hosted Web API with custom exception handling middleware registered before/outside Web API.</span></span>
2. <span data-ttu-id="0a3f2-181">Lokales Debuggen über einen Browser, in denen die gelbe Bildschirm fehl tatsächlich eine hilfreiche Antwort für eine nicht behandelte Ausnahme ist.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-181">Local debugging via a browser, where the yellow screen of death is actually a helpful response for an unhandled exception.</span></span>

<span data-ttu-id="0a3f2-182">Für Protokollierungen Ausnahmen und Ausnahmehandler führen wir keine Alles wiederherstellen, wenn die Protokollierung oder der Handler eine Ausnahme auslöst.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-182">For both exception loggers and exception handlers, we don't do anything to recover if the logger or handler itself throws an exception.</span></span> <span data-ttu-id="0a3f2-183">(Als lassen die Ausnahme weitergeben, Feedback unten auf dieser Seite lassen, wenn müssen Sie einen besseren Ansatz.) Der Vertrag für Ausnahme protokollierungund Handler ist darin, dass keine Ausnahmen, die bis zu den Aufrufer weitergegeben werden sollen; Andernfalls wird die Ausnahme weitergeleitet nur, häufig bis hin zu dem Host, der eine HTML-Fehlermeldung angezeigt (z. B. die ASP. NET Gelb-Bildschirm) an den Client (die in der Regel die bevorzugte Option für, die erwarten, JSON oder XML dass-API-Aufrufer ist nicht) gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-183">(Other than letting the exception propagate, leave feedback at the bottom of this page if you have a better approach.) The contract for exception loggers and handlers is that they should not let exceptions propagate up to their callers; otherwise, the exception will just propagate, often all the way to the host resulting in an HTML error (like the ASP.NET's yellow screen) being sent back to the client (which usually isn't the preferred option for API callers that expect JSON or XML).</span></span>

## <a name="examples"></a><span data-ttu-id="0a3f2-184">Beispiele</span><span class="sxs-lookup"><span data-stu-id="0a3f2-184">Examples</span></span>

### <a name="tracing-exception-logger"></a><span data-ttu-id="0a3f2-185">Protokollierung der Ablaufverfolgung-Ausnahmen</span><span class="sxs-lookup"><span data-stu-id="0a3f2-185">Tracing Exception Logger</span></span>

<span data-ttu-id="0a3f2-186">Die folgenden ausnahmeprotokollierung senden Ausnahmedaten an konfigurierte Ablaufverfolgungsquellen (einschließlich der Debug-Ausgabe-Fenster in Visual Studio).</span><span class="sxs-lookup"><span data-stu-id="0a3f2-186">The exception logger below send exception data to configured Trace sources (including the Debug output window in Visual Studio).</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample6.cs)]

### <a name="custom-error-message-exception-handler"></a><span data-ttu-id="0a3f2-187">Benutzerdefinierte Fehler Meldungshandler-Ausnahme</span><span class="sxs-lookup"><span data-stu-id="0a3f2-187">Custom Error Message Exception Handler</span></span>

<span data-ttu-id="0a3f2-188">Die folgenden unten erzeugt eine benutzerdefinierte Fehlerantwort an Clients, einschließlich einer e-Mail-Adresse für Kontaktaufnahme mit dem Support.</span><span class="sxs-lookup"><span data-stu-id="0a3f2-188">The following below produces a custom error response to clients, including an email address for contacting support.</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample7.cs)]

## <a name="registering-exception-filters"></a><span data-ttu-id="0a3f2-189">Ausnahmefilter registrieren</span><span class="sxs-lookup"><span data-stu-id="0a3f2-189">Registering Exception Filters</span></span>

<span data-ttu-id="0a3f2-190">Wenn Sie die Projektvorlage "ASP.NET MVC 4-Webanwendung" verwenden, um Ihr Projekt erstellen, fügen Sie Ihrer Web-API-Konfigurationscode in die `WebApiConfig` -Klasse in der *App/_starten* Ordner:</span><span class="sxs-lookup"><span data-stu-id="0a3f2-190">If you use the "ASP.NET MVC 4 Web Application" project template to create your project, put your Web API configuration code inside the `WebApiConfig` class, in the *App/_Start* folder:</span></span>

[!code-csharp[Main](exception-handling/samples/sample7.cs?highlight=5)]

## <a name="appendix-base-class-details"></a><span data-ttu-id="0a3f2-191">Anhang: Basisklasse Details</span><span class="sxs-lookup"><span data-stu-id="0a3f2-191">Appendix: Base Class Details</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample8.cs)]
