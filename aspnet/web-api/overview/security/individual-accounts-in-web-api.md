---
uid: web-api/overview/security/individual-accounts-in-web-api
title: Schützen eine Web-API mit einzelnen Konten und lokale Anmeldung in ASP.NET-Web-API 2.2 | Microsoft-Dokumentation
author: MikeWasson
description: In diesem Thema wird das Sichern einer Web-API, authentifizieren eine Mitgliedschaftsdatenbank mithilfe von OAuth2 veranschaulicht. Die Softwareversionen, die in den Tutorials Visual Studio 201 verwendet...
ms.author: riande
ms.date: 10/15/2014
ms.assetid: 92c84846-f0ea-4b5e-94b6-5004874eb060
msc.legacyurl: /web-api/overview/security/individual-accounts-in-web-api
msc.type: authoredcontent
ms.openlocfilehash: 01d117260ef458453bee79285a37a8977221998c
ms.sourcegitcommit: 45ac74e400f9f2b7dbded66297730f6f14a4eb25
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/16/2018
ms.locfileid: "41823768"
---
<a name="secure-a-web-api-with-individual-accounts-and-local-login-in-aspnet-web-api-22"></a><span data-ttu-id="245f4-104">Schützen einer Webs-API mit einzelnen Konten und lokale Anmeldung in ASP.NET-Web-API 2.2</span><span class="sxs-lookup"><span data-stu-id="245f4-104">Secure a Web API with Individual Accounts and Local Login in ASP.NET Web API 2.2</span></span>
====================
<span data-ttu-id="245f4-105">durch [Mike Wasson](https://github.com/MikeWasson)</span><span class="sxs-lookup"><span data-stu-id="245f4-105">by [Mike Wasson](https://github.com/MikeWasson)</span></span>

[<span data-ttu-id="245f4-106">Beispiel-App herunter</span><span class="sxs-lookup"><span data-stu-id="245f4-106">Download Sample App</span></span>](https://github.com/MikeWasson/LocalAccountsApp)

> <span data-ttu-id="245f4-107">In diesem Thema wird das Sichern einer Web-API, authentifizieren eine Mitgliedschaftsdatenbank mithilfe von OAuth2 veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="245f4-107">This topic shows how to secure a web API using OAuth2 to authenticate against a membership database.</span></span>
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="245f4-108">Softwareversionen, die in diesem Tutorial verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="245f4-108">Software versions used in the tutorial</span></span>
> 
> 
> - [<span data-ttu-id="245f4-109">Visual Studio 2013 Update 3</span><span class="sxs-lookup"><span data-stu-id="245f4-109">Visual Studio 2013 Update 3</span></span>](https://www.microsoft.com/visualstudio/eng/2013-downloads)
> - [<span data-ttu-id="245f4-110">Web-API 2.2</span><span class="sxs-lookup"><span data-stu-id="245f4-110">Web API 2.2</span></span>](../releases/whats-new-in-aspnet-web-api-22.md)
> - [<span data-ttu-id="245f4-111">ASP.NET Identity 2.1</span><span class="sxs-lookup"><span data-stu-id="245f4-111">ASP.NET Identity 2.1</span></span>](../../../identity/index.md)


<span data-ttu-id="245f4-112">In Visual Studio 2013 bietet die Web-API-Projektvorlage aus drei Optionen für die Authentifizierung:</span><span class="sxs-lookup"><span data-stu-id="245f4-112">In Visual Studio 2013, the Web API project template gives you three options for authentication:</span></span>

- <span data-ttu-id="245f4-113">**Individuelle Konten.**</span><span class="sxs-lookup"><span data-stu-id="245f4-113">**Individual accounts.**</span></span> <span data-ttu-id="245f4-114">Die app verwendet eine Mitgliedschaftsdatenbank.</span><span class="sxs-lookup"><span data-stu-id="245f4-114">The app uses a membership database.</span></span>
- <span data-ttu-id="245f4-115">**Organisationskonten.**</span><span class="sxs-lookup"><span data-stu-id="245f4-115">**Organizational accounts.**</span></span> <span data-ttu-id="245f4-116">Benutzer melden Sie sich mit ihren Azure Active Directory, Office 365 oder einer lokalen Active Directory-Anmeldeinformationen.</span><span class="sxs-lookup"><span data-stu-id="245f4-116">Users sign in with their Azure Active Directory, Office 365, or on-premise Active Directory credentials.</span></span>
- <span data-ttu-id="245f4-117">**Windows-Authentifizierung.**</span><span class="sxs-lookup"><span data-stu-id="245f4-117">**Windows authentication.**</span></span> <span data-ttu-id="245f4-118">Diese Option dient für Intranetanwendungen und verwendet das Windows-Authentifizierung-IIS-Modul.</span><span class="sxs-lookup"><span data-stu-id="245f4-118">This option is intended for Intranet applications, and uses the Windows Authentication IIS module.</span></span>

<span data-ttu-id="245f4-119">Weitere Informationen zu diesen Optionen finden Sie unter [Erstellen von ASP.NET-Webprojekten in Visual Studio 2013](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth).</span><span class="sxs-lookup"><span data-stu-id="245f4-119">For more details about these options, see [Creating ASP.NET Web Projects in Visual Studio 2013](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth).</span></span>

<span data-ttu-id="245f4-120">Einzelkonten bieten zwei Möglichkeiten, die für einen Benutzer für die Anmeldung:</span><span class="sxs-lookup"><span data-stu-id="245f4-120">Individual accounts provide two ways for a user to log in:</span></span>

- <span data-ttu-id="245f4-121">**Lokale Anmeldung**.</span><span class="sxs-lookup"><span data-stu-id="245f4-121">**Local login**.</span></span> <span data-ttu-id="245f4-122">Der Benutzer registriert sich am Standort Eingabe eines Benutzernamens und Kennworts.</span><span class="sxs-lookup"><span data-stu-id="245f4-122">The user registers at the site, entering a username and password.</span></span> <span data-ttu-id="245f4-123">Die app speichert den Hashwert des Kennworts in der Mitgliedschaftsdatenbank.</span><span class="sxs-lookup"><span data-stu-id="245f4-123">The app stores the password hash in the membership database.</span></span> <span data-ttu-id="245f4-124">Wenn der Benutzer anmeldet, überprüft das ASP.NET Identity-System das Kennwort an.</span><span class="sxs-lookup"><span data-stu-id="245f4-124">When the user logs in, the ASP.NET Identity system verifies the password.</span></span>
- <span data-ttu-id="245f4-125">**Anmeldung für soziale Netzwerke**.</span><span class="sxs-lookup"><span data-stu-id="245f4-125">**Social login**.</span></span> <span data-ttu-id="245f4-126">Der Benutzer meldet sich mit einem externen Dienst, z. B. Facebook, Microsoft oder Google.</span><span class="sxs-lookup"><span data-stu-id="245f4-126">The user signs in with an external service, such as Facebook, Microsoft, or Google.</span></span> <span data-ttu-id="245f4-127">Die app weiterhin erstellt einen Eintrag für den Benutzer in der Mitgliedschaftsdatenbank, aber keine Anmeldeinformationen nicht gespeichert.</span><span class="sxs-lookup"><span data-stu-id="245f4-127">The app still creates an entry for the user in the membership database, but does not store any credentials.</span></span> <span data-ttu-id="245f4-128">Der Benutzer authentifiziert, indem Sie den externen Dienst anmelden.</span><span class="sxs-lookup"><span data-stu-id="245f4-128">The user authenticates by signing into the external service.</span></span>

<span data-ttu-id="245f4-129">Dieser Artikel befasst sich das Szenario für die lokale Anmeldung.</span><span class="sxs-lookup"><span data-stu-id="245f4-129">This article looks at the local login scenario.</span></span> <span data-ttu-id="245f4-130">Für lokale und soziale Anmeldung verwendet Web-API "oauth2" zum Authentifizieren von Anforderungen an.</span><span class="sxs-lookup"><span data-stu-id="245f4-130">For both local and social login, Web API uses OAuth2 to authenticate requests.</span></span> <span data-ttu-id="245f4-131">Die Datenflüsse Anmeldeinformationen unterscheiden sich jedoch für lokale und soziale Anmeldung.</span><span class="sxs-lookup"><span data-stu-id="245f4-131">However, the credential flows are different for local and social login.</span></span>

<span data-ttu-id="245f4-132">In diesem Artikel zeige ich eine einfache app, mit dem den Benutzer anmelden und zum Senden von authentifizierten AJAX-Aufrufe an eine Web-API.</span><span class="sxs-lookup"><span data-stu-id="245f4-132">In this article, I'll demonstrate a simple app that lets the user log in and send authenticated AJAX calls to a web API.</span></span> <span data-ttu-id="245f4-133">Sie können den Beispielcode herunterladen [hier](https://github.com/MikeWasson/LocalAccountsApp).</span><span class="sxs-lookup"><span data-stu-id="245f4-133">You can download the sample code [here](https://github.com/MikeWasson/LocalAccountsApp).</span></span> <span data-ttu-id="245f4-134">Die Infodatei beschreibt, wie Sie das Beispiel von Grund auf neu in Visual Studio zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="245f4-134">The readme describes how to create the sample from scratch in Visual Studio.</span></span>

[![](individual-accounts-in-web-api/_static/image2.png)](individual-accounts-in-web-api/_static/image1.png)

<span data-ttu-id="245f4-135">Die Beispiel-app verwendet "Knockout.js" für die Datenbindung und jQuery für AJAX-Anforderungen senden.</span><span class="sxs-lookup"><span data-stu-id="245f4-135">The sample app uses Knockout.js for data-binding and jQuery for sending AJAX requests.</span></span> <span data-ttu-id="245f4-136">Ich werde auf die AJAX-Aufrufe, konzentrieren, sodass Sie nicht "Knockout.js" für diesen Artikel kennen müssen.</span><span class="sxs-lookup"><span data-stu-id="245f4-136">I'll be focusing on the AJAX calls, so you don't need to know Knockout.js for this article.</span></span>

<span data-ttu-id="245f4-137">Dabei werde ich Folgendes beschreiben:</span><span class="sxs-lookup"><span data-stu-id="245f4-137">Along the way, I'll describe:</span></span>

- <span data-ttu-id="245f4-138">Was die app auf der Clientseite ausführt.</span><span class="sxs-lookup"><span data-stu-id="245f4-138">What the app is doing on the client side.</span></span>
- <span data-ttu-id="245f4-139">Woran liegt das auf dem Server.</span><span class="sxs-lookup"><span data-stu-id="245f4-139">What's happening on the server.</span></span>
- <span data-ttu-id="245f4-140">Der HTTP-Datenverkehr in der Mitte.</span><span class="sxs-lookup"><span data-stu-id="245f4-140">The HTTP traffic in the middle.</span></span>

<span data-ttu-id="245f4-141">Zunächst müssen wir einige OAuth2-Terminologie zu definieren.</span><span class="sxs-lookup"><span data-stu-id="245f4-141">First, we need to define some OAuth2 terminology.</span></span>

- <span data-ttu-id="245f4-142">*Ressource*.</span><span class="sxs-lookup"><span data-stu-id="245f4-142">*Resource*.</span></span> <span data-ttu-id="245f4-143">Teil der Daten, die geschützt werden können.</span><span class="sxs-lookup"><span data-stu-id="245f4-143">Some piece of data that can be protected.</span></span>
- <span data-ttu-id="245f4-144">*Ressourcenserver*.</span><span class="sxs-lookup"><span data-stu-id="245f4-144">*Resource server*.</span></span> <span data-ttu-id="245f4-145">Der Server, der die Ressource hostet.</span><span class="sxs-lookup"><span data-stu-id="245f4-145">The server that hosts the resource.</span></span>
- <span data-ttu-id="245f4-146">*Ressourcenbesitzer*.</span><span class="sxs-lookup"><span data-stu-id="245f4-146">*Resource owner*.</span></span> <span data-ttu-id="245f4-147">Die Entität, die über die Berechtigung zum Zugriff auf eine Ressource erteilen kann.</span><span class="sxs-lookup"><span data-stu-id="245f4-147">The entity that can grant permission to access a resource.</span></span> <span data-ttu-id="245f4-148">(Dies ist üblicherweise der Benutzer.)</span><span class="sxs-lookup"><span data-stu-id="245f4-148">(Typically the user.)</span></span>
- <span data-ttu-id="245f4-149">*Client*: die app, die auf die Ressource zugreifen möchte.</span><span class="sxs-lookup"><span data-stu-id="245f4-149">*Client*: The app that wants access to the resource.</span></span> <span data-ttu-id="245f4-150">In diesem Artikel ist der Client ein Webbrowser.</span><span class="sxs-lookup"><span data-stu-id="245f4-150">In this article, the client is a web browser.</span></span>
- <span data-ttu-id="245f4-151">*Zugriffstoken*.</span><span class="sxs-lookup"><span data-stu-id="245f4-151">*Access token*.</span></span> <span data-ttu-id="245f4-152">Ein Token, die Zugriff auf eine Ressource.</span><span class="sxs-lookup"><span data-stu-id="245f4-152">A token that grants access to a resource.</span></span>
- <span data-ttu-id="245f4-153">*Bearertoken*.</span><span class="sxs-lookup"><span data-stu-id="245f4-153">*Bearer token*.</span></span> <span data-ttu-id="245f4-154">Einen bestimmten Typ von Zugriffstoken, mit der Eigenschaft an, dass jemand das Token verwenden kann.</span><span class="sxs-lookup"><span data-stu-id="245f4-154">A particular type of access token, with the property that anyone can use the token.</span></span> <span data-ttu-id="245f4-155">Ein Client benötigen nicht in anderen Worten: ein kryptografischer Schlüssel oder anderen geheimen Schlüssel ein trägertoken, das mit.</span><span class="sxs-lookup"><span data-stu-id="245f4-155">In other words, a client doesn't need a cryptographic key or other secret to use a bearer token.</span></span> <span data-ttu-id="245f4-156">Aus diesem Grund Bearer-Tokens sollte nur über eine HTTPS verwendet werden, und benötigen relativ kurze Ablaufzeiten.</span><span class="sxs-lookup"><span data-stu-id="245f4-156">For that reason, bearer tokens should only be used over a HTTPS, and should have relatively short expiration times.</span></span>
- <span data-ttu-id="245f4-157">*Autorisierungsserver*.</span><span class="sxs-lookup"><span data-stu-id="245f4-157">*Authorization server*.</span></span> <span data-ttu-id="245f4-158">Ein Server, der von Access-Token zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="245f4-158">A server that gives out access tokens.</span></span>

<span data-ttu-id="245f4-159">Eine Anwendung kann als autorisierungsserver und Ressourcenserver fungieren.</span><span class="sxs-lookup"><span data-stu-id="245f4-159">An application can act as both authorization server and resource server.</span></span> <span data-ttu-id="245f4-160">Die Web-API-Projektvorlage folgt diesem Muster.</span><span class="sxs-lookup"><span data-stu-id="245f4-160">The Web API project template follows this pattern.</span></span>

## <a name="local-login-credential-flow"></a><span data-ttu-id="245f4-161">Lokale Anmeldung mit Clientanmeldeinformationen</span><span class="sxs-lookup"><span data-stu-id="245f4-161">Local Login Credential Flow</span></span>

<span data-ttu-id="245f4-162">Für die lokale Anmeldung verwendet, Web-API verwendet die [ressourcenbesitzerflow Kennwort](http://oauthlib.readthedocs.org/en/latest/oauth2/grants/password.html) in "oauth2" definiert.</span><span class="sxs-lookup"><span data-stu-id="245f4-162">For local login, Web API uses the [resource owner password flow](http://oauthlib.readthedocs.org/en/latest/oauth2/grants/password.html) defined in OAuth2.</span></span>

1. <span data-ttu-id="245f4-163">Der Benutzer gibt eines Namens und Kennworts in den Client.</span><span class="sxs-lookup"><span data-stu-id="245f4-163">The user enters a name and password into the client.</span></span>
2. <span data-ttu-id="245f4-164">Der Client sendet diese Anmeldeinformationen an den autorisierungsserver.</span><span class="sxs-lookup"><span data-stu-id="245f4-164">The client sends these credentials to the authorization server.</span></span>
3. <span data-ttu-id="245f4-165">Der autorisierungsserver authentifiziert die Anmeldeinformationen und gibt ein Zugriffstoken zurück.</span><span class="sxs-lookup"><span data-stu-id="245f4-165">The authorization server authenticates the credentials and returns an access token.</span></span>
4. <span data-ttu-id="245f4-166">Um eine geschützte Ressource zuzugreifen, fügt der Client das Zugriffstoken im Autorisierungsheader der HTTP-Anforderung.</span><span class="sxs-lookup"><span data-stu-id="245f4-166">To access a protected resource, the client includes the access token in the Authorization header of the HTTP request.</span></span>

![](individual-accounts-in-web-api/_static/image3.png)

<span data-ttu-id="245f4-167">Bei der Auswahl **einzelkonten** in der Web-API-Projektvorlage enthält das Projekt einen autorisierungsserver, die Anmeldeinformationen des Benutzers überprüft und Token ausstellt.</span><span class="sxs-lookup"><span data-stu-id="245f4-167">When you select **Individual accounts** in the Web API project template, the project includes an authorization server that validates user credentials and issues tokens.</span></span> <span data-ttu-id="245f4-168">Das folgende Diagramm zeigt den gleichen Anmeldeinformationen Flow in Form von Web-API.</span><span class="sxs-lookup"><span data-stu-id="245f4-168">The following diagram shows the same credential flow in terms of Web API components.</span></span>

![](individual-accounts-in-web-api/_static/image4.png)

<span data-ttu-id="245f4-169">In diesem Szenario werden Web-API-Controller als Ressourcenserver fungieren.</span><span class="sxs-lookup"><span data-stu-id="245f4-169">In this scenario, Web API controllers act as resource servers.</span></span> <span data-ttu-id="245f4-170">Ein Authentifizierungsfilter überprüft das Zugriffstoken, und die **[Authorize]** Attribut wird verwendet, um eine Ressource zu schützen.</span><span class="sxs-lookup"><span data-stu-id="245f4-170">An authentication filter validates access tokens, and the **[Authorize]** attribute is used to protect a resource.</span></span> <span data-ttu-id="245f4-171">Wenn ein Controller bzw. die Aktionsmethode hat die **[Authorize]** Attribut, alle Anforderungen an diesen Controller oder die Aktion muss authentifiziert werden.</span><span class="sxs-lookup"><span data-stu-id="245f4-171">When a controller or action has the **[Authorize]** attribute, all requests to that controller or action must be authenticated.</span></span> <span data-ttu-id="245f4-172">Andernfalls wird die Autorisierung verweigert, und Web-API-Fehler 401 (nicht autorisiert) zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="245f4-172">Otherwise, authorization is denied, and Web API returns a 401 (Unauthorized) error.</span></span>

<span data-ttu-id="245f4-173">Der autorisierungsserver und der Authentifizierungsfilter, die beide einen Aufruf an ein [OWIN-Middleware](../../../aspnet/overview/owin-and-katana/an-overview-of-project-katana.md) Komponente, die Details der "oauth2" verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="245f4-173">The authorization server and the authentication filter both call into an [OWIN middleware](../../../aspnet/overview/owin-and-katana/an-overview-of-project-katana.md) component that handles the details of OAuth2.</span></span> <span data-ttu-id="245f4-174">Ich beschreibe später in diesem Tutorial das Design im Detail.</span><span class="sxs-lookup"><span data-stu-id="245f4-174">I'll describe the design in more detail later in this tutorial.</span></span>

## <a name="sending-an-unauthorized-request"></a><span data-ttu-id="245f4-175">Senden eine nicht autorisierte Anforderung</span><span class="sxs-lookup"><span data-stu-id="245f4-175">Sending an Unauthorized Request</span></span>

<span data-ttu-id="245f4-176">Klicken Sie zum Einstieg, führen Sie die app, und klicken Sie auf die **-API Aufrufen** Schaltfläche.</span><span class="sxs-lookup"><span data-stu-id="245f4-176">To get started, run the app and click the **Call API** button.</span></span> <span data-ttu-id="245f4-177">Wenn die Anforderung abgeschlossen ist, sollte eine Fehlermeldung in die **Ergebnis** Feld.</span><span class="sxs-lookup"><span data-stu-id="245f4-177">When the request completes, you should see an error message in the **Result** box.</span></span> <span data-ttu-id="245f4-178">Das ist da die Anforderung ein Zugriffstoken nicht enthält, damit die Anforderung nicht autorisiert ist.</span><span class="sxs-lookup"><span data-stu-id="245f4-178">That's because the request does not contain an access token, so the request is unauthorized.</span></span>

[![](individual-accounts-in-web-api/_static/image6.png)](individual-accounts-in-web-api/_static/image5.png)

<span data-ttu-id="245f4-179">Die **-API Aufrufen** Schaltfläche sendet eine AJAX-Anforderung an ~/api/Werten, die eine Controlleraktion der Web-API aufruft.</span><span class="sxs-lookup"><span data-stu-id="245f4-179">The **Call API** button sends an AJAX request to ~/api/values, which invokes a Web API controller action.</span></span> <span data-ttu-id="245f4-180">Hier ist der Teil der JavaScript-Code, der die AJAX-Anforderung sendet.</span><span class="sxs-lookup"><span data-stu-id="245f4-180">Here is the section of JavaScript code that sends the AJAX request.</span></span> <span data-ttu-id="245f4-181">In der Beispiel-app alle von der JavaScript-app-Code befindet sich in der Datei Scripts\app.js.</span><span class="sxs-lookup"><span data-stu-id="245f4-181">In the sample app, all of the JavaScript app code is located in the Scripts\app.js file.</span></span>

[!code-javascript[Main](individual-accounts-in-web-api/samples/sample1.js)]

<span data-ttu-id="245f4-182">Bis der Benutzer anmeldet, ist es kein bearertoken und daher keine Authorization-Header in der Anforderung.</span><span class="sxs-lookup"><span data-stu-id="245f4-182">Until the user logs in, there is no bearer token, and therefore no Authorization header in the request.</span></span> <span data-ttu-id="245f4-183">Dies bewirkt, dass die Anforderung ein 401-Fehler zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="245f4-183">This causes the request to return a 401 error.</span></span>

<span data-ttu-id="245f4-184">Hier ist die HTTP-Anforderung.</span><span class="sxs-lookup"><span data-stu-id="245f4-184">Here is the HTTP request.</span></span> <span data-ttu-id="245f4-185">(Ich verwendet habe [Fiddler](http://www.telerik.com/fiddler) den HTTP-Datenverkehr zu erfassen.)</span><span class="sxs-lookup"><span data-stu-id="245f4-185">(I used [Fiddler](http://www.telerik.com/fiddler) to capture the HTTP traffic.)</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample2.cmd)]

<span data-ttu-id="245f4-186">HTTP-Antwort:</span><span class="sxs-lookup"><span data-stu-id="245f4-186">HTTP response:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample3.cmd?highlight=1,4)]

<span data-ttu-id="245f4-187">Beachten Sie, dass die Antwort enthält den Www-Authentifizierungsheader der Herausforderung, die auf den Bearer festgelegt.</span><span class="sxs-lookup"><span data-stu-id="245f4-187">Notice that the response includes a Www-Authenticate header with the challenge set to Bearer.</span></span> <span data-ttu-id="245f4-188">Der angibt, dass der Server ein bearertoken erwartet.</span><span class="sxs-lookup"><span data-stu-id="245f4-188">That indicates the server expects a bearer token.</span></span>

## <a name="register-a-user"></a><span data-ttu-id="245f4-189">Registrieren Sie einen Benutzer</span><span class="sxs-lookup"><span data-stu-id="245f4-189">Register a User</span></span>

<span data-ttu-id="245f4-190">In der **registrieren** Abschnitt der app, geben Sie einen e-Mail-Adresse und ein Kennwort ein, und klicken Sie auf die **registrieren** Schaltfläche.</span><span class="sxs-lookup"><span data-stu-id="245f4-190">In the **Register** section of the app, enter an email and password, and click the **Register** button.</span></span>

<span data-ttu-id="245f4-191">Sie müssen eine gültige e-Mail-Adresse für dieses Beispiel verwenden, aber eine echte app würde die Adresse zu bestätigen.</span><span class="sxs-lookup"><span data-stu-id="245f4-191">You don't need to use a valid email address for this sample, but a real app would confirm the address.</span></span> <span data-ttu-id="245f4-192">(Finden Sie unter [erstellen eine sichere ASP.NET MVC 5-Web-app mit Anmeldung, e-Mail-Bestätigung und kennwortzurücksetzung](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).) Verwenden Sie für das Kennwort etwa "Kennwort1!", mit einem Großbuchstaben, Kleinbuchstaben, Anzahl und nicht alphanumerische Zeichen.</span><span class="sxs-lookup"><span data-stu-id="245f4-192">(See [Create a secure ASP.NET MVC 5 web app with log in, email confirmation and password reset](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).) For the password, use something like "Password1!", with an upper case letter, lower case letter, number, and non-alpha-numeric character.</span></span> <span data-ttu-id="245f4-193">Um die app einfach zu halten, ausgelassen ich die clientseitige Validierung, daher liegt ein Problem mit dem Kennwortformat vor, Sie Fehlercode 400 (Ungültige Anforderung) erhalten.</span><span class="sxs-lookup"><span data-stu-id="245f4-193">To keep the app simple, I left out client-side validation, so if there is a problem with the password format, you'll get a 400 (Bad Request) error.</span></span>

[![](individual-accounts-in-web-api/_static/image8.png)](individual-accounts-in-web-api/_static/image7.png)

<span data-ttu-id="245f4-194">Die **registrieren** Schaltfläche sendet eine POST-Anforderung an ~/api/Account/Register /.</span><span class="sxs-lookup"><span data-stu-id="245f4-194">The **Register** button sends a POST request to ~/api/Account/Register/.</span></span> <span data-ttu-id="245f4-195">Der Anforderungstext ist eine jsonobjekt, das den Namen und das Kennwort enthält.</span><span class="sxs-lookup"><span data-stu-id="245f4-195">The request body is a JSON object that holds the name and password.</span></span> <span data-ttu-id="245f4-196">Hier ist der JavaScript-Code, der die Anforderung sendet:</span><span class="sxs-lookup"><span data-stu-id="245f4-196">Here is the JavaScript code that sends the request:</span></span>

[!code-javascript[Main](individual-accounts-in-web-api/samples/sample4.js)]

<span data-ttu-id="245f4-197">HTTP-Anforderung:</span><span class="sxs-lookup"><span data-stu-id="245f4-197">HTTP request:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample5.cmd?highlight=5,10)]

<span data-ttu-id="245f4-198">HTTP-Antwort:</span><span class="sxs-lookup"><span data-stu-id="245f4-198">HTTP response:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample6.cmd)]

<span data-ttu-id="245f4-199">Diese Anforderung erfolgt durch die `AccountController` Klasse.</span><span class="sxs-lookup"><span data-stu-id="245f4-199">This request is handled by the `AccountController` class.</span></span> <span data-ttu-id="245f4-200">Intern `AccountController` verwendet ASP.NET Identity zum Verwalten der Mitgliedschaftsdatenbank.</span><span class="sxs-lookup"><span data-stu-id="245f4-200">Internally, `AccountController` uses ASP.NET Identity to manage the membership database.</span></span>

<span data-ttu-id="245f4-201">Wenn Sie die app lokal aus Visual Studio ausführen, werden die Benutzerkonten in LocalDB, in der Tabelle "aspnetusers" gespeichert.</span><span class="sxs-lookup"><span data-stu-id="245f4-201">If you run the app locally from Visual Studio, user accounts are stored in LocalDB, in the AspNetUsers table.</span></span> <span data-ttu-id="245f4-202">Um die Tabellen in Visual Studio anzuzeigen, klicken Sie auf die **Ansicht** , wählen Sie im Menü **Server-Explorer**, erweitern Sie dann **Datenverbindungen**.</span><span class="sxs-lookup"><span data-stu-id="245f4-202">To view the tables in Visual Studio, click the **View** menu, select **Server Explorer**, then expand **Data Connections**.</span></span>

![](individual-accounts-in-web-api/_static/image9.png)

## <a name="get-an-access-token"></a><span data-ttu-id="245f4-203">Abrufen eines Zugriffstokens</span><span class="sxs-lookup"><span data-stu-id="245f4-203">Get an Access Token</span></span>

<span data-ttu-id="245f4-204">Bisher haben wir keine OAuth fertig, aber nun sehen, dass der OAuth-autorisierungsserver in Aktion, wenn es sich um ein Zugriffstoken anfordern.</span><span class="sxs-lookup"><span data-stu-id="245f4-204">So far we have not done any OAuth, but now we'll see the OAuth authorization server in action, when we request an access token.</span></span> <span data-ttu-id="245f4-205">In der **anmelden** Bereich der Beispiel-app, geben Sie den e-Mail-Adresse und das Kennwort, und klicken Sie auf **anmelden**.</span><span class="sxs-lookup"><span data-stu-id="245f4-205">In the **Log In** area of the sample app, enter the email and password and click **Log In**.</span></span>

[![](individual-accounts-in-web-api/_static/image11.png)](individual-accounts-in-web-api/_static/image10.png)

<span data-ttu-id="245f4-206">Die **anmelden** Schaltfläche sendet eine Anforderung an den token-Endpunkt.</span><span class="sxs-lookup"><span data-stu-id="245f4-206">The **Log In** button sends a request to the token endpoint.</span></span> <span data-ttu-id="245f4-207">Der Hauptteil der Anforderung enthält die folgenden Formular-Url-codierte Daten:</span><span class="sxs-lookup"><span data-stu-id="245f4-207">The body of the request contains the following form-url-encoded data:</span></span>

- <span data-ttu-id="245f4-208">Erteilen Sie\_Typ: "Password"</span><span class="sxs-lookup"><span data-stu-id="245f4-208">grant\_type: "password"</span></span>
- <span data-ttu-id="245f4-209">Benutzername: &lt;e-Mail des Benutzers&gt;</span><span class="sxs-lookup"><span data-stu-id="245f4-209">username: &lt;the user's email&gt;</span></span>
- <span data-ttu-id="245f4-210">Kennwort: &lt;Kennwort&gt;</span><span class="sxs-lookup"><span data-stu-id="245f4-210">password: &lt;password&gt;</span></span>

<span data-ttu-id="245f4-211">Hier ist der JavaScript-Code, der die AJAX-Anforderung sendet:</span><span class="sxs-lookup"><span data-stu-id="245f4-211">Here is the JavaScript code that sends the AJAX request:</span></span>

[!code-javascript[Main](individual-accounts-in-web-api/samples/sample7.js?highlight=14)]

<span data-ttu-id="245f4-212">Wenn die Anforderung erfolgreich ist, gibt der autorisierungsserver ein Zugriffstoken im Antworttext zurück.</span><span class="sxs-lookup"><span data-stu-id="245f4-212">If the request succeeds, the authorization server returns an access token in the response body.</span></span> <span data-ttu-id="245f4-213">Beachten Sie, dass wir das Token in Sitzung Storage zur späteren Verwendung beim Senden von Anforderungen an die API gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="245f4-213">Notice that we store the token in session storage, to use later when sending requests to the API.</span></span> <span data-ttu-id="245f4-214">Im Gegensatz zu einige Formen der Authentifizierung (z. B. Cookie-basierte Authentifizierung) wird der Browser nicht automatisch das Zugriffstoken in nachfolgenden Anforderungen hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="245f4-214">Unlike some forms of authentication (such as cookie-based authentication), the browser will not automatically include the access token in subsequent requests.</span></span> <span data-ttu-id="245f4-215">Die Anwendung müssen manuell.</span><span class="sxs-lookup"><span data-stu-id="245f4-215">The application must do so explicitly.</span></span> <span data-ttu-id="245f4-216">Das ist eine gute Sache, da er begrenzt [CSRF-Sicherheitsrisiken](preventing-cross-site-request-forgery-csrf-attacks.md).</span><span class="sxs-lookup"><span data-stu-id="245f4-216">That's a good thing, because it limits [CSRF vulnerabilities](preventing-cross-site-request-forgery-csrf-attacks.md).</span></span>

<span data-ttu-id="245f4-217">HTTP-Anforderung:</span><span class="sxs-lookup"><span data-stu-id="245f4-217">HTTP request:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample8.cmd?highlight=5,10)]

<span data-ttu-id="245f4-218">Sie können sehen, dass die Anforderung die Anmeldeinformationen des Benutzers enthält.</span><span class="sxs-lookup"><span data-stu-id="245f4-218">You can see that the request contains the user's credentials.</span></span> <span data-ttu-id="245f4-219">Sie *müssen* HTTPS TLS zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="245f4-219">You *must* use HTTPS to provide transport layer security.</span></span>

<span data-ttu-id="245f4-220">HTTP-Antwort:</span><span class="sxs-lookup"><span data-stu-id="245f4-220">HTTP response:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample9.cmd?highlight=8)]

<span data-ttu-id="245f4-221">Zur besseren Lesbarkeit, wenn ich den JSON-Code mit Einzug dargestellt und das Zugriffstoken, das eine ziemlich lang ist abgeschnitten.</span><span class="sxs-lookup"><span data-stu-id="245f4-221">For readability, I indented the JSON and truncated the access token, which is a quite long.</span></span>

<span data-ttu-id="245f4-222">Die `access_token`, `token_type`, und `expires_in` Eigenschaften durch OAuth2-Spezifikation definiert sind. Die anderen Eigenschaften (`userName`, `.issued`, und `.expires`) sind nur zu Informationszwecken.</span><span class="sxs-lookup"><span data-stu-id="245f4-222">The `access_token`, `token_type`, and `expires_in` properties are defined by the OAuth2 spec. The other properties (`userName`, `.issued`, and `.expires`) are just for informational purposes.</span></span> <span data-ttu-id="245f4-223">Sie finden den Code, der diese zusätzlichen Eigenschaften in fügt die `TokenEndpoint` -Methode, in der Datei /Providers/ApplicationOAuthProvider.cs.</span><span class="sxs-lookup"><span data-stu-id="245f4-223">You can find the code that adds those additional properties in the `TokenEndpoint` method, in the /Providers/ApplicationOAuthProvider.cs file.</span></span>

## <a name="send-an-authenticated-request"></a><span data-ttu-id="245f4-224">Eine authentifizierte Anforderung senden</span><span class="sxs-lookup"><span data-stu-id="245f4-224">Send an Authenticated Request</span></span>

<span data-ttu-id="245f4-225">Nun, da wir ein bearertoken verfügen, können wir eine authentifizierte Anforderung an die API vornehmen.</span><span class="sxs-lookup"><span data-stu-id="245f4-225">Now that we have a bearer token, we can make an authenticated request to the API.</span></span> <span data-ttu-id="245f4-226">Dies erfolgt durch Festlegen des Authorization-Headers in der Anforderung.</span><span class="sxs-lookup"><span data-stu-id="245f4-226">This is done by setting the Authorization header in the request.</span></span> <span data-ttu-id="245f4-227">Klicken Sie auf die **-API Aufrufen** Schaltfläche erneut aus, um dies zu sehen.</span><span class="sxs-lookup"><span data-stu-id="245f4-227">Click the **Call API** button again to see this.</span></span>

[![](individual-accounts-in-web-api/_static/image13.png)](individual-accounts-in-web-api/_static/image12.png)

<span data-ttu-id="245f4-228">HTTP-Anforderung:</span><span class="sxs-lookup"><span data-stu-id="245f4-228">HTTP request:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample10.cmd?highlight=5)]

<span data-ttu-id="245f4-229">HTTP-Antwort:</span><span class="sxs-lookup"><span data-stu-id="245f4-229">HTTP response:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample11.cmd)]

## <a name="log-out"></a><span data-ttu-id="245f4-230">Melden Sie sich ab</span><span class="sxs-lookup"><span data-stu-id="245f4-230">Log Out</span></span>

<span data-ttu-id="245f4-231">Da der Browser die Anmeldeinformationen oder das Zugriffstoken nicht zwischengespeichert ist, ist das Abmelden lediglich "vergessen" das Token, indem Sie ihn aus dem Sitzungsspeicher entfernen:</span><span class="sxs-lookup"><span data-stu-id="245f4-231">Because the browser does not cache the credentials or the access token, logging out is simply a matter of "forgetting" the token, by removing it from session storage:</span></span>

[!code-javascript[Main](individual-accounts-in-web-api/samples/sample12.js)]

## <a name="understanding-the-individual-accounts-project-template"></a><span data-ttu-id="245f4-232">Verstehen der Einzelkonten-Projektvorlage</span><span class="sxs-lookup"><span data-stu-id="245f4-232">Understanding the Individual Accounts Project Template</span></span>

<span data-ttu-id="245f4-233">Bei der Auswahl **Einzelkonten** in der ASP.NET Web Application-Projektvorlage, die das Projekt enthält:</span><span class="sxs-lookup"><span data-stu-id="245f4-233">When you select **Individual Accounts** in the ASP.NET Web Application project template, the project includes:</span></span>

- <span data-ttu-id="245f4-234">Ein Server für den OAuth2-Autorisierung.</span><span class="sxs-lookup"><span data-stu-id="245f4-234">An OAuth2 authorization server.</span></span>
- <span data-ttu-id="245f4-235">Eine Web-API-Endpunkt für die Verwaltung von Benutzerkonten</span><span class="sxs-lookup"><span data-stu-id="245f4-235">A Web API endpoint for managing user accounts</span></span>
- <span data-ttu-id="245f4-236">Ein EF-Modell zum Speichern von Benutzerkonten.</span><span class="sxs-lookup"><span data-stu-id="245f4-236">An EF model for storing user accounts.</span></span>

<span data-ttu-id="245f4-237">Hier sind die hauptanwendung-Klassen, die diese Funktionen zu implementieren:</span><span class="sxs-lookup"><span data-stu-id="245f4-237">Here are the main application classes that implement these features:</span></span>

- <span data-ttu-id="245f4-238">`AccountController`</span><span class="sxs-lookup"><span data-stu-id="245f4-238">`AccountController`.</span></span> <span data-ttu-id="245f4-239">Stellt einen Web-API-Endpunkt für die Verwaltung von Benutzerkonten bereit.</span><span class="sxs-lookup"><span data-stu-id="245f4-239">Provides a Web API endpoint for managing user accounts.</span></span> <span data-ttu-id="245f4-240">Die `Register` Aktion ist die einzige, die wir in diesem Tutorial verwendet.</span><span class="sxs-lookup"><span data-stu-id="245f4-240">The `Register` action is the only one that we used in this tutorial.</span></span> <span data-ttu-id="245f4-241">Andere Methoden für die Klasse unterstützt das Zurücksetzen von Kennwörtern, Anmeldungen per sozialem Netzwerk und andere Funktionen.</span><span class="sxs-lookup"><span data-stu-id="245f4-241">Other methods on the class support password reset, social logins, and other functionality.</span></span>
- <span data-ttu-id="245f4-242">`ApplicationUser`, in /Models/IdentityModels.cs definiert.</span><span class="sxs-lookup"><span data-stu-id="245f4-242">`ApplicationUser`, defined in /Models/IdentityModels.cs.</span></span> <span data-ttu-id="245f4-243">Diese Klasse ist das EF-Modell für Benutzerkonten in der Mitgliedschaftsdatenbank.</span><span class="sxs-lookup"><span data-stu-id="245f4-243">This class is the EF model for user accounts in the membership database.</span></span>
- <span data-ttu-id="245f4-244">`ApplicationUserManager`, definiert in/app\_Start/IdentityConfig.cs, die diese Klasse von wird [UserManager](https://msdn.microsoft.com/library/dn613290.aspx) führt Vorgänge für Benutzerkonten, z. B. Erstellen eines neuen Benutzers, und Überprüfen von Kennwörtern und So weiter, und automatisch beibehalten. Änderungen an der Datenbank.</span><span class="sxs-lookup"><span data-stu-id="245f4-244">`ApplicationUserManager`, defined in /App\_Start/IdentityConfig.cs This class derives from [UserManager](https://msdn.microsoft.com/library/dn613290.aspx) and performs operations on user accounts, such as creating a new user, verifying passwords, and so forth, and automatically persists changes to the database.</span></span>
- <span data-ttu-id="245f4-245">`ApplicationOAuthProvider`</span><span class="sxs-lookup"><span data-stu-id="245f4-245">`ApplicationOAuthProvider`.</span></span> <span data-ttu-id="245f4-246">Dieses Objekt wird in die OWIN-Middleware integriert und von der Middleware ausgelösten Ereignisse verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="245f4-246">This object plugs into the OWIN middleware, and processes events raised by the middleware.</span></span> <span data-ttu-id="245f4-247">Es leitet sich von [OAuthAuthorizationServerProvider](https://msdn.microsoft.com/library/microsoft.owin.security.oauth.oauthauthorizationserverprovider.aspx).</span><span class="sxs-lookup"><span data-stu-id="245f4-247">It derives from [OAuthAuthorizationServerProvider](https://msdn.microsoft.com/library/microsoft.owin.security.oauth.oauthauthorizationserverprovider.aspx).</span></span>

![](individual-accounts-in-web-api/_static/image14.png)

### <a name="configuring-the-authorization-server"></a><span data-ttu-id="245f4-248">Konfigurieren des Autorisierungsservers</span><span class="sxs-lookup"><span data-stu-id="245f4-248">Configuring the Authorization Server</span></span>

<span data-ttu-id="245f4-249">In StartupAuth.cs konfiguriert der folgende Code den autorisierungsserver "oauth2".</span><span class="sxs-lookup"><span data-stu-id="245f4-249">In StartupAuth.cs, the following code configures the OAuth2 authorization server.</span></span>

[!code-csharp[Main](individual-accounts-in-web-api/samples/sample13.cs)]

<span data-ttu-id="245f4-250">Die `TokenEndpointPath` -Eigenschaft ist die URL-Pfad, an den autorisierungsendpunkt-Server.</span><span class="sxs-lookup"><span data-stu-id="245f4-250">The `TokenEndpointPath` property is the URL path to the authorization server endpoint.</span></span> <span data-ttu-id="245f4-251">Dies ist die URL die app verwendet, um das bearertoken zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="245f4-251">That's the URL that app uses to get the bearer tokens.</span></span>

<span data-ttu-id="245f4-252">Die `Provider` Eigenschaft gibt an, einen Anbieter, der integriert wird, in die OWIN-Middleware und verarbeitet Ereignisse, die von der Middleware ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="245f4-252">The `Provider` property specifies a provider that plugs into the OWIN middleware, and processes events raised by the middleware.</span></span>

<span data-ttu-id="245f4-253">Hier ist der grundlegende Ablauf bei möchte, dass die app ein Token zu erhalten:</span><span class="sxs-lookup"><span data-stu-id="245f4-253">Here is the basic flow when the app wants to get a token:</span></span>

1. <span data-ttu-id="245f4-254">Um ein Zugriffstoken zu erhalten, die app sendet eine Anforderung zum ~ / Token.</span><span class="sxs-lookup"><span data-stu-id="245f4-254">To get an access token, the app sends a request to ~/Token.</span></span>
2. <span data-ttu-id="245f4-255">Ruft die OAuth-Middleware `GrantResourceOwnerCredentials` für den Anbieter.</span><span class="sxs-lookup"><span data-stu-id="245f4-255">The OAuth middleware calls `GrantResourceOwnerCredentials` on the provider.</span></span>
3. <span data-ttu-id="245f4-256">Der Anbieter Ruft die `ApplicationUserManager` die Anmeldeinformationen zu überprüfen, und erstellen eine anspruchsidentität.</span><span class="sxs-lookup"><span data-stu-id="245f4-256">The provider calls the `ApplicationUserManager` to validate the credentials and create a claims identity.</span></span>
4. <span data-ttu-id="245f4-257">Wenn dies erfolgreich ist, erstellt der Anbieter ein Authentifizierungsticket, die zum Generieren des Tokens verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="245f4-257">If that succeeds, the provider creates an authentication ticket, which is used to generate the token.</span></span>

[![](individual-accounts-in-web-api/_static/image16.png)](individual-accounts-in-web-api/_static/image15.png)

<span data-ttu-id="245f4-258">Die OAuth-Middleware weiß nicht, alles zu den Benutzerkonten.</span><span class="sxs-lookup"><span data-stu-id="245f4-258">The OAuth middleware doesn't know anything about the user accounts.</span></span> <span data-ttu-id="245f4-259">Der Anbieter kommuniziert zwischen dem Middleware und ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="245f4-259">The provider communicates between the middleware and ASP.NET Identity.</span></span> <span data-ttu-id="245f4-260">Weitere Informationen über die autorisierungsserver Implementierung finden Sie unter [OWIN OAuth 2.0-Autorisierungsserver](../../../aspnet/overview/owin-and-katana/owin-oauth-20-authorization-server.md).</span><span class="sxs-lookup"><span data-stu-id="245f4-260">For more information about implementing the authorization server, see [OWIN OAuth 2.0 Authorization Server](../../../aspnet/overview/owin-and-katana/owin-oauth-20-authorization-server.md).</span></span>

### <a name="configuring-web-api-to-use-bearer-tokens"></a><span data-ttu-id="245f4-261">Konfigurieren von Web-API mit Bearer-Tokens</span><span class="sxs-lookup"><span data-stu-id="245f4-261">Configuring Web API to use Bearer Tokens</span></span>

<span data-ttu-id="245f4-262">In der `WebApiConfig.Register` -Methode, der folgende Code legt fest, um die Authentifizierung für die Web-API-Pipeline:</span><span class="sxs-lookup"><span data-stu-id="245f4-262">In the `WebApiConfig.Register` method, the following code sets up authentication for the Web API pipeline:</span></span>

[!code-csharp[Main](individual-accounts-in-web-api/samples/sample14.cs)]

<span data-ttu-id="245f4-263">Die **auch namensbasiert** Klasse ermöglicht die Authentifizierung mithilfe von Bearer-Tokens.</span><span class="sxs-lookup"><span data-stu-id="245f4-263">The **HostAuthenticationFilter** class enables authentication using bearer tokens.</span></span>

<span data-ttu-id="245f4-264">Die **SuppressDefaultHostAuthentication** Methode weist die Web-API-Authentifizierung zu ignorieren, die erfolgt, bevor die Anforderung die Web-API-Pipeline, die von IIS oder von OWIN-Middleware erreicht hat.</span><span class="sxs-lookup"><span data-stu-id="245f4-264">The **SuppressDefaultHostAuthentication** method tells Web API to ignore any authentication that happens before the request reaches the Web API pipeline, either by IIS or by OWIN middleware.</span></span> <span data-ttu-id="245f4-265">Auf diese Weise können wir die Web-API für die Authentifizierung nur mit Bearer-Tokens einschränken.</span><span class="sxs-lookup"><span data-stu-id="245f4-265">That way, we can restrict Web API to authenticate only using bearer tokens.</span></span>

> [!NOTE]
> <span data-ttu-id="245f4-266">Insbesondere kann der MVC-Teil der app Formularauthentifizierung verwendet die Anmeldeinformationen in einem Cookie gespeichert.</span><span class="sxs-lookup"><span data-stu-id="245f4-266">In particular, the MVC portion of your app might use forms authentication, which stores credentials in a cookie.</span></span> <span data-ttu-id="245f4-267">Cookiebasierte Authentifizierung erfordert die Verwendung von fälschungssicherheitstoken, um CSRF-Angriffe zu verhindern.</span><span class="sxs-lookup"><span data-stu-id="245f4-267">Cookie-based authentication requires the use of anti-forgery tokens, to prevent CSRF attacks.</span></span> <span data-ttu-id="245f4-268">Das ist ein Problem für Web-APIs, da es gibt keine praktische Möglichkeit für die Web-API das fälschungssicherheitstoken an den Client zu senden.</span><span class="sxs-lookup"><span data-stu-id="245f4-268">That's a problem for web APIs, because there is no convenient way for the web API to send the anti-forgery token to the client.</span></span> <span data-ttu-id="245f4-269">(Weitere Informationen zu diesem Problem finden Sie unter [verhindern von CSRF-Angriffen in Web-API-](preventing-cross-site-request-forgery-csrf-attacks.md).) Aufrufen von **SuppressDefaultHostAuthentication** wird sichergestellt, dass die Web-API nicht von den Anmeldeinformationen in Cookies gespeicherten CSRF-Angriffe anfällig ist.</span><span class="sxs-lookup"><span data-stu-id="245f4-269">(For more background on this issue, see [Preventing CSRF Attacks in Web API](preventing-cross-site-request-forgery-csrf-attacks.md).) Calling **SuppressDefaultHostAuthentication** ensures that Web API is not vulnerable to CSRF attacks from credentials stored in cookies.</span></span>


<span data-ttu-id="245f4-270">Wenn der Client eine geschützte Ressource anfordert, hier geschieht in der Web-API-Pipeline:</span><span class="sxs-lookup"><span data-stu-id="245f4-270">When the client requests a protected resource, here is what happens in the Web API pipeline:</span></span>

1. <span data-ttu-id="245f4-271">Die **HostAuthentication** Filter Ruft die OAuth-Methode, um das Token zu überprüfen.</span><span class="sxs-lookup"><span data-stu-id="245f4-271">The **HostAuthentication** filter calls the OAuth middleware to validate the token.</span></span>
2. <span data-ttu-id="245f4-272">Die Middleware konvertiert das Token in eine anspruchsidentität.</span><span class="sxs-lookup"><span data-stu-id="245f4-272">The middleware converts the token into a claims identity.</span></span>
3. <span data-ttu-id="245f4-273">Die Anforderung an diesem Punkt ist *authentifiziert* , nicht jedoch *autorisiert*.</span><span class="sxs-lookup"><span data-stu-id="245f4-273">At this point, the request is *authenticated* but not *authorized*.</span></span>
4. <span data-ttu-id="245f4-274">Der Autorisierungsfilter untersucht die anspruchsidentität.</span><span class="sxs-lookup"><span data-stu-id="245f4-274">The authorization filter examines the claims identity.</span></span> <span data-ttu-id="245f4-275">Wenn die Ansprüche den Benutzer für diese Ressource zu autorisieren, wird die Anforderung autorisiert.</span><span class="sxs-lookup"><span data-stu-id="245f4-275">If the claims authorize the user for that resource, the request is authorized.</span></span> <span data-ttu-id="245f4-276">In der Standardeinstellung die **[Authorize]** Attribut wird jede Anforderung, die authentifiziert werden autorisiert.</span><span class="sxs-lookup"><span data-stu-id="245f4-276">By default, the **[Authorize]** attribute will authorize any request that is authenticated.</span></span> <span data-ttu-id="245f4-277">Allerdings können Sie die Rolle oder von anderen Ansprüchen autorisieren.</span><span class="sxs-lookup"><span data-stu-id="245f4-277">However, you can authorize by role or by other claims.</span></span> <span data-ttu-id="245f4-278">Weitere Informationen finden Sie unter [Authentifizierung und Autorisierung in Web-API-](authentication-and-authorization-in-aspnet-web-api.md).</span><span class="sxs-lookup"><span data-stu-id="245f4-278">For more information, see [Authentication and Authorization in Web API](authentication-and-authorization-in-aspnet-web-api.md).</span></span>
5. <span data-ttu-id="245f4-279">Wenn die vorherigen Schritte erfolgreich sind, gibt der Controller die geschützte Ressource zurück.</span><span class="sxs-lookup"><span data-stu-id="245f4-279">If the previous steps are successful, the controller returns the protected resource.</span></span> <span data-ttu-id="245f4-280">Andernfalls erhält der Client Fehler 401 (nicht autorisiert).</span><span class="sxs-lookup"><span data-stu-id="245f4-280">Otherwise, the client receives a 401 (Unauthorized) error.</span></span>

[![](individual-accounts-in-web-api/_static/image18.png)](individual-accounts-in-web-api/_static/image17.png)

## <a name="additional-resources"></a><span data-ttu-id="245f4-281">Zusätzliche Ressourcen</span><span class="sxs-lookup"><span data-stu-id="245f4-281">Additional Resources</span></span>

- [<span data-ttu-id="245f4-282">ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="245f4-282">ASP.NET Identity</span></span>](../../../identity/index.md)
- <span data-ttu-id="245f4-283">[Grundlegendes zu Sicherheitsfunktionen in der SPA-Vorlage für VS2013 RC](https://blogs.msdn.com/b/webdev/archive/2013/09/20/understanding-security-features-in-spa-template.aspx).</span><span class="sxs-lookup"><span data-stu-id="245f4-283">[Understanding Security Features in the SPA Template for VS2013 RC](https://blogs.msdn.com/b/webdev/archive/2013/09/20/understanding-security-features-in-spa-template.aspx).</span></span> <span data-ttu-id="245f4-284">MSDN-Blog-Beitrag von Hongye Sun.</span><span class="sxs-lookup"><span data-stu-id="245f4-284">MSDN blog post by Hongye Sun.</span></span>
- <span data-ttu-id="245f4-285">[Analyse der einzelnen Web-API-Konten Vorlage – Teil 2: lokale Konten](http://leastprivilege.com/2013/11/26/dissecting-the-web-api-individual-accounts-templatepart-2-local-accounts/).</span><span class="sxs-lookup"><span data-stu-id="245f4-285">[Dissecting the Web API Individual Accounts Template–Part 2: Local Accounts](http://leastprivilege.com/2013/11/26/dissecting-the-web-api-individual-accounts-templatepart-2-local-accounts/).</span></span> <span data-ttu-id="245f4-286">Der Blogbeitrag von Dominick Baier.</span><span class="sxs-lookup"><span data-stu-id="245f4-286">Blog post by Dominick Baier.</span></span>
- <span data-ttu-id="245f4-287">[Hosten von Authentifizierungs- und Web-API mit OWIN](http://brockallen.com/2013/10/27/host-authentication-and-web-api-with-owin-and-active-vs-passive-authentication-middleware/).</span><span class="sxs-lookup"><span data-stu-id="245f4-287">[Host authentication and Web API with OWIN](http://brockallen.com/2013/10/27/host-authentication-and-web-api-with-owin-and-active-vs-passive-authentication-middleware/).</span></span> <span data-ttu-id="245f4-288">Eine gute Erklärung dafür `SuppressDefaultHostAuthentication` und `HostAuthenticationFilter` von Brock Allen.</span><span class="sxs-lookup"><span data-stu-id="245f4-288">A good explanation of `SuppressDefaultHostAuthentication` and `HostAuthenticationFilter` by Brock Allen.</span></span>
- <span data-ttu-id="245f4-289">[Anpassen von Profilinformationen in ASP.NET Identity in Visual Studio 2013-Vorlagen](https://blogs.msdn.com/b/webdev/archive/2013/10/16/customizing-profile-information-in-asp-net-identity-in-vs-2013-templates.aspx).</span><span class="sxs-lookup"><span data-stu-id="245f4-289">[Customizing profile information in ASP.NET Identity in VS 2013 templates](https://blogs.msdn.com/b/webdev/archive/2013/10/16/customizing-profile-information-in-asp-net-identity-in-vs-2013-templates.aspx).</span></span> <span data-ttu-id="245f4-290">MSDN-Blogbeitrag von Pranav Rastogi.</span><span class="sxs-lookup"><span data-stu-id="245f4-290">MSDN blog post by Pranav Rastogi.</span></span>
- <span data-ttu-id="245f4-291">[Pro Anforderung Prozesslebensdauer-Verwaltung für UserManager-Klasse in ASP.NET Identity](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span><span class="sxs-lookup"><span data-stu-id="245f4-291">[Per request lifetime management for UserManager class in ASP.NET Identity](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span></span> <span data-ttu-id="245f4-292">MSDN-Blogbeitrag von Suhas Joshi, mit einer guten Erklärung der `UserManager` Klasse.</span><span class="sxs-lookup"><span data-stu-id="245f4-292">MSDN blog post by Suhas Joshi, with a good explanation of the `UserManager` class.</span></span>
