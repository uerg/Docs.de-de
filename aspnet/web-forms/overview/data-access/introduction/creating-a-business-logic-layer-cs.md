---
uid: web-forms/overview/data-access/introduction/creating-a-business-logic-layer-cs
title: Erstellen einer Geschäftslogikebene (c#) | Microsoft-Dokumentation
author: rick-anderson
description: In diesem Tutorial wird gezeigt, wie Ihre Geschäftsregeln in eine Geschäftslogikschicht (Business Logic Layer, BLL) zentralisieren, das als Zwischenstufe für den Datenaustausch zwischen t dient...
ms.author: riande
ms.date: 03/31/2010
ms.assetid: 85554606-47cb-4e4f-9848-eed9da579056
msc.legacyurl: /web-forms/overview/data-access/introduction/creating-a-business-logic-layer-cs
msc.type: authoredcontent
ms.openlocfilehash: 0db90f1e87bcaac51ca08ef1a8b258c93be8f613
ms.sourcegitcommit: 45ac74e400f9f2b7dbded66297730f6f14a4eb25
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/16/2018
ms.locfileid: "41826771"
---
<a name="creating-a-business-logic-layer-c"></a><span data-ttu-id="78960-103">Erstellen einer Geschäftslogikebene (c#)</span><span class="sxs-lookup"><span data-stu-id="78960-103">Creating a Business Logic Layer (C#)</span></span>
====================
<span data-ttu-id="78960-104">durch [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="78960-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="78960-105">[Beispiel-App herunter](http://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_2_CS.exe) oder [PDF-Datei herunterladen](creating-a-business-logic-layer-cs/_static/datatutorial02cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="78960-105">[Download Sample App](http://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_2_CS.exe) or [Download PDF](creating-a-business-logic-layer-cs/_static/datatutorial02cs1.pdf)</span></span>

> <span data-ttu-id="78960-106">In diesem Tutorial sehen wir, wie Sie Ihre Geschäftsregeln in eine Geschäftslogikschicht (Business Logic Layer, BLL) zu zentralisieren, das als Zwischenstufe für den Datenaustausch zwischen Präsentationsebene und der DAL dient.</span><span class="sxs-lookup"><span data-stu-id="78960-106">In this tutorial we'll see how to centralize your business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span>


## <a name="introduction"></a><span data-ttu-id="78960-107">Einführung</span><span class="sxs-lookup"><span data-stu-id="78960-107">Introduction</span></span>

<span data-ttu-id="78960-108">(Data Access Layer, DAL) erstellt, der [ersten Tutorial](creating-a-data-access-layer-cs.md) sauber unterteilt die Daten die Darstellungslogik Logik zugreifen.</span><span class="sxs-lookup"><span data-stu-id="78960-108">The Data Access Layer (DAL) created in the [first tutorial](creating-a-data-access-layer-cs.md) cleanly separates the data access logic from the presentation logic.</span></span> <span data-ttu-id="78960-109">Jedoch während die DAL ordnungsgemäß die Details der Zugriff auf der Darstellungsschicht trennt, ist es Business erzwingen keine Regeln, die angewendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="78960-109">However, while the DAL cleanly separates the data access details from the presentation layer, it does not enforce any business rules that may apply.</span></span> <span data-ttu-id="78960-110">Beispielsweise sollten wir für unsere Anwendung verweigert die `CategoryID` oder `SupplierID` Felder der `Products` Tabelle geändert werden, wenn die `Discontinued` Feld auf 1 festgelegt ist, oder wir können Betriebszugehörigkeit Regeln erzwingen Verbot Situationen, in denen ein Mitarbeiter wird von einer Person verwaltet, die Sie eingestellt wurde.</span><span class="sxs-lookup"><span data-stu-id="78960-110">For example, for our application we may want to disallow the `CategoryID` or `SupplierID` fields of the `Products` table to be modified when the `Discontinued` field is set to 1, or we might want to enforce seniority rules, prohibiting situations in which an employee is managed by someone who was hired after them.</span></span> <span data-ttu-id="78960-111">Ein weiteres gängiges Szenario ist Autorisierung vielleicht nur Benutzer in einer bestimmten Rolle können Produkte löschen oder Ändern der `UnitPrice` Wert.</span><span class="sxs-lookup"><span data-stu-id="78960-111">Another common scenario is authorization perhaps only users in a particular role can delete products or can change the `UnitPrice` value.</span></span>

<span data-ttu-id="78960-112">In diesem Tutorial sehen wir, wie Sie die folgende Geschäftsregeln in eine Geschäftslogikschicht (Business Logic Layer, BLL) zu zentralisieren, das als Zwischenstufe für den Datenaustausch zwischen Präsentationsebene und der DAL dient.</span><span class="sxs-lookup"><span data-stu-id="78960-112">In this tutorial we'll see how to centralize these business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span> <span data-ttu-id="78960-113">In einer echten Anwendung sollte die BLL als ein separates Klassenbibliotheksprojekt implementiert werden. allerdings für diese Tutorials implementieren wir die BLL als eine Reihe von Klassen in unserer `App_Code` Ordner aus, um die Projektstruktur zu vereinfachen.</span><span class="sxs-lookup"><span data-stu-id="78960-113">In a real-world application, the BLL should be implemented as a separate Class Library project; however, for these tutorials we'll implement the BLL as a series of classes in our `App_Code` folder in order to simplify the project structure.</span></span> <span data-ttu-id="78960-114">Abbildung 1 zeigt die Architekturen Beziehungen zwischen der Präsentationsebene BLL- und DAL.</span><span class="sxs-lookup"><span data-stu-id="78960-114">Figure 1 illustrates the architectural relationships among the presentation layer, BLL, and DAL.</span></span>


![Die Geschäftslogikschicht trennt die Darstellungsschicht von der Datenzugriffsebene und erzwingt von Geschäftsregeln](creating-a-business-logic-layer-cs/_static/image1.png)

<span data-ttu-id="78960-116">**Abbildung 1**: die BLL trennt die Darstellungsschicht von der Datenzugriffsebene und erzwingt von Geschäftsregeln</span><span class="sxs-lookup"><span data-stu-id="78960-116">**Figure 1**: The BLL Separates the Presentation Layer from the Data Access Layer and Imposes Business Rules</span></span>


## <a name="step-1-creating-the-bll-classes"></a><span data-ttu-id="78960-117">Schritt 1: Erstellen der BLL-Klassen</span><span class="sxs-lookup"><span data-stu-id="78960-117">Step 1: Creating the BLL Classes</span></span>

<span data-ttu-id="78960-118">Unsere BLL werden vier Klassen, die eine für jeden TableAdapter in die DAL erstellt werden; Jede dieser Klassen BLL müssen die Methoden zum Abrufen, einfügen, aktualisieren und löschen aus der jeweiligen TableAdapter in die DAL aus, die entsprechenden Geschäftsregeln anwenden.</span><span class="sxs-lookup"><span data-stu-id="78960-118">Our BLL will be composed of four classes, one for each TableAdapter in the DAL; each of these BLL classes will have methods for retrieving, inserting, updating, and deleting from the respective TableAdapter in the DAL, applying the appropriate business rules.</span></span>

<span data-ttu-id="78960-119">Um mehr sauber trennen Sie die DAL - und BLL-bezogenen Klassen, erstellen wir zwei Unterordner, in der `App_Code` Ordner `DAL` und `BLL`.</span><span class="sxs-lookup"><span data-stu-id="78960-119">To more cleanly separate the DAL- and BLL-related classes, let's create two subfolders in the `App_Code` folder, `DAL` and `BLL`.</span></span> <span data-ttu-id="78960-120">Einfach mit der rechten Maustaste auf die `App_Code` Ordner im Projektmappen-Explorer, und wählen Sie die neuen Ordner.</span><span class="sxs-lookup"><span data-stu-id="78960-120">Simply right-click on the `App_Code` folder in the Solution Explorer and choose New Folder.</span></span> <span data-ttu-id="78960-121">Verschieben Sie nach dem erstellen diese beiden Ordner an, die typisierte DataSet erstellt, die im ersten Tutorial in der `DAL` Unterordner.</span><span class="sxs-lookup"><span data-stu-id="78960-121">After creating these two folders, move the Typed DataSet created in the first tutorial into the `DAL` subfolder.</span></span>

<span data-ttu-id="78960-122">Erstellen Sie als Nächstes die vier Dateien der BLL-Klasse in der `BLL` Unterordner.</span><span class="sxs-lookup"><span data-stu-id="78960-122">Next, create the four BLL class files in the `BLL` subfolder.</span></span> <span data-ttu-id="78960-123">Zu diesem Zweck mit der Maustaste auf die `BLL` Unterordner, wählen Sie ein neues Element hinzufügen, und wählen Sie die Klassenvorlage.</span><span class="sxs-lookup"><span data-stu-id="78960-123">To accomplish this, right-click on the `BLL` subfolder, choose Add a New Item, and choose the Class template.</span></span> <span data-ttu-id="78960-124">Benennen Sie die vier Klassen `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`, und `EmployeesBLL`.</span><span class="sxs-lookup"><span data-stu-id="78960-124">Name the four classes `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`, and `EmployeesBLL`.</span></span>


![Vier neue Klassen in den Ordner "App_Code" hinzufügen](creating-a-business-logic-layer-cs/_static/image2.png)

<span data-ttu-id="78960-126">**Abbildung 2**: Fügen Sie vier neue Klassen in der die `App_Code` Ordner</span><span class="sxs-lookup"><span data-stu-id="78960-126">**Figure 2**: Add Four New Classes to the `App_Code` Folder</span></span>


<span data-ttu-id="78960-127">Als Nächstes fügen Sie Methoden auf jede der Klassen, die für die TableAdapter-Steuerelemente aus dem ersten Lernprogramm definierten Methoden einfach zu umschließen.</span><span class="sxs-lookup"><span data-stu-id="78960-127">Next, let's add methods to each of the classes to simply wrap the methods defined for the TableAdapters from the first tutorial.</span></span> <span data-ttu-id="78960-128">Jetzt werden diese Methoden nur direkt in die DAL aufrufen. höher, um alle erforderlichen Geschäftslogik hinzufügen, zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="78960-128">For now, these methods will just call directly into the DAL; we'll return later to add any needed business logic.</span></span>

> [!NOTE]
> <span data-ttu-id="78960-129">Bei Verwendung von Visual Studio Standard Edition oder höher (d. h., Sie sind *nicht* mit Visual Web Developer), können Sie optional Ihre Klassen, die mithilfe von visuell entwerfen der [Klassen-Designer](https://msdn.microsoft.com/library/default.asp?url=/library/dv_vstechart/html/clssdsgnr.asp).</span><span class="sxs-lookup"><span data-stu-id="78960-129">If you are using Visual Studio Standard Edition or above (that is, you're *not* using Visual Web Developer), you can optionally design your classes visually using the [Class Designer](https://msdn.microsoft.com/library/default.asp?url=/library/dv_vstechart/html/clssdsgnr.asp).</span></span> <span data-ttu-id="78960-130">Finden Sie in der [Klasse Designer Blog](https://blogs.msdn.com/classdesigner/default.aspx) für Weitere Informationen zu diesem neuen Feature in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="78960-130">Refer to the [Class Designer Blog](https://blogs.msdn.com/classdesigner/default.aspx) for more information on this new feature in Visual Studio.</span></span>


<span data-ttu-id="78960-131">Für die `ProductsBLL` Klasse wir insgesamt sieben Methoden hinzufügen müssen:</span><span class="sxs-lookup"><span data-stu-id="78960-131">For the `ProductsBLL` class we need to add a total of seven methods:</span></span>

- <span data-ttu-id="78960-132">`GetProducts()` Alle Produkte zurückgegeben</span><span class="sxs-lookup"><span data-stu-id="78960-132">`GetProducts()` returns all products</span></span>
- <span data-ttu-id="78960-133">`GetProductByProductID(productID)` Gibt das Produkt mit der angegebenen Produkt-ID</span><span class="sxs-lookup"><span data-stu-id="78960-133">`GetProductByProductID(productID)` returns the product with the specified product ID</span></span>
- <span data-ttu-id="78960-134">`GetProductsByCategoryID(categoryID)` Gibt alle Produkte aus der angegebenen Kategorie zurück.</span><span class="sxs-lookup"><span data-stu-id="78960-134">`GetProductsByCategoryID(categoryID)` returns all products from the specified category</span></span>
- <span data-ttu-id="78960-135">`GetProductsBySupplier(supplierID)` Gibt alle Produkte vom angegebenen Anbieter zurück.</span><span class="sxs-lookup"><span data-stu-id="78960-135">`GetProductsBySupplier(supplierID)` returns all products from the specified supplier</span></span>
- <span data-ttu-id="78960-136">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)` Fügt ein neues Produkt in die Datenbank, die mit den Werten übergegebenen; Gibt die `ProductID` Wert des neu eingefügten Datensatzes</span><span class="sxs-lookup"><span data-stu-id="78960-136">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)` inserts a new product into the database using the values passed-in; returns the `ProductID` value of the newly inserted record</span></span>
- <span data-ttu-id="78960-137">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)` aktualisiert ein vorhandenes Produkt mit die übergebenen Werte in der Datenbank; Gibt `true` wenn genau eine Zeile aktualisiert wurde, `false` andernfalls</span><span class="sxs-lookup"><span data-stu-id="78960-137">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)` updates an existing product in the database using the passed-in values; returns `true` if precisely one row was updated, `false` otherwise</span></span>
- <span data-ttu-id="78960-138">`DeleteProduct(productID)` Löscht das angegebene Produkt aus der Datenbank</span><span class="sxs-lookup"><span data-stu-id="78960-138">`DeleteProduct(productID)` deletes the specified product from the database</span></span>

<span data-ttu-id="78960-139">ProductsBLL.cs</span><span class="sxs-lookup"><span data-stu-id="78960-139">ProductsBLL.cs</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample1.cs)]

<span data-ttu-id="78960-140">Die Methoden, die Daten zurückgeben `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`, und `GetProductBySuppliersID` sind eigentlich ziemlich einfach, wie sie in der DAL einfach nach unten rufen.</span><span class="sxs-lookup"><span data-stu-id="78960-140">The methods that simply return data `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`, and `GetProductBySuppliersID` are fairly straightforward as they simply call down into the DAL.</span></span> <span data-ttu-id="78960-141">In einigen Szenarien besteht möglicherweise Geschäftsregeln, die implementiert werden müssen auf dieser Ebene (z. B. die Autorisierungsregeln basierend auf den derzeit angemeldeten Benutzer oder die Rolle, zu denen der Benutzer gehört), lassen wir einfach diese Methoden als-ist.</span><span class="sxs-lookup"><span data-stu-id="78960-141">While in some scenarios there may be business rules that need to be implemented at this level (such as authorization rules based on the currently logged on user or the role to which the user belongs), we'll simply leave these methods as-is.</span></span> <span data-ttu-id="78960-142">Für diese Methode dient dann die BLL nur als ein Proxy, der durch den die Darstellungsschicht die zugrunde liegenden Daten aus der Datenzugriffsebene zugreift.</span><span class="sxs-lookup"><span data-stu-id="78960-142">For these methods, then, the BLL serves merely as a proxy through which the presentation layer accesses the underlying data from the Data Access Layer.</span></span>

<span data-ttu-id="78960-143">Die `AddProduct` und `UpdateProduct` Methoden sowohl sind als Parameter die Werte für die verschiedenen Product-Felder und ein neues Produkt hinzufügen oder Aktualisieren eines bereits vorhandenen, bzw.</span><span class="sxs-lookup"><span data-stu-id="78960-143">The `AddProduct` and `UpdateProduct` methods both take in as parameters the values for the various product fields and add a new product or update an existing one, respectively.</span></span> <span data-ttu-id="78960-144">Da viele der `Product` Tabellenspalten lässt `NULL` Werte (`CategoryID`, `SupplierID`, und `UnitPrice`, um nur einige zu nennen), die Eingabeparameter für `AddProduct` und `UpdateProduct` , die solche Nutzung dann Spalten zugeordnet[auf NULL festlegbare Typen](https://msdn.microsoft.com/library/1t3y8s4s(v=vs.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="78960-144">Since many of the `Product` table's columns can accept `NULL` values (`CategoryID`, `SupplierID`, and `UnitPrice`, to name a few), those input parameters for `AddProduct` and `UpdateProduct` that map to such columns use [nullable types](https://msdn.microsoft.com/library/1t3y8s4s(v=vs.80).aspx).</span></span> <span data-ttu-id="78960-145">Auf NULL festlegbare Typen sind neu in .NET 2.0 und eine Technik bereitzustellen, für sein, der angibt, ob ein Werttyp, stattdessen sollten `null`.</span><span class="sxs-lookup"><span data-stu-id="78960-145">Nullable types are new to .NET 2.0 and provide a technique for indicating whether a value type should, instead, be `null`.</span></span> <span data-ttu-id="78960-146">In c# können Sie einen Werttyp als nullable-Typ kennzeichnen, indem hinzufügen `?` nach dem Typ (z. B. `int? x;`).</span><span class="sxs-lookup"><span data-stu-id="78960-146">In C# you can flag a value type as a nullable type by adding `?` after the type (like `int? x;`).</span></span> <span data-ttu-id="78960-147">Finden Sie in der [auf NULL Festlegbaretypen](https://msdn.microsoft.com/library/1t3y8s4s.aspx) im Abschnitt der [C#-Programmierhandbuch](https://msdn.microsoft.com/library/67ef8sbd%28VS.80%29.aspx) für Weitere Informationen.</span><span class="sxs-lookup"><span data-stu-id="78960-147">Refer to the [Nullable Types](https://msdn.microsoft.com/library/1t3y8s4s.aspx) section in the [C# Programming Guide](https://msdn.microsoft.com/library/67ef8sbd%28VS.80%29.aspx) for more information.</span></span>

<span data-ttu-id="78960-148">Alle drei Methoden geben einen booleschen Wert, der angibt, ob eine Zeile eingefügt, aktualisiert oder gelöscht, da der Vorgang nicht in einer betroffenen Zeile entstehen wurde zurück.</span><span class="sxs-lookup"><span data-stu-id="78960-148">All three methods return a Boolean value indicating whether a row was inserted, updated, or deleted since the operation may not result in an affected row.</span></span> <span data-ttu-id="78960-149">Wenn der Seitenentwickler ruft z. B. `DeleteProduct` übergeben eine `ProductID` für ein Produkt nicht existierende der `DELETE` -Anweisung mit der Datenbank hat keine Auswirkungen und somit auch die `DeleteProduct` Methode zurück `false`.</span><span class="sxs-lookup"><span data-stu-id="78960-149">For example, if the page developer calls `DeleteProduct` passing in a `ProductID` for a non-existent product, the `DELETE` statement issued to the database will have no affect and therefore the `DeleteProduct` method will return `false`.</span></span>

<span data-ttu-id="78960-150">Beachten Sie, dass, wenn Sie ein neues Produkt hinzufügen oder aktualisieren eine vorhandene wir nehmen bei Feldwerten für das neue oder geänderte Produkt als eine Liste von skalaren im Gegensatz zu akzeptieren einen `ProductsRow` Instanz.</span><span class="sxs-lookup"><span data-stu-id="78960-150">Note that when adding a new product or updating an existing one we take in the new or modified product's field values as a list of scalars as opposed to accepting a `ProductsRow` instance.</span></span> <span data-ttu-id="78960-151">Dieser Ansatz wurde gewählt, weil die `ProductsRow` Klasse leitet sich von den ADO.NET `DataRow` -Klasse, die nicht über einen parameterlosen Standardkonstruktor verfügt.</span><span class="sxs-lookup"><span data-stu-id="78960-151">This approach was chosen because the `ProductsRow` class derives from the ADO.NET `DataRow` class, which doesn't have a default parameterless constructor.</span></span> <span data-ttu-id="78960-152">Zum Erstellen eines neuen `ProductsRow` -Instanz muss zunächst erstellen wir eine `ProductsDataTable` -Instanz, und rufen Sie dann die `NewProductRow()` Methode (was der Fall ist im `AddProduct`).</span><span class="sxs-lookup"><span data-stu-id="78960-152">In order to create a new `ProductsRow` instance, we must first create a `ProductsDataTable` instance and then invoke its `NewProductRow()` method (which we do in `AddProduct`).</span></span> <span data-ttu-id="78960-153">Diese Unzulänglichkeit rears den Kopf, wenn wir aktivieren, um das Einfügen und Aktualisieren von Produkten, die mit dem ObjectDataSource-Steuerelement.</span><span class="sxs-lookup"><span data-stu-id="78960-153">This shortcoming rears its head when we turn to inserting and updating products using the ObjectDataSource.</span></span> <span data-ttu-id="78960-154">Kurz gesagt, versucht das ObjectDataSource-Steuerelement zum Erstellen einer Instanz der Eingabeparameter.</span><span class="sxs-lookup"><span data-stu-id="78960-154">In short, the ObjectDataSource will try to create an instance of the input parameters.</span></span> <span data-ttu-id="78960-155">Wenn die BLL-Methode erwartet, dass eine `ProductsRow` -Instanz versucht dem ObjectDataSource-Steuerelement erstellen, aber aufgrund des Mangels an einen Standardkonstruktor ohne Parameter fehl.</span><span class="sxs-lookup"><span data-stu-id="78960-155">If the BLL method expects a `ProductsRow` instance, the ObjectDataSource will try to create one, but fail due to the lack of a default parameterless constructor.</span></span> <span data-ttu-id="78960-156">Weitere Informationen zu diesem Problem finden Sie in den folgenden zwei ASP.NET-Foren-Beiträgen: [ObjectDataSources Strongly-Typed Datasets aktualisieren](https://forums.asp.net/1098630/ShowPost.aspx), und [Problem mit "ObjectDataSource" und Strongly-Typed DataSet](https://forums.asp.net/1048212/ShowPost.aspx).</span><span class="sxs-lookup"><span data-stu-id="78960-156">For more information on this problem, refer to the following two ASP.NET Forums posts: [Updating ObjectDataSources with Strongly-Typed DataSets](https://forums.asp.net/1098630/ShowPost.aspx), and [Problem With ObjectDataSource and Strongly-Typed DataSet](https://forums.asp.net/1048212/ShowPost.aspx).</span></span>

<span data-ttu-id="78960-157">Als Nächstes wird in beiden `AddProduct` und `UpdateProduct`, erstellt der Code eine `ProductsRow` -Instanz, und füllt sie mit der gerade übergebenen Werte.</span><span class="sxs-lookup"><span data-stu-id="78960-157">Next, in both `AddProduct` and `UpdateProduct`, the code creates a `ProductsRow` instance and populates it with the values just passed in.</span></span> <span data-ttu-id="78960-158">Beim Zuweisen von Werten zu DataColumns einer DataRow möglich, verschiedene Überprüfungen auf Feldebene.</span><span class="sxs-lookup"><span data-stu-id="78960-158">When assigning values to DataColumns of a DataRow various field-level validation checks can occur.</span></span> <span data-ttu-id="78960-159">Aus diesem Grund trägt der übergebenen Werte manuell wieder in einer DataRow platzieren die Gültigkeit der Daten, die an die BLL-Methode übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="78960-159">Therefore, manually putting the passed in values back into a DataRow helps ensure the validity of the data being passed to the BLL method.</span></span> <span data-ttu-id="78960-160">Leider verwenden die stark typisierte DataRow-Klassen generiert, die von Visual Studio nicht auf NULL festlegbare Typen.</span><span class="sxs-lookup"><span data-stu-id="78960-160">Unfortunately the strongly-typed DataRow classes generated by Visual Studio do not use nullable types.</span></span> <span data-ttu-id="78960-161">Um anzugeben, dass eine bestimmte DataColumn in einer DataRow entsprechen muss eine `NULL` Datenbank Wert muss die `SetColumnNameNull()` Methode.</span><span class="sxs-lookup"><span data-stu-id="78960-161">Rather, to indicate that a particular DataColumn in a DataRow should correspond to a `NULL` database value we must use the `SetColumnNameNull()` method.</span></span>

<span data-ttu-id="78960-162">In `UpdateProduct` zuerst laden wir das Produkt, das update mit `GetProductByProductID(productID)`.</span><span class="sxs-lookup"><span data-stu-id="78960-162">In `UpdateProduct` we first load in the product to update using `GetProductByProductID(productID)`.</span></span> <span data-ttu-id="78960-163">Dies mag wie eine unnötige Roundtrips zur Datenbank, werden diese zusätzlichen Reise lohnt sich in zukünftigen Lernprogrammen zu prüfen, die vollständigen Parallelität zu untersuchen.</span><span class="sxs-lookup"><span data-stu-id="78960-163">While this may seem like an unnecessary trip to the database, this extra trip will prove worthwhile in future tutorials that explore optimistic concurrency.</span></span> <span data-ttu-id="78960-164">Vollständige Parallelität ist ein Verfahren, um sicherzustellen, dass zwei Benutzer, die gleichzeitig auf denselben Daten arbeiten nicht versehentlich die Änderungen überschrieben.</span><span class="sxs-lookup"><span data-stu-id="78960-164">Optimistic concurrency is a technique to ensure that two users who are simultaneously working on the same data don't accidentally overwrite one another's changes.</span></span> <span data-ttu-id="78960-165">Abrufen des gesamten Datensatzes erleichtert auch zum Erstellen von Update-Methoden in der BLL, die nur eine Teilmenge der DataRow-Spalten zu ändern.</span><span class="sxs-lookup"><span data-stu-id="78960-165">Grabbing the entire record also makes it easier to create update methods in the BLL that only modify a subset of the DataRow's columns.</span></span> <span data-ttu-id="78960-166">Wenn wir untersuchen die `SuppliersBLL` Klasse, die wir sehen uns ein Beispiel dafür.</span><span class="sxs-lookup"><span data-stu-id="78960-166">When we explore the `SuppliersBLL` class we'll see such an example.</span></span>

<span data-ttu-id="78960-167">Beachten Sie schließlich, dass die `ProductsBLL` -Klasse verfügt über die [DataObject-Attributs](https://msdn.microsoft.com/library/system.componentmodel.dataobjectattribute.aspx) angewendet wird (die `[System.ComponentModel.DataObject]` Syntax direkt vor der Class-Anweisung am Anfang der Datei) und die Methoden verfügen über [ DataObjectMethodAttribute Attribute](https://msdn.microsoft.com/library/system.componentmodel.dataobjectmethodattribute.aspx).</span><span class="sxs-lookup"><span data-stu-id="78960-167">Finally, note that the `ProductsBLL` class has the [DataObject attribute](https://msdn.microsoft.com/library/system.componentmodel.dataobjectattribute.aspx) applied to it (the `[System.ComponentModel.DataObject]` syntax right before the class statement near the top of the file) and the methods have [DataObjectMethodAttribute attributes](https://msdn.microsoft.com/library/system.componentmodel.dataobjectmethodattribute.aspx).</span></span> <span data-ttu-id="78960-168">Die `DataObject` -Attribut markiert die Klasse als ein Objekt, das Binden an eine [ObjectDataSource-Steuerelement](https://msdn.microsoft.com/library/9a4kyhcx.aspx), während die `DataObjectMethodAttribute` gibt den Zweck der Methode.</span><span class="sxs-lookup"><span data-stu-id="78960-168">The `DataObject` attribute marks the class as being an object suitable for binding to an [ObjectDataSource control](https://msdn.microsoft.com/library/9a4kyhcx.aspx), whereas the `DataObjectMethodAttribute` indicates the purpose of the method.</span></span> <span data-ttu-id="78960-169">In zukünftigen Lernprogrammen sehen, erleichtert ASP.NET 2.0 "ObjectDataSource" deklarativ Zugriff auf Daten aus einer Klasse.</span><span class="sxs-lookup"><span data-stu-id="78960-169">As we'll see in future tutorials, ASP.NET 2.0's ObjectDataSource makes it easy to declaratively access data from a class.</span></span> <span data-ttu-id="78960-170">Damit können Filtern der Liste der möglichen Klassen im Assistenten für das ObjectDataSource-Steuerelement zu binden, werden standardmäßig nur die Klassen, die als `DataObjects` werden in der Dropdownliste des Assistenten angezeigt.</span><span class="sxs-lookup"><span data-stu-id="78960-170">To help filter the list of possible classes to bind to in the ObjectDataSource's wizard, by default only those classes marked as `DataObjects` are shown in the wizard's drop-down list.</span></span> <span data-ttu-id="78960-171">Die `ProductsBLL` Klasse funktioniert genauso gut ohne diese Attribute, aber Hinzufügens erleichtert es, mit dem ObjectDataSource-Steuerelement-Assistenten zu arbeiten.</span><span class="sxs-lookup"><span data-stu-id="78960-171">The `ProductsBLL` class will work just as well without these attributes, but adding them makes it easier to work with in the ObjectDataSource's wizard.</span></span>

## <a name="adding-the-other-classes"></a><span data-ttu-id="78960-172">Hinzufügen von anderen Klassen</span><span class="sxs-lookup"><span data-stu-id="78960-172">Adding the Other Classes</span></span>

<span data-ttu-id="78960-173">Mit der `ProductsBLL` Klasse nun vollständig, noch müssen Sie die Klassen für das Arbeiten mit Kategorien, Lieferanten und Mitarbeiter hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="78960-173">With the `ProductsBLL` class complete, we still need to add the classes for working with categories, suppliers, and employees.</span></span> <span data-ttu-id="78960-174">Nehmen Sie einen Moment Zeit, um die folgenden Klassen und Methoden, die mit den Konzepten aus dem obigen Beispiel zu erstellen:</span><span class="sxs-lookup"><span data-stu-id="78960-174">Take a moment to create the following classes and methods using the concepts from the example above:</span></span>

- <span data-ttu-id="78960-175">**CategoriesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="78960-175">**CategoriesBLL.cs**</span></span>

    - `GetCategories()`
    - `GetCategoryByCategoryID(categoryID)`
- <span data-ttu-id="78960-176">**SuppliersBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="78960-176">**SuppliersBLL.cs**</span></span>

    - `GetSuppliers()`
    - `GetSupplierBySupplierID(supplierID)`
    - `GetSuppliersByCountry(country)`
    - `UpdateSupplierAddress(supplierID, address, city, country)`
- <span data-ttu-id="78960-177">**EmployeesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="78960-177">**EmployeesBLL.cs**</span></span>

    - `GetEmployees()`
    - `GetEmployeeByEmployeeID(employeeID)`
    - `GetEmployeesByManager(managerID)`

<span data-ttu-id="78960-178">Beachten Sie die Methode ist die `SuppliersBLL` Klasse `UpdateSupplierAddress` Methode.</span><span class="sxs-lookup"><span data-stu-id="78960-178">The one method worth noting is the `SuppliersBLL` class's `UpdateSupplierAddress` method.</span></span> <span data-ttu-id="78960-179">Diese Methode stellt eine Schnittstelle für die Aktualisierung nur Informationen zur Adresse des Lieferanten.</span><span class="sxs-lookup"><span data-stu-id="78960-179">This method provides an interface for updating just the supplier's address information.</span></span> <span data-ttu-id="78960-180">Intern wird diese Methode liest, der `SupplierDataRow` -Objekt für die angegebene `supplierID` (mit `GetSupplierBySupplierID`), dessen Eigenschaften, und klicken Sie dann nach unten in der `SupplierDataTable`des `Update` Methode.</span><span class="sxs-lookup"><span data-stu-id="78960-180">Internally, this method reads in the `SupplierDataRow` object for the specified `supplierID` (using `GetSupplierBySupplierID`), sets its address-related properties, and then calls down into the `SupplierDataTable`'s `Update` method.</span></span> <span data-ttu-id="78960-181">Die `UpdateSupplierAddress` folgt:</span><span class="sxs-lookup"><span data-stu-id="78960-181">The `UpdateSupplierAddress` method follows:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample2.cs)]

<span data-ttu-id="78960-182">Finden Sie in der Download dieses Artikels, für diese vollständige Implementierung der BLL-Klassen.</span><span class="sxs-lookup"><span data-stu-id="78960-182">Refer to this article's download for my complete implementation of the BLL classes.</span></span>

## <a name="step-2-accessing-the-typed-datasets-through-the-bll-classes"></a><span data-ttu-id="78960-183">Schritt 2: Zugreifen auf die typisierten DataSets über die BLL-Klassen</span><span class="sxs-lookup"><span data-stu-id="78960-183">Step 2: Accessing the Typed DataSets Through the BLL Classes</span></span>

<span data-ttu-id="78960-184">Im ersten Tutorial erläutert, Beispiele für das arbeiten direkt mit dem typisierten DataSet programmgesteuert sollten, durch das Hinzufügen von die BLL-Klassen, die Präsentationsebene jedoch funktionieren für die BLL stattdessen.</span><span class="sxs-lookup"><span data-stu-id="78960-184">In the first tutorial we saw examples of working directly with the Typed DataSet programmatically, but with the addition of our BLL classes, the presentation tier should work against the BLL instead.</span></span> <span data-ttu-id="78960-185">In der `AllProducts.aspx` Beispiel aus dem ersten Lernprogramm, das `ProductsTableAdapter` so binden die Liste der Produkte an einer GridView-Ansicht verwendet wurde, wie im folgenden Code gezeigt:</span><span class="sxs-lookup"><span data-stu-id="78960-185">In the `AllProducts.aspx` example from the first tutorial, the `ProductsTableAdapter` was used to bind the list of products to a GridView, as shown in the following code:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample3.cs)]

<span data-ttu-id="78960-186">Verwenden Sie die neue BLL Klassen, das geändert werden muss, ist einfach die erste Zeile des Codes ersetzen die `ProductsTableAdapter` Objekt mit einem `ProductBLL` Objekt:</span><span class="sxs-lookup"><span data-stu-id="78960-186">To use the new BLL classes, all that needs to be changed is the first line of code simply replace the `ProductsTableAdapter` object with a `ProductBLL` object:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample4.cs)]

<span data-ttu-id="78960-187">Die BLL-Klassen können auch mit dem ObjectDataSource-Steuerelement deklarativ (da die typisierte DataSet) zugegriffen werden.</span><span class="sxs-lookup"><span data-stu-id="78960-187">The BLL classes can also be accessed declaratively (as can the Typed DataSet) by using the ObjectDataSource.</span></span> <span data-ttu-id="78960-188">Wir werden ausführlicher zu "ObjectDataSource" in den folgenden Tutorials erläutern.</span><span class="sxs-lookup"><span data-stu-id="78960-188">We'll be discussing the ObjectDataSource in greater detail in the following tutorials.</span></span>


<span data-ttu-id="78960-189">[![Die Liste der Produkte wird in einer GridView-Ansicht angezeigt.](creating-a-business-logic-layer-cs/_static/image4.png)](creating-a-business-logic-layer-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="78960-189">[![The List of Products is Displayed in a GridView](creating-a-business-logic-layer-cs/_static/image4.png)](creating-a-business-logic-layer-cs/_static/image3.png)</span></span>

<span data-ttu-id="78960-190">**Abbildung 3**: die Liste der Produkte in einer GridView-Ansicht angezeigt wird ([klicken Sie, um das Bild in voller Größe anzeigen](creating-a-business-logic-layer-cs/_static/image5.png))</span><span class="sxs-lookup"><span data-stu-id="78960-190">**Figure 3**: The List of Products is Displayed in a GridView ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image5.png))</span></span>


## <a name="step-3-adding-field-level-validation-to-the-datarow-classes"></a><span data-ttu-id="78960-191">Schritt 3: Hinzufügen von Feldebenenvalidierung für die DataRow-Klassen</span><span class="sxs-lookup"><span data-stu-id="78960-191">Step 3: Adding Field-Level Validation to the DataRow Classes</span></span>

<span data-ttu-id="78960-192">Feldebenenvalidierung sind Überprüfungen, die die Eigenschaftswerte die Geschäftsobjekte beim Einfügen oder Aktualisieren von betrifft.</span><span class="sxs-lookup"><span data-stu-id="78960-192">Field-level validation are checks that pertains to the property values of the business objects when inserting or updating.</span></span> <span data-ttu-id="78960-193">Einige Regeln feldebenenvalidierung für Produkte umfassen:</span><span class="sxs-lookup"><span data-stu-id="78960-193">Some field-level validation rules for products include:</span></span>

- <span data-ttu-id="78960-194">Die `ProductName` Feld muss 40 Zeichen oder weniger lang sein.</span><span class="sxs-lookup"><span data-stu-id="78960-194">The `ProductName` field must be 40 characters or less in length</span></span>
- <span data-ttu-id="78960-195">Die `QuantityPerUnit` Feld muss 20 Zeichen oder weniger lang sein.</span><span class="sxs-lookup"><span data-stu-id="78960-195">The `QuantityPerUnit` field must be 20 characters or less in length</span></span>
- <span data-ttu-id="78960-196">Die `ProductID`, `ProductName`, und `Discontinued` Felder sind erforderlich, aber alle anderen Felder sind optional</span><span class="sxs-lookup"><span data-stu-id="78960-196">The `ProductID`, `ProductName`, and `Discontinued` fields are required, but all other fields are optional</span></span>
- <span data-ttu-id="78960-197">Die `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, und `ReorderLevel` Felder müssen größer als oder gleich 0 (null) sein.</span><span class="sxs-lookup"><span data-stu-id="78960-197">The `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` fields must be greater than or equal to zero</span></span>

<span data-ttu-id="78960-198">Diese Regeln können und auf Datenbankebene ausgedrückt werden.</span><span class="sxs-lookup"><span data-stu-id="78960-198">These rules can and should be expressed at the database level.</span></span> <span data-ttu-id="78960-199">Die Zeichenlänge für den `ProductName` und `QuantityPerUnit` Felder werden erfasst, von den Datentypen dieser Spalten in der `Products` Tabelle (`nvarchar(40)` und `nvarchar(20)`bzw.).</span><span class="sxs-lookup"><span data-stu-id="78960-199">The character limit on the `ProductName` and `QuantityPerUnit` fields are captured by the data types of those columns in the `Products` table (`nvarchar(40)` and `nvarchar(20)`, respectively).</span></span> <span data-ttu-id="78960-200">Gibt an, ob Felder erforderlichen und optionalen werden durch ausgedrückt werden, wenn die Datenbanktabellen-Spalte erlaubt `NULL` s.</span><span class="sxs-lookup"><span data-stu-id="78960-200">Whether fields are required and optional are expressed by if the database table column allows `NULL` s.</span></span> <span data-ttu-id="78960-201">Vier [check-Einschränkungen](https://msdn.microsoft.com/library/ms188258.aspx) vorhanden sind nur Werte größer als oder gleich 0 (null) in herstellen können, sicherzustellen, dass die `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, oder `ReorderLevel` Spalten.</span><span class="sxs-lookup"><span data-stu-id="78960-201">Four [check constraints](https://msdn.microsoft.com/library/ms188258.aspx) exist that ensure that only values greater than or equal to zero can make it into the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` columns.</span></span>

<span data-ttu-id="78960-202">Zusätzlich zum Erzwingen dieser Regeln in der Datenbank sollten sie auch auf Datensatzebene erzwungen werden.</span><span class="sxs-lookup"><span data-stu-id="78960-202">In addition to enforcing these rules at the database they should also be enforced at the DataSet level.</span></span> <span data-ttu-id="78960-203">In der Tat werden die Feldlänge und gibt an, ob ein Wert erforderlich oder optional ist bereits für jede DataTable-Satz von DataColumns erfasst.</span><span class="sxs-lookup"><span data-stu-id="78960-203">In fact, the field length and whether a value is required or optional are already captured for each DataTable's set of DataColumns.</span></span> <span data-ttu-id="78960-204">Um die vorhandenen feldebenenvalidierung automatisch anzuzeigen, wechseln Sie zur DataSet-Designer, wählen Sie ein Feld aus einem der vorhandenen DataTables, und fahren Sie mit dem Fenster "Eigenschaften".</span><span class="sxs-lookup"><span data-stu-id="78960-204">To see the existing field-level validation automatically provided, go to the DataSet Designer, select a field from one of the DataTables and then go to the Properties window.</span></span> <span data-ttu-id="78960-205">Wie in Abbildung 4 gezeigt, die `QuantityPerUnit` DataColumn in die `ProductsDataTable` hat eine maximale Länge von 20 Zeichen und lässt `NULL` Werte.</span><span class="sxs-lookup"><span data-stu-id="78960-205">As Figure 4 shows, the `QuantityPerUnit` DataColumn in the `ProductsDataTable` has a maximum length of 20 characters and does allow `NULL` values.</span></span> <span data-ttu-id="78960-206">Wenn wir versuchen, legen Sie die `ProductsDataRow`des `QuantityPerUnit` Eigenschaft in einen Zeichenfolgenwert, der mehr als 20 Zeichen ein `ArgumentException` ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="78960-206">If we attempt to set the `ProductsDataRow`'s `QuantityPerUnit` property to a string value longer than 20 characters an `ArgumentException` will be thrown.</span></span>


<span data-ttu-id="78960-207">[![Die Datenspalte stellt grundlegende Feldebenenvalidierung](creating-a-business-logic-layer-cs/_static/image7.png)](creating-a-business-logic-layer-cs/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="78960-207">[![The DataColumn Provides Basic Field-Level Validation](creating-a-business-logic-layer-cs/_static/image7.png)](creating-a-business-logic-layer-cs/_static/image6.png)</span></span>

<span data-ttu-id="78960-208">**Abbildung 4**: der DataColumn bietet grundlegende Feldebenenvalidierung ([klicken Sie, um das Bild in voller Größe anzeigen](creating-a-business-logic-layer-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="78960-208">**Figure 4**: The DataColumn Provides Basic Field-Level Validation ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image8.png))</span></span>


<span data-ttu-id="78960-209">Leider kann nicht angegeben Grenzen Überprüfungen, z. B. die `UnitPrice` Wert muss größer als oder gleich 0 (null), über das Eigenschaftenfenster.</span><span class="sxs-lookup"><span data-stu-id="78960-209">Unfortunately, we can't specify bounds checks, such as the `UnitPrice` value must be greater than or equal to zero, through the Properties window.</span></span> <span data-ttu-id="78960-210">Um diese Art von feldebenenvalidierung bereitstellen müssen wir einen Ereignishandler für die der DataTable erstellen [ColumnChanging](https://msdn.microsoft.com/library/system.data.datatable.columnchanging%28VS.80%29.aspx) Ereignis.</span><span class="sxs-lookup"><span data-stu-id="78960-210">In order to provide this type of field-level validation we need to create an event handler for the DataTable's [ColumnChanging](https://msdn.microsoft.com/library/system.data.datatable.columnchanging%28VS.80%29.aspx) event.</span></span> <span data-ttu-id="78960-211">Siehe die [vorherigen Lernprogramm](creating-a-data-access-layer-cs.md), die Datasets, DataTables und DataRow-Objekte, die durch das typisierte DataSet erstellt, die durch die Verwendung von partiellen Klassen erweitert werden können.</span><span class="sxs-lookup"><span data-stu-id="78960-211">As mentioned in the [preceding tutorial](creating-a-data-access-layer-cs.md), the DataSet, DataTables, and DataRow objects created by the Typed DataSet can be extended through the use of partial classes.</span></span> <span data-ttu-id="78960-212">Mithilfe dieser Technik können wir erstellen eine `ColumnChanging` -Ereignishandler für die `ProductsDataTable` Klasse.</span><span class="sxs-lookup"><span data-stu-id="78960-212">Using this technique we can create a `ColumnChanging` event handler for the `ProductsDataTable` class.</span></span> <span data-ttu-id="78960-213">Zunächst erstellen Sie eine Klasse in der `App_Code` Ordner mit dem Namen `ProductsDataTable.ColumnChanging.cs`.</span><span class="sxs-lookup"><span data-stu-id="78960-213">Start by creating a class in the `App_Code` folder named `ProductsDataTable.ColumnChanging.cs`.</span></span>


<span data-ttu-id="78960-214">[![Fügen Sie eine neue Klasse, zu dem Ordner "App_Code"](creating-a-business-logic-layer-cs/_static/image10.png)](creating-a-business-logic-layer-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="78960-214">[![Add a New Class to the App_Code Folder](creating-a-business-logic-layer-cs/_static/image10.png)](creating-a-business-logic-layer-cs/_static/image9.png)</span></span>

<span data-ttu-id="78960-215">**Abbildung 5**: Fügen Sie eine neue Klasse, die `App_Code` Ordner ([klicken Sie, um das Bild in voller Größe anzeigen](creating-a-business-logic-layer-cs/_static/image11.png))</span><span class="sxs-lookup"><span data-stu-id="78960-215">**Figure 5**: Add a New Class to the `App_Code` Folder ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image11.png))</span></span>


<span data-ttu-id="78960-216">Als Nächstes erstellen Sie einen Ereignishandler für die `ColumnChanging` -Ereignis, das wird, dass sichergestellt die `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, und `ReorderLevel` Spaltenwerte (Wenn dies nicht der `NULL`) größer als oder gleich 0 (null).</span><span class="sxs-lookup"><span data-stu-id="78960-216">Next, create an event handler for the `ColumnChanging` event that ensures that the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` column values (if not `NULL`) are greater than or equal to zero.</span></span> <span data-ttu-id="78960-217">Wenn solche Spalte außerhalb des gültigen Bereichs ist, löst eine `ArgumentException`.</span><span class="sxs-lookup"><span data-stu-id="78960-217">If any such column is out of range, throw an `ArgumentException`.</span></span>

<span data-ttu-id="78960-218">ProductsDataTable.ColumnChanging.cs</span><span class="sxs-lookup"><span data-stu-id="78960-218">ProductsDataTable.ColumnChanging.cs</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample5.cs)]

## <a name="step-4-adding-custom-business-rules-to-the-blls-classes"></a><span data-ttu-id="78960-219">Schritt 4: Hinzufügen von benutzerdefinierten Geschäftsregeln für die BLL Klassen</span><span class="sxs-lookup"><span data-stu-id="78960-219">Step 4: Adding Custom Business Rules to the BLL's Classes</span></span>

<span data-ttu-id="78960-220">Zusätzlich zu feldebenenvalidierung möglicherweise auf hoher Ebene benutzerdefinierte Geschäftsregeln, die unterschiedliche Entitäten oder Konzepte, die Ebene der einzelnen Spalte nicht ausgedrückt werden kann, wie z. B. umfassen:</span><span class="sxs-lookup"><span data-stu-id="78960-220">In addition to field-level validation, there may be high-level custom business rules that involve different entities or concepts not expressible at the single column level, such as:</span></span>

- <span data-ttu-id="78960-221">Wenn ein Produkt nicht mehr lieferbar ist, dessen `UnitPrice` kann nicht aktualisiert werden</span><span class="sxs-lookup"><span data-stu-id="78960-221">If a product is discontinued, its `UnitPrice` cannot be updated</span></span>
- <span data-ttu-id="78960-222">Herkunftsland eines Mitarbeiters muss ihren Vorgesetzten Herkunftsland identisch sein.</span><span class="sxs-lookup"><span data-stu-id="78960-222">An employee's country of residence must be the same as their manager's country of residence</span></span>
- <span data-ttu-id="78960-223">Ein Produkt kann nicht eingestellt werden, ist dies das einzige Produkt, die von den Lieferanten bereitgestellte</span><span class="sxs-lookup"><span data-stu-id="78960-223">A product cannot be discontinued if it is the only product provided by the supplier</span></span>

<span data-ttu-id="78960-224">Die BLL Klassen sollten Überprüfungen zum Sicherstellen der Einhaltung von der Anwendung von Geschäftsregeln enthalten.</span><span class="sxs-lookup"><span data-stu-id="78960-224">The BLL classes should contain checks to ensure adherence to the application's business rules.</span></span> <span data-ttu-id="78960-225">Diese Überprüfungen können direkt auf die Methoden hinzugefügt werden, für die sie gelten.</span><span class="sxs-lookup"><span data-stu-id="78960-225">These checks can be added directly to the methods to which they apply.</span></span>

<span data-ttu-id="78960-226">Angenommen Sie, die unsere Geschäftsregeln vorgeben, dass ein Produkt nicht nicht mehr unterstützte gekennzeichnet werden konnte, wenn es das einzige Produkt von einem bestimmten Lieferanten war.</span><span class="sxs-lookup"><span data-stu-id="78960-226">Imagine that our business rules dictate that a product could not be marked discontinued if it was the only product from a given supplier.</span></span> <span data-ttu-id="78960-227">D. h. wenn Produkt *X* das einzige Produkt, das wir vom Lieferanten erworben wurde *Y*, wir konnte nicht gekennzeichnet werden *X* wie; wenn Sie nicht mehr unterstützt jedoch Lieferanten *Y*uns mit drei Produkte bereitgestellten *ein*, *B*, und *C*konnten wir alle markieren und anschließend alle diese als nicht mehr unterstützt.</span><span class="sxs-lookup"><span data-stu-id="78960-227">That is, if product *X* was the only product we purchased from supplier *Y*, we could not mark *X* as discontinued; if, however, supplier *Y* supplied us with three products, *A*, *B*, and *C*, then we could mark any and all of these as discontinued.</span></span> <span data-ttu-id="78960-228">Eine ungerade Geschäftsregel, aber von Geschäftsregeln und gesundem Menschenverstand zu tun, sind nicht immer ausgerichtet.</span><span class="sxs-lookup"><span data-stu-id="78960-228">An odd business rule, but business rules and common sense aren't always aligned!</span></span>

<span data-ttu-id="78960-229">Erzwingen Sie diese Geschäftsregel in die `UpdateProducts` Methode, die wir überprüft zunächst, ob `Discontinued` wurde `true` und, wenn wir also aufrief `GetProductsBySupplierID` um zu bestimmen, wie viele Produkte, die wir von anderen Lieferanten des Produkts erworben.</span><span class="sxs-lookup"><span data-stu-id="78960-229">To enforce this business rule in the `UpdateProducts` method we'd start by checking if `Discontinued` was set to `true` and, if so, we'd call `GetProductsBySupplierID` to determine how many products we purchased from this product's supplier.</span></span> <span data-ttu-id="78960-230">Wenn nur ein Produkt aus diesem Lieferanten erworben wird, lösen wir eine `ApplicationException`.</span><span class="sxs-lookup"><span data-stu-id="78960-230">If only one product is purchased from this supplier, we throw an `ApplicationException`.</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample6.cs)]

## <a name="responding-to-validation-errors-in-the-presentation-tier"></a><span data-ttu-id="78960-231">Reagieren auf Validierungsfehler, die in der Präsentationsebene</span><span class="sxs-lookup"><span data-stu-id="78960-231">Responding to Validation Errors in the Presentation Tier</span></span>

<span data-ttu-id="78960-232">Beim Aufrufen der BLL von der Präsentationsebene können wir entscheiden, ob versucht, alle Ausnahmen zu behandeln, die möglicherweise ausgelöst werden, oder kann es bis zu ASP.NET zu übergeben (ausgelöst der `HttpApplication`des `Error` Ereignis).</span><span class="sxs-lookup"><span data-stu-id="78960-232">When calling the BLL from the presentation tier we can decide whether to attempt to handle any exceptions that might be raised or let them bubble up to ASP.NET (which will raise the `HttpApplication`'s `Error` event).</span></span> <span data-ttu-id="78960-233">Um eine Ausnahme behandeln, wenn Sie mit der BLL programmgesteuert arbeiten, können wir eine [try … Catch](https://msdn.microsoft.com/library/0yd65esw.aspx) blockieren, wie im folgenden Beispiel gezeigt:</span><span class="sxs-lookup"><span data-stu-id="78960-233">To handle an exception when working with the BLL programmatically, we can use a [try...catch](https://msdn.microsoft.com/library/0yd65esw.aspx) block, as the following example shows:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample7.cs)]

<span data-ttu-id="78960-234">Wie wir uns in Zukunft Lernprogramme sehen, Behandlung von Ausnahmen, die Paketfehler der BLL, die bei Verwendung eines-Steuerelement für das Einfügen Webserver, aktualisieren oder Löschen von Daten direkt in einem Ereignishandler statt Code zu umschließen verarbeitet werden kann `try...catch` Blöcke.</span><span class="sxs-lookup"><span data-stu-id="78960-234">As we'll see in future tutorials, handling exceptions that bubble up from the BLL when using a data Web control for inserting, updating, or deleting data can be handled directly in an event handler as opposed to having to wrap code in `try...catch` blocks.</span></span>

## <a name="summary"></a><span data-ttu-id="78960-235">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="78960-235">Summary</span></span>

<span data-ttu-id="78960-236">Eine gut entwickelte Anwendung ist in unterschiedliche Ebenen erstellt, von denen jede eine bestimmte Rolle umfassen.</span><span class="sxs-lookup"><span data-stu-id="78960-236">A well architected application is crafted into distinct layers, each of which encapsulates a particular role.</span></span> <span data-ttu-id="78960-237">Im ersten Tutorial dieser Reihe Artikel haben wir eine Datenzugriffsschicht, die mit typisierten DataSets erstellt; In diesem Tutorial wir eine Geschäftslogikebene als erstellt eine Reihe von Klassen in der Anwendung `App_Code` Ordner, der in der DAL aufrufen.</span><span class="sxs-lookup"><span data-stu-id="78960-237">In the first tutorial of this article series we created a Data Access Layer using Typed DataSets; in this tutorial we built a Business Logic Layer as a series of classes in our application's `App_Code` folder that call down into our DAL.</span></span> <span data-ttu-id="78960-238">Die Geschäftslogikschicht implementiert die Logik auf und Business-Ebene für die Anwendung.</span><span class="sxs-lookup"><span data-stu-id="78960-238">The BLL implements the field-level and business-level logic for our application.</span></span> <span data-ttu-id="78960-239">Zusätzlich zur Erstellung einer separaten BLL, wie in diesem Tutorial ist eine weitere Option die TableAdapter Methoden durch die Verwendung von partiellen Klassen zu erweitern.</span><span class="sxs-lookup"><span data-stu-id="78960-239">In addition to creating a separate BLL, as we did in this tutorial, another option is to extend the TableAdapters' methods through the use of partial classes.</span></span> <span data-ttu-id="78960-240">Mithilfe dieser Technik ist gestattet es uns nicht zum Überschreiben der vorhandener Methoden werden jedoch noch ist es trennen DAL und unsere BLL ordnungsgemäß als der Ansatz, den wir in diesem Artikel erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="78960-240">However, using this technique does not allow us to override existing methods nor does it separate our DAL and our BLL as cleanly as the approach we've taken in this article.</span></span>

<span data-ttu-id="78960-241">Der DAL und der BLL abgeschlossen können wir auf unsere Darstellungsschicht zu starten.</span><span class="sxs-lookup"><span data-stu-id="78960-241">With the DAL and BLL complete, we're ready to start on our presentation layer.</span></span> <span data-ttu-id="78960-242">In der [nächsten Tutorial](master-pages-and-site-navigation-cs.md) wir einen kurzen Umweg in den Themen zum Zugriff auf Daten nehmen und ein Seitenlayout einheitliche für die Verwendung in den Tutorials zu definieren.</span><span class="sxs-lookup"><span data-stu-id="78960-242">In the [next tutorial](master-pages-and-site-navigation-cs.md) we'll take a brief detour from data access topics and define a consistent page layout for use throughout the tutorials.</span></span>

<span data-ttu-id="78960-243">Viel Spaß beim Programmieren!</span><span class="sxs-lookup"><span data-stu-id="78960-243">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="78960-244">Der Autor</span><span class="sxs-lookup"><span data-stu-id="78960-244">About the Author</span></span>

<span data-ttu-id="78960-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), Autor von sieben Büchern zu ASP/ASP.NET und Gründer von [4GuysFromRolla.com](http://www.4guysfromrolla.com), arbeitet mit Microsoft-Web-Technologien seit 1998.</span><span class="sxs-lookup"><span data-stu-id="78960-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="78960-246">Er ist als ein unabhängiger Berater, Schulungsleiter und Autor.</span><span class="sxs-lookup"><span data-stu-id="78960-246">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="78960-247">Sein neueste Buch wird [*Sams Schulen selbst ASP.NET 2.0 in 24 Stunden*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="78960-247">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="78960-248">Er ist unter [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="78960-248">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="78960-249">oder über seinen Blog finden Sie unter [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="78960-249">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="78960-250">Besonderen Dank an</span><span class="sxs-lookup"><span data-stu-id="78960-250">Special Thanks To</span></span>

<span data-ttu-id="78960-251">Diese tutorialreihe wurde durch viele hilfreiche Reviewer überprüft.</span><span class="sxs-lookup"><span data-stu-id="78960-251">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="78960-252">Führendes Prüfer für dieses Tutorial wurden Liz Shulok, Dennis Patterson, Carlos Santos und Hilton Giesenow.</span><span class="sxs-lookup"><span data-stu-id="78960-252">Lead reviewers for this tutorial were Liz Shulok, Dennis Patterson, Carlos Santos, and Hilton Giesenow.</span></span> <span data-ttu-id="78960-253">Meine zukünftigen MSDN-Artikeln überprüfen möchten?</span><span class="sxs-lookup"><span data-stu-id="78960-253">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="78960-254">Wenn dies der Fall ist, löschen Sie mir eine Linie an [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="78960-254">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="78960-255">[Zurück](creating-a-data-access-layer-cs.md)
> [Weiter](master-pages-and-site-navigation-cs.md)</span><span class="sxs-lookup"><span data-stu-id="78960-255">[Previous](creating-a-data-access-layer-cs.md)
[Next](master-pages-and-site-navigation-cs.md)</span></span>
