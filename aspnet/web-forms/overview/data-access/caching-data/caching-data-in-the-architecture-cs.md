---
uid: web-forms/overview/data-access/caching-data/caching-data-in-the-architecture-cs
title: Zwischenspeichern von Daten in der Architektur (c#) | Microsoft-Dokumentation
author: rick-anderson
description: Im vorherigen Tutorial haben wir wie zwischengespeichert werden auf der Darstellungsschicht. In diesem Tutorial erfahren wir, wie unsere mehrstufigen Architectu nutzen...
ms.author: aspnetcontent
manager: wpickett
ms.date: 05/30/2007
ms.topic: article
ms.assetid: d29a7c41-0628-4a23-9dfc-bfea9c6c1054
ms.technology: dotnet-webforms
msc.legacyurl: /web-forms/overview/data-access/caching-data/caching-data-in-the-architecture-cs
msc.type: authoredcontent
ms.openlocfilehash: 20c3c0cb5f3d13e66fbbceab77083c89f3015c53
ms.sourcegitcommit: 953ff9ea4369f154d6fd0239599279ddd3280009
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 07/03/2018
ms.locfileid: "37402908"
---
<a name="caching-data-in-the-architecture-c"></a><span data-ttu-id="a9738-104">Zwischenspeichern von Daten in der Architektur (c#)</span><span class="sxs-lookup"><span data-stu-id="a9738-104">Caching Data in the Architecture (C#)</span></span>
====================
<span data-ttu-id="a9738-105">durch [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="a9738-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="a9738-106">[Beispiel-App herunter](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_59_CS.exe) oder [PDF-Datei herunterladen](caching-data-in-the-architecture-cs/_static/datatutorial59cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="a9738-106">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_59_CS.exe) or [Download PDF](caching-data-in-the-architecture-cs/_static/datatutorial59cs1.pdf)</span></span>

> <span data-ttu-id="a9738-107">Im vorherigen Tutorial haben wir wie zwischengespeichert werden auf der Darstellungsschicht.</span><span class="sxs-lookup"><span data-stu-id="a9738-107">In the previous tutorial we learned how to apply caching at the Presentation Layer.</span></span> <span data-ttu-id="a9738-108">In diesem Tutorial erfahren wir, wie unsere mehrstufigen Architektur zum Zwischenspeichern von Daten an die Geschäftslogikschicht nutzen.</span><span class="sxs-lookup"><span data-stu-id="a9738-108">In this tutorial we learn how to take advantage of our layered architecture to cache data at the Business Logic Layer.</span></span> <span data-ttu-id="a9738-109">Dies erfolgt durch Erweitern der Architektur eine Caching-Schicht enthält.</span><span class="sxs-lookup"><span data-stu-id="a9738-109">We do this by extending the architecture to include a Caching Layer.</span></span>


## <a name="introduction"></a><span data-ttu-id="a9738-110">Einführung</span><span class="sxs-lookup"><span data-stu-id="a9738-110">Introduction</span></span>

<span data-ttu-id="a9738-111">Wie wir im vorherigen Tutorial gesehen haben, ist das Zwischenspeichern der "ObjectDataSource"-s-Daten so einfach wie eine Reihe von Eigenschaften festlegen.</span><span class="sxs-lookup"><span data-stu-id="a9738-111">As we saw in the preceding tutorial, caching the ObjectDataSource s data is as simple as setting a couple of properties.</span></span> <span data-ttu-id="a9738-112">Leider wendet dem ObjectDataSource-Steuerelement auf der Darstellungsschicht, die Richtlinien für die Zwischenspeicherung eng mit der ASP.NET-Seite koppelt Zwischenspeichern.</span><span class="sxs-lookup"><span data-stu-id="a9738-112">Unfortunately, the ObjectDataSource applies caching at the Presentation Layer, which tightly couples the caching policies with the ASP.NET page.</span></span> <span data-ttu-id="a9738-113">Einer der Gründe für das Erstellen einer mehrschichtigen Architektur ist, können solche Kopplungen unterbrochen werden.</span><span class="sxs-lookup"><span data-stu-id="a9738-113">One of the reasons for creating a layered architecture is to allow such couplings to be broken.</span></span> <span data-ttu-id="a9738-114">Die Business Logic Layer, entkoppelt die Geschäftslogik von der ASP.NET-Seiten aus aufzurufen, z. B., während der Datenzugriffsschicht der zum Datenzugriff entkoppelt.</span><span class="sxs-lookup"><span data-stu-id="a9738-114">The Business Logic Layer, for instance, decouples the business logic from the ASP.NET pages, while the Data Access Layer decouples the data access details.</span></span> <span data-ttu-id="a9738-115">Dieses Entkoppeln von Business-Logik und Daten Zugriffsdetails wird bevorzugt, Teil, da das System besser lesbar, besser verwaltbar und flexibler zu ändern ist.</span><span class="sxs-lookup"><span data-stu-id="a9738-115">This decoupling of business logic and data access details is preferred, in part, because it makes the system more readable, more maintainable, and more flexible to change.</span></span> <span data-ttu-id="a9738-116">Außerdem können für domänenwissen und Verteilung der Arbeit, die ein Entwickler die Darstellungsschicht t mit den Datenbank-s-Details vertraut sein, um ihre Arbeit benötigen.</span><span class="sxs-lookup"><span data-stu-id="a9738-116">It also allows for domain knowledge and division of labor a developer working on the Presentation Layer doesn t need to be familiar with the database s details in order to do her job.</span></span> <span data-ttu-id="a9738-117">Trennen die Richtlinie für die Zwischenspeicherung auf der Darstellungsschicht bietet ähnliche Vorteile.</span><span class="sxs-lookup"><span data-stu-id="a9738-117">Decoupling the caching policy from the Presentation Layer offers similar benefits.</span></span>

<span data-ttu-id="a9738-118">In diesem Tutorial werden wir zu unserer Architektur sollen Erweitern einer *Caching-Schicht* (oder CL kurz), die unsere Cacherichtlinie verwendet.</span><span class="sxs-lookup"><span data-stu-id="a9738-118">In this tutorial we will augment our architecture to include a *Caching Layer* (or CL for short) that employs our caching policy.</span></span> <span data-ttu-id="a9738-119">Der Caching-Schicht umfasst eine `ProductsCL` -Klasse, die Zugriff auf Produktinformationen mit Methoden wie ermöglicht `GetProducts()`, `GetProductsByCategoryID(categoryID)`und so weiter, wenn aufgerufen, beim ersten Versuch zum Abrufen der Daten aus dem Cache wird.</span><span class="sxs-lookup"><span data-stu-id="a9738-119">The Caching Layer will include a `ProductsCL` class that provides access to product information with methods like `GetProducts()`, `GetProductsByCategoryID(categoryID)`, and so forth, that, when invoked, will first attempt to retrieve the data from the cache.</span></span> <span data-ttu-id="a9738-120">Wenn der Cache leer ist, werden diese Methoden der entsprechenden Aufrufen `ProductsBLL` -Methode in der die BLL, die wiederum die DAL die Daten erhalten würde.</span><span class="sxs-lookup"><span data-stu-id="a9738-120">If the cache is empty, these methods will invoke the appropriate `ProductsBLL` method in the BLL, which would in turn get the data from the DAL.</span></span> <span data-ttu-id="a9738-121">Die `ProductsCL` Methoden Zwischenspeichern der BLL vor der Rückgabe abgerufenen Daten.</span><span class="sxs-lookup"><span data-stu-id="a9738-121">The `ProductsCL` methods cache the data retrieved from the BLL before returning it.</span></span>

<span data-ttu-id="a9738-122">Wie in Abbildung 1 gezeigt, befindet sich die CL zwischen der Präsentations- und Geschäftslogikschichten ein.</span><span class="sxs-lookup"><span data-stu-id="a9738-122">As Figure 1 shows, the CL resides between the Presentation and Business Logic Layers.</span></span>


![Das Zwischenspeichern von Ebene (CL) wird einer anderen Ebene in unsere-Architektur](caching-data-in-the-architecture-cs/_static/image1.png)

<span data-ttu-id="a9738-124">**Abbildung 1**: das Zwischenspeichern von Ebene (CL) wird einer anderen Ebene in unsere-Architektur</span><span class="sxs-lookup"><span data-stu-id="a9738-124">**Figure 1**: The Caching Layer (CL) is Another Layer in Our Architecture</span></span>


## <a name="step-1-creating-the-caching-layer-classes"></a><span data-ttu-id="a9738-125">Schritt 1: Erstellen der Zwischenspeicherung Layer-Klassen</span><span class="sxs-lookup"><span data-stu-id="a9738-125">Step 1: Creating the Caching Layer Classes</span></span>

<span data-ttu-id="a9738-126">In diesem Tutorial erstellen wir eine sehr einfache CL mit einer einzelnen Klasse `ProductsCL` , bei dem nur eine Handvoll Methoden.</span><span class="sxs-lookup"><span data-stu-id="a9738-126">In this tutorial we will create a very simple CL with a single class `ProductsCL` that has only a handful of methods.</span></span> <span data-ttu-id="a9738-127">Erstellen eine vollständige Caching-Schicht für die gesamte Anwendung erstellen müssten `CategoriesCL`, `EmployeesCL`, und `SuppliersCL` Klassen und eine Methode in diesen Klassen Caching-Schicht für jede Data-Zugriff oder Änderung-Methode, in die BLL bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="a9738-127">Building a complete Caching Layer for the entire application would require creating `CategoriesCL`, `EmployeesCL`, and `SuppliersCL` classes, and providing a method in these Caching Layer classes for each data access or modification method in the BLL.</span></span> <span data-ttu-id="a9738-128">Im Idealfall sollte der Caching-Schicht als ein separates Klassenbibliotheksprojekt implementiert werden, wie bei den BLL- und DAL. aber wir implementieren sie als Klasse in der `App_Code` Ordner.</span><span class="sxs-lookup"><span data-stu-id="a9738-128">As with the BLL and DAL, the Caching Layer should ideally be implemented as a separate Class Library project; however, we will implement it as a class in the `App_Code` folder.</span></span>

<span data-ttu-id="a9738-129">Auf Weitere sauber Separate CL-Klassen von der DAL und BLL-Klasse, Let s erstellen Sie einen neuen Unterordner in der `App_Code` Ordner.</span><span class="sxs-lookup"><span data-stu-id="a9738-129">To more cleanly separate the CL classes from the DAL and BLL classes, let s create a new subfolder in the `App_Code` folder.</span></span> <span data-ttu-id="a9738-130">Mit der rechten Maustaste auf die `App_Code` Ordner im Projektmappen-Explorer, wählen Sie die neuen Ordner, und nennen Sie diesen Ordner `CL`.</span><span class="sxs-lookup"><span data-stu-id="a9738-130">Right-click on the `App_Code` folder in the Solution Explorer, choose New Folder, and name the new folder `CL`.</span></span> <span data-ttu-id="a9738-131">Nach der Erstellung dieses Ordners, hinzufügen, eine neue Klasse namens `ProductsCL.cs`.</span><span class="sxs-lookup"><span data-stu-id="a9738-131">After creating this folder, add to it a new class named `ProductsCL.cs`.</span></span>


![Fügen Sie einen neuen Ordner namens CL und eine Klasse namens ProductsCL.cs hinzu](caching-data-in-the-architecture-cs/_static/image2.png)

<span data-ttu-id="a9738-133">**Abbildung 2**: Fügen Sie einen neuen Ordner namens `CL` und eine Klasse, die mit dem Namen `ProductsCL.cs`</span><span class="sxs-lookup"><span data-stu-id="a9738-133">**Figure 2**: Add a New Folder Named `CL` and a Class Named `ProductsCL.cs`</span></span>


<span data-ttu-id="a9738-134">Die `ProductsCL` -Klasse sollte den gleichen Satz von Daten und Methoden, wie in der entsprechenden Business Logic Layer-Klasse enthalten (`ProductsBLL`).</span><span class="sxs-lookup"><span data-stu-id="a9738-134">The `ProductsCL` class should include the same set of data access and modification methods as found in its corresponding Business Logic Layer class (`ProductsBLL`).</span></span> <span data-ttu-id="a9738-135">Anstatt alle von diesen Methoden können s bauen Sie einfach einige hier um ein Gefühl für die Muster, die von der CL verwendet.</span><span class="sxs-lookup"><span data-stu-id="a9738-135">Rather than creating all of these methods, let s just build a couple here to get a feel for the patterns used by the CL.</span></span> <span data-ttu-id="a9738-136">Wir fügen insbesondere die `GetProducts()` und `GetProductsByCategoryID(categoryID)` Methoden in Schritt 3 und ein `UpdateProduct` überladen, die in Schritt 4.</span><span class="sxs-lookup"><span data-stu-id="a9738-136">In particular, we'll add the `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods in Step 3 and an `UpdateProduct` overload in Step 4.</span></span> <span data-ttu-id="a9738-137">Sie können hinzufügen, die verbleibenden `ProductsCL` Methoden und `CategoriesCL`, `EmployeesCL`, und `SuppliersCL` Klassen in aller Ruhe.</span><span class="sxs-lookup"><span data-stu-id="a9738-137">You can add the remaining `ProductsCL` methods and `CategoriesCL`, `EmployeesCL`, and `SuppliersCL` classes at your leisure.</span></span>

## <a name="step-2-reading-and-writing-to-the-data-cache"></a><span data-ttu-id="a9738-138">Schritt 2: Lesen und Schreiben in Datencache</span><span class="sxs-lookup"><span data-stu-id="a9738-138">Step 2: Reading and Writing to the Data Cache</span></span>

<span data-ttu-id="a9738-139">Dem ObjectDataSource-Steuerelement Zwischenspeicherfeature, die in den vorherigen Tutorials behandelt wurde, intern verwendet das Datencache ASP.NET zum Speichern der Daten, die von der BLL abgerufen.</span><span class="sxs-lookup"><span data-stu-id="a9738-139">The ObjectDataSource caching feature explored in the preceding tutorial internally uses the ASP.NET data cache to store the data retrieved from the BLL.</span></span> <span data-ttu-id="a9738-140">Das Datencache kann auch programmgesteuert aus ASP.NET Seiten CodeBehind- oder von den Klassen in die Architektur der Webanwendung s zugegriffen werden.</span><span class="sxs-lookup"><span data-stu-id="a9738-140">The data cache can also be accessed programmatically from ASP.NET pages code-behind classes or from the classes in the web application s architecture.</span></span> <span data-ttu-id="a9738-141">Verwenden Sie zum Lesen und Schreiben in Datencache aus eine ASP.NET Seite s-Code-Behind-Klasse, die folgende Muster ein:</span><span class="sxs-lookup"><span data-stu-id="a9738-141">To read and write to the data cache from an ASP.NET page s code-behind class, use the following pattern:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample1.cs)]

<span data-ttu-id="a9738-142">Die [ `Cache` Klasse](https://msdn.microsoft.com/library/system.web.caching.cache.aspx) s [ `Insert` Methode](https://msdn.microsoft.com/library/system.web.caching.cache.insert.aspx) verfügt über eine Reihe von Überladungen.</span><span class="sxs-lookup"><span data-stu-id="a9738-142">The [`Cache` class](https://msdn.microsoft.com/library/system.web.caching.cache.aspx) s [`Insert` method](https://msdn.microsoft.com/library/system.web.caching.cache.insert.aspx) has a number of overloads.</span></span> <span data-ttu-id="a9738-143">`Cache["key"] = value` und `Cache.Insert(key, value)` sind Synonym und sowohl der Cache mit dem angegebenen Schlüssel, ohne eine definierte Ablauf ein Element hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="a9738-143">`Cache["key"] = value` and `Cache.Insert(key, value)` are synonymous and both add an item to the cache using the specified key without a defined expiry.</span></span> <span data-ttu-id="a9738-144">Wir möchten in der Regel eine ablaufangabe angeben, wenn Sie ein Element entweder als eine Abhängigkeit, eine zeitbasierte Ablauf oder beides auf den Cache hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="a9738-144">Typically, we want to specify an expiry when adding an item to the cache, either as a dependency, a time-based expiry, or both.</span></span> <span data-ttu-id="a9738-145">Verwenden Sie eine der anderen `Insert` s methodenüberladungen, Abhängigkeit oder zeitbasierte Ablaufinformationen bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="a9738-145">Use one of the other `Insert` method s overloads to provide dependency- or time-based expiry information.</span></span>

<span data-ttu-id="a9738-146">Der Caching-Ebene, die s-Methoden müssen zuerst überprüfen, wenn die angeforderten Daten im Cache befindet, und, wenn dies der Fall ist, wird es von dort aus zurück.</span><span class="sxs-lookup"><span data-stu-id="a9738-146">The Caching Layer s methods need to first check if the requested data is in the cache and, if so, return it from there.</span></span> <span data-ttu-id="a9738-147">Wenn die angeforderten Daten nicht im Cache vorhanden ist, muss die entsprechende BLL-Methode aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="a9738-147">If the requested data is not in the cache, the appropriate BLL method needs to be invoked.</span></span> <span data-ttu-id="a9738-148">Der Rückgabewert zwischengespeichert und dann zurückgegeben, wie das folgende Sequenzdiagramm veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="a9738-148">Its return value should be cached and then returned, as the following sequence diagram illustrates.</span></span>


![Die Caching-Schicht-s-Methoden Daten aus dem Cache zurückgibt, wenn es s verfügbar](caching-data-in-the-architecture-cs/_static/image3.png)

<span data-ttu-id="a9738-150">**Abbildung 3**: die Caching-Schicht s Methoden Daten aus dem Cache zurückgibt, wenn es s verfügbar</span><span class="sxs-lookup"><span data-stu-id="a9738-150">**Figure 3**: The Caching Layer s Methods Return Data from the Cache if it s Available</span></span>


<span data-ttu-id="a9738-151">Die Sequenz, die in Abbildung 3 dargestellten erfolgt in der CL-Klassen, die mithilfe des folgenden Musters:</span><span class="sxs-lookup"><span data-stu-id="a9738-151">The sequence depicted in Figure 3 is accomplished in the CL classes using the following pattern:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample2.cs)]

<span data-ttu-id="a9738-152">Hier *Typ* ist der Typ der im Cache gespeicherten Daten `Northwind.ProductsDataTable`, z. B. *Schlüssel* ist der Schlüssel, der das Element im Cache eindeutig identifiziert.</span><span class="sxs-lookup"><span data-stu-id="a9738-152">Here, *Type* is the type of data being stored in the cache `Northwind.ProductsDataTable`, for example while *key* is the key that uniquely identifies the cache item.</span></span> <span data-ttu-id="a9738-153">Wenn das Element mit dem angegebenen *Schlüssel* ist nicht im Cache *Instanz* werden `null` und die Daten werden aus der entsprechenden BLL-Methode abgerufen und dem Cache hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="a9738-153">If the item with the specified *key* is not in the cache, then *instance* will be `null` and the data will be retrieved from the appropriate BLL method and added to the cache.</span></span> <span data-ttu-id="a9738-154">Mit der Zeit `return instance` erreicht wird, *Instanz* enthält einen Verweis auf die Daten entweder aus dem Cache oder der BLL abgerufen.</span><span class="sxs-lookup"><span data-stu-id="a9738-154">By the time `return instance` is reached, *instance* contains a reference to the data, either from the cache or pulled from the BLL.</span></span>

<span data-ttu-id="a9738-155">Achten Sie darauf, dass Sie die oben genannten Muster zu verwenden, beim Zugriff auf Daten aus dem Cache.</span><span class="sxs-lookup"><span data-stu-id="a9738-155">Be sure to use the above pattern when accessing data from the cache.</span></span> <span data-ttu-id="a9738-156">Das folgende Muster, das, auf den ersten Blick entspricht, sucht enthält einen feinen Unterschied, der eine Racebedingung führt.</span><span class="sxs-lookup"><span data-stu-id="a9738-156">The following pattern, which, at first glance, looks equivalent, contains a subtle difference that introduces a race condition.</span></span> <span data-ttu-id="a9738-157">Racebedingungen sind schwierig zu debuggen, da sie sich selbst sporadisch anzuzeigen, und sind schwer zu reproduzieren.</span><span class="sxs-lookup"><span data-stu-id="a9738-157">Race conditions are difficult to debug because they reveal themselves sporadically and are difficult to reproduce.</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample3.cs)]

<span data-ttu-id="a9738-158">Der Unterschied in dieser zweiten falschen Codeausschnitt ist, statt einen Verweis auf das zwischengespeicherte Element in einer lokalen Variablen speichern, das dem Datencache erfolgt direkt in die Auswertung der Anweisung *und* in die `return`.</span><span class="sxs-lookup"><span data-stu-id="a9738-158">The difference in this second, incorrect code snippet is that rather than storing a reference to the cached item in a local variable, the data cache is accessed directly in the conditional statement *and* in the `return`.</span></span> <span data-ttu-id="a9738-159">Stellen Sie sich vor, wenn dieser Code erreicht wird, `Cache["key"]` nicht`null`, jedoch bevor die `return` Anweisung erreicht wird, wird das System entfernt *Schlüssel* aus dem Cache.</span><span class="sxs-lookup"><span data-stu-id="a9738-159">Imagine that when this code is reached, `Cache["key"]` is non-`null`, but before the `return` statement is reached, the system evicts *key* from the cache.</span></span> <span data-ttu-id="a9738-160">In diesem seltenen Fall, gibt der Code eine `null` Wert anstatt ein Objekt des erwarteten Typs.</span><span class="sxs-lookup"><span data-stu-id="a9738-160">In this rare case, the code will return a `null` value rather than an object of the expected type.</span></span>

> [!NOTE]
> <span data-ttu-id="a9738-161">Das Datencache ist threadsicher, sodass Einbau t erforderlich zusätzlichen, Thread-Zugang für einfache Lese- oder Schreibvorgänge zu synchronisieren.</span><span class="sxs-lookup"><span data-stu-id="a9738-161">The data cache is thread-safe, so you don t need to synchronize thread access for simple reads or writes.</span></span> <span data-ttu-id="a9738-162">Allerdings bei Bedarf auf mehrere Vorgänge für Daten im Cache, die atomar sein müssen, sind Sie verantwortlich für die Implementierung einer Sperre oder eines anderen Mechanismus, um Threadsicherheit zu gewährleisten.</span><span class="sxs-lookup"><span data-stu-id="a9738-162">However, if you need to perform multiple operations on data in the cache that need to be atomic, you are responsible for implementing a lock or some other mechanism to ensure thread safety.</span></span> <span data-ttu-id="a9738-163">Finden Sie unter [Synchronisierung auf dem ASP.NET Cache](http://www.ddj.com/184406369) für Weitere Informationen.</span><span class="sxs-lookup"><span data-stu-id="a9738-163">See [Synchronizing Access to the ASP.NET Cache](http://www.ddj.com/184406369) for more information.</span></span>


<span data-ttu-id="a9738-164">Ein Element kann programmgesteuert entfernt werden, aus dem Cache mithilfe der [ `Remove` Methode](https://msdn.microsoft.com/library/system.web.caching.cache.remove.aspx) wie folgt:</span><span class="sxs-lookup"><span data-stu-id="a9738-164">An item can be programmatically evicted from the data cache using the [`Remove` method](https://msdn.microsoft.com/library/system.web.caching.cache.remove.aspx) like so:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample4.cs)]

## <a name="step-3-returning-product-information-from-theproductsclclass"></a><span data-ttu-id="a9738-165">Schritt 3: Zurückgeben von Produktinformationen aus der`ProductsCL`Klasse</span><span class="sxs-lookup"><span data-stu-id="a9738-165">Step 3: Returning Product Information from the`ProductsCL`Class</span></span>

<span data-ttu-id="a9738-166">Für dieses Tutorial implementieren Sie zwei Methoden zur Rückgabe von Produktinformationen aus s kann die `ProductsCL` Klasse: `GetProducts()` und `GetProductsByCategoryID(categoryID)`.</span><span class="sxs-lookup"><span data-stu-id="a9738-166">For this tutorial let s implement two methods for returning product information from the `ProductsCL` class: `GetProducts()` and `GetProductsByCategoryID(categoryID)`.</span></span> <span data-ttu-id="a9738-167">Wie beispielsweise die `ProductsBL` Klasse in der Business Logic Layer, die `GetProducts()` -Methode in der CL gibt Informationen zu allen Produkten als eine `Northwind.ProductsDataTable` Objekt während `GetProductsByCategoryID(categoryID)` gibt alle Produkte aus der eine angegebene Kategorie zurück.</span><span class="sxs-lookup"><span data-stu-id="a9738-167">Like with the `ProductsBL` class in the Business Logic Layer, the `GetProducts()` method in the CL returns information about all of the products as a `Northwind.ProductsDataTable` object, while `GetProductsByCategoryID(categoryID)` returns all of the products from a specified category.</span></span>

<span data-ttu-id="a9738-168">Der folgende Code zeigt einen Teil der Methoden in der `ProductsCL` Klasse:</span><span class="sxs-lookup"><span data-stu-id="a9738-168">The following code shows a portion of the methods in the `ProductsCL` class:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-cs/samples/sample5.vb)]

<span data-ttu-id="a9738-169">Beachten Sie zunächst die `DataObject` und `DataObjectMethodAttribute` Attribute, die auf die Klasse und die Methoden angewendet.</span><span class="sxs-lookup"><span data-stu-id="a9738-169">First, note the `DataObject` and `DataObjectMethodAttribute` attributes applied to the class and methods.</span></span> <span data-ttu-id="a9738-170">Diese Attribute enthalten Informationen zu "ObjectDataSource"-s-Assistenten, der angibt, welche Klassen und Methoden in den Schritten des Assistenten s angezeigt werden soll.</span><span class="sxs-lookup"><span data-stu-id="a9738-170">These attributes provide information to the ObjectDataSource s wizard, indicating what classes and methods should appear in the wizard s steps.</span></span> <span data-ttu-id="a9738-171">Da die CL-Klassen und Methoden aus einem "ObjectDataSource" in der Darstellungsschicht zugegriffen werden, hinzugefügt habe ich diese Attribute zum Verbessern der Entwurfszeit.</span><span class="sxs-lookup"><span data-stu-id="a9738-171">Since the CL classes and methods will be accessed from an ObjectDataSource in the Presentation Layer, I added these attributes to enhance the design-time experience.</span></span> <span data-ttu-id="a9738-172">Siehe die [Erstellen einer Geschäftslogikebene](../introduction/creating-a-business-logic-layer-cs.md) Tutorial für eine ausführlichere Beschreibung zu diesen Attributen und deren Auswirkungen.</span><span class="sxs-lookup"><span data-stu-id="a9738-172">Refer back to the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-cs.md) tutorial for a more thorough description on these attributes and their effects.</span></span>

<span data-ttu-id="a9738-173">In der `GetProducts()` und `GetProductsByCategoryID(categoryID)` Methoden, die von zurückgegebenen Daten die `GetCacheItem(key)` -Methode eine lokale Variable zugewiesen wird.</span><span class="sxs-lookup"><span data-stu-id="a9738-173">In the `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods, the data returned from the `GetCacheItem(key)` method is assigned to a local variable.</span></span> <span data-ttu-id="a9738-174">Die `GetCacheItem(key)` -Methode, die in Kürze untersucht werden, gibt ein bestimmtes Element aus dem Cache, der auf der Grundlage der angegebenen *Schlüssel*.</span><span class="sxs-lookup"><span data-stu-id="a9738-174">The `GetCacheItem(key)` method, which we'll examine shortly, returns a particular item from the cache based on the specified *key*.</span></span> <span data-ttu-id="a9738-175">Wenn keine solchen Daten im Cache gefunden werden, wird er aus der entsprechenden abgerufen `ProductsBLL` -Klassenmethode und dann auf den Cache mit den `AddCacheItem(key, value)` Methode.</span><span class="sxs-lookup"><span data-stu-id="a9738-175">If no such data is found in cache, it is retrieved from the corresponding `ProductsBLL` class method and then added to the cache using the `AddCacheItem(key, value)` method.</span></span>

<span data-ttu-id="a9738-176">Die `GetCacheItem(key)` und `AddCacheItem(key, value)` Methoden Schnittstelle mit dem Datencache, lesen und Schreiben von Werten.</span><span class="sxs-lookup"><span data-stu-id="a9738-176">The `GetCacheItem(key)` and `AddCacheItem(key, value)` methods interface with the data cache, reading and writing values, respectively.</span></span> <span data-ttu-id="a9738-177">Die `GetCacheItem(key)` Methode ist die einfachere der beiden.</span><span class="sxs-lookup"><span data-stu-id="a9738-177">The `GetCacheItem(key)` method is the simpler of the two.</span></span> <span data-ttu-id="a9738-178">Wird einfach der Wert aus dem Cache-Klasse, die mit dem übergebenen in *Schlüssel*:</span><span class="sxs-lookup"><span data-stu-id="a9738-178">It simply returns the value from the Cache class using the passed-in *key*:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample6.cs)]

<span data-ttu-id="a9738-179">`GetCacheItem(key)` verwendet keine *Schlüssel* -Wert, wie angegeben, sondern ruft die `GetCacheKey(key)` -Methode, die gibt die *Schlüssel* vorangestellt ProductsCache-.</span><span class="sxs-lookup"><span data-stu-id="a9738-179">`GetCacheItem(key)` does not use *key* value as supplied, but instead calls the `GetCacheKey(key)` method, which returns the *key* prepended with ProductsCache-.</span></span> <span data-ttu-id="a9738-180">Die `MasterCacheKeyArray`, der die Zeichenfolge ProductsCache, enthält auch dient der `AddCacheItem(key, value)` -Methode, sofort sehen.</span><span class="sxs-lookup"><span data-stu-id="a9738-180">The `MasterCacheKeyArray`, which holds the string ProductsCache, is also used by the `AddCacheItem(key, value)` method, as we'll see momentarily.</span></span>

<span data-ttu-id="a9738-181">Von einer ASP.NET Seite s Code-Behind-Klasse, das dem Datencache erfolgen kann mithilfe der `Page` s-Klasse [ `Cache` Eigenschaft](https://msdn.microsoft.com/library/system.web.ui.page.cache.aspx), und ermöglicht eine Syntax wie `Cache["key"] = value`, wie in Schritt2 beschrieben.</span><span class="sxs-lookup"><span data-stu-id="a9738-181">From an ASP.NET page s code-behind class, the data cache can be accessed using the `Page` class s [`Cache` property](https://msdn.microsoft.com/library/system.web.ui.page.cache.aspx), and allows for syntax like `Cache["key"] = value`, as discussed in Step 2.</span></span> <span data-ttu-id="a9738-182">Von einer Klasse innerhalb der Architektur, das dem Datencache erfolgen kann entweder `HttpRuntime.Cache` oder `HttpContext.Current.Cache`.</span><span class="sxs-lookup"><span data-stu-id="a9738-182">From a class within the architecture, the data cache can be accessed using either `HttpRuntime.Cache` or `HttpContext.Current.Cache`.</span></span> <span data-ttu-id="a9738-183">[Peter Johnson](https://weblogs.asp.net/pjohnson/default.aspx)Blogeintrag [HttpRuntime.Cache Visual Studio. HttpContext.Current.Cache](https://weblogs.asp.net/pjohnson/httpruntime-cache-vs-httpcontext-current-cache) – Anmerkungen zu dieser die geringfügige Leistungsvorteile mit `HttpRuntime` anstelle von `HttpContext.Current`; daher `ProductsCL` verwendet `HttpRuntime`.</span><span class="sxs-lookup"><span data-stu-id="a9738-183">[Peter Johnson](https://weblogs.asp.net/pjohnson/default.aspx)'s blog entry [HttpRuntime.Cache vs. HttpContext.Current.Cache](https://weblogs.asp.net/pjohnson/httpruntime-cache-vs-httpcontext-current-cache) notes the slight performance advantage in using `HttpRuntime` instead of `HttpContext.Current`; consequently, `ProductsCL` uses `HttpRuntime`.</span></span>

> [!NOTE]
> <span data-ttu-id="a9738-184">Wenn Ihre Architektur wird mithilfe von Class Library-Projekten implementiert, und klicken Sie dann müssen Sie zum Hinzufügen eines Verweises auf die `System.Web` Assembly um verwenden die [HttpRuntime](https://msdn.microsoft.com/library/system.web.httpruntime.aspx) und ["HttpContext"](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) Klassen.</span><span class="sxs-lookup"><span data-stu-id="a9738-184">If your architecture is implemented using Class Library projects then you will need to add a reference to the `System.Web` assembly in order to use the [HttpRuntime](https://msdn.microsoft.com/library/system.web.httpruntime.aspx) and [HttpContext](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) classes.</span></span>


<span data-ttu-id="a9738-185">Wenn das Element nicht im Cache gefunden wurde die `ProductsCL` -s-Klasse, Methoden, die Daten der BLL abzurufen, und fügen Sie es mit dem Cache hinzu der `AddCacheItem(key, value)` Methode.</span><span class="sxs-lookup"><span data-stu-id="a9738-185">If the item is not found in the cache, the `ProductsCL` class s methods get the data from the BLL and add it to the cache using the `AddCacheItem(key, value)` method.</span></span> <span data-ttu-id="a9738-186">Hinzuzufügende *Wert* in den Cache können wir den folgenden Code, die eine Ablaufzeit von 60 Sekunden Zeit verwendet:</span><span class="sxs-lookup"><span data-stu-id="a9738-186">To add *value* to the cache we could use the following code, which uses a 60 second time expiry:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample7.cs)]

<span data-ttu-id="a9738-187">`DateTime.Now.AddSeconds(CacheDuration)` Gibt die Ablaufzeit eines zeitbasierten 60 Sekunden in der zukünftigen While [ `System.Web.Caching.Cache.NoSlidingExpiration` ](https://msdn.microsoft.com/library/system.web.caching.cache.noslidingexpiration(vs.80).aspx) gibt es s keine gleitende Ablaufzeit.</span><span class="sxs-lookup"><span data-stu-id="a9738-187">`DateTime.Now.AddSeconds(CacheDuration)` specifies the time-based expiry 60 seconds in the future while [`System.Web.Caching.Cache.NoSlidingExpiration`](https://msdn.microsoft.com/library/system.web.caching.cache.noslidingexpiration(vs.80).aspx) indicates that there s no sliding expiration.</span></span> <span data-ttu-id="a9738-188">Während dieses `Insert` methodenüberladung verfügt über die Eingabeparameter für beide einen absoluten und gleitenden Ablauf, können Sie nur eine der beiden.</span><span class="sxs-lookup"><span data-stu-id="a9738-188">While this `Insert` method overload has input parameters for both an absolute and sliding expiry, you can only provide one of the two.</span></span> <span data-ttu-id="a9738-189">Wenn Sie versuchen, die sowohl eine absolute Zeit als auch eine Zeitspanne angeben der `Insert` Methode löst eine `ArgumentException` Ausnahme.</span><span class="sxs-lookup"><span data-stu-id="a9738-189">If you attempt to specify both an absolute time and a time span, the `Insert` method will throw an `ArgumentException` exception.</span></span>

> [!NOTE]
> <span data-ttu-id="a9738-190">Diese Implementierung von der `AddCacheItem(key, value)` Methode verfügt derzeit über einige unzulänglichkeiten vorhanden.</span><span class="sxs-lookup"><span data-stu-id="a9738-190">This implementation of the `AddCacheItem(key, value)` method currently has some shortcomings.</span></span> <span data-ttu-id="a9738-191">Wir behandeln und Beheben von folgenden Problemen in Schritt 4.</span><span class="sxs-lookup"><span data-stu-id="a9738-191">We'll address and overcome these issues in Step 4.</span></span>


## <a name="step-4-invalidating-the-cache-when-the-data-is-modified-through-the-architecture"></a><span data-ttu-id="a9738-192">Schritt 4: Wenn die Daten im Cache für ungültig zu erklären über die Architektur geändert wird</span><span class="sxs-lookup"><span data-stu-id="a9738-192">Step 4: Invalidating the Cache When the Data is Modified Through the Architecture</span></span>

<span data-ttu-id="a9738-193">Zusammen mit Datenabrufmethoden muss der Caching-Schicht bieten dieselben Methoden wie die BLL für das Einfügen, aktualisieren und Löschen von Daten.</span><span class="sxs-lookup"><span data-stu-id="a9738-193">Along with data retrieval methods, the Caching Layer needs to provide the same methods as the BLL for inserting, updating, and deleting data.</span></span> <span data-ttu-id="a9738-194">Die CL s datenänderungsmethoden ändern Sie die zwischengespeicherten Daten, nicht aber eher die BLL s entsprechende Daten-Änderung-Methode aufrufen und dann wird der Cache ungültig.</span><span class="sxs-lookup"><span data-stu-id="a9738-194">The CL s data modification methods do not modify the cached data, but rather call the BLL s corresponding data modification method and then invalidate the cache.</span></span> <span data-ttu-id="a9738-195">Wie wir im vorherigen Tutorial gesehen haben, ist dies das gleiche Verhalten, die dem ObjectDataSource-Steuerelement angewendet wird, wenn die caching-Funktionen aktiviert sind und die zugehörige `Insert`, `Update`, oder `Delete` Methoden aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="a9738-195">As we saw in the preceding tutorial, this is the same behavior that the ObjectDataSource applies when its caching features are enabled and its `Insert`, `Update`, or `Delete` methods are invoked.</span></span>

<span data-ttu-id="a9738-196">Die folgenden `UpdateProduct` Überladung wird veranschaulicht, wie die datenänderungsmethoden in der CL zu implementieren:</span><span class="sxs-lookup"><span data-stu-id="a9738-196">The following `UpdateProduct` overload illustrates how to implement the data modification methods in the CL:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample8.cs)]

<span data-ttu-id="a9738-197">Die entsprechenden Datenänderung Business Logic Layer-Methode wird aufgerufen, aber bevor die Antwort zurückgegeben wird, müssen wir auf den Cache für ungültig erklären.</span><span class="sxs-lookup"><span data-stu-id="a9738-197">The appropriate data modification Business Logic Layer method is invoked, but before its response is returned we need to invalidate the cache.</span></span> <span data-ttu-id="a9738-198">Leider der Zwischenspeicher zunächst ungültig ist nicht einfach, da die `ProductsCL` s-Klasse `GetProducts()` und `GetProductsByCategoryID(categoryID)` Methoden jedes Elemente dem Cache hinzufügen mit verschiedenen Schlüsseln, und die `GetProductsByCategoryID(categoryID)` Methode fügt ein anderer Cache-Element für jeden eindeutigen *CategoryID*.</span><span class="sxs-lookup"><span data-stu-id="a9738-198">Unfortunately, invalidating the cache is not straightforward because the `ProductsCL` class s `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods each add items to the cache with different keys, and the `GetProductsByCategoryID(categoryID)` method adds a different cache item for each unique *categoryID*.</span></span>

<span data-ttu-id="a9738-199">Wenn den Cache für ungültig zu erklären, müssen wir entfernen *alle* der Elemente, die möglicherweise von hinzugefügt wurden die `ProductsCL` Klasse.</span><span class="sxs-lookup"><span data-stu-id="a9738-199">When invalidating the cache, we need to remove *all* of the items that may have been added by the `ProductsCL` class.</span></span> <span data-ttu-id="a9738-200">Dies kann erreicht werden, durch Zuordnen einer *Zwischenspeichern Abhängigkeit* mit dem jedes Element im Cache in der `AddCacheItem(key, value)` Methode.</span><span class="sxs-lookup"><span data-stu-id="a9738-200">This can be accomplished by associating a *cache dependency* with the each item added to the cache in the `AddCacheItem(key, value)` method.</span></span> <span data-ttu-id="a9738-201">Im Allgemeinen kann eine Cacheabhängigkeit auf einem anderen Element im Cache, eine Datei auf dem Dateisystem oder die Daten aus einer Microsoft SQL Server-Datenbank sein.</span><span class="sxs-lookup"><span data-stu-id="a9738-201">In general, a cache dependency can be another item in the cache, a file on the file system, or data from a Microsoft SQL Server database.</span></span> <span data-ttu-id="a9738-202">Wenn die Abhängigkeit ändert oder aus dem Cache entfernt wird, werden automatisch die Cacheelemente, die es zugeordnet ist aus dem Cache entfernt.</span><span class="sxs-lookup"><span data-stu-id="a9738-202">When the dependency changes or is removed from the cache, the cache items it is associated with are automatically evicted from the cache.</span></span> <span data-ttu-id="a9738-203">In diesem Tutorial ein zusätzliches Element im Cache zu erstellen, die dient als über eine Cacheabhängigkeit für alle Elemente hinzugefügt werden sollten die `ProductsCL` Klasse.</span><span class="sxs-lookup"><span data-stu-id="a9738-203">For this tutorial, we want to create an additional item in the cache that serves as a cache dependency for all items added through the `ProductsCL` class.</span></span> <span data-ttu-id="a9738-204">Alle diese Elemente können auf diese Weise durch die Cacheabhängigkeit entfernen aus dem Cache entfernt werden.</span><span class="sxs-lookup"><span data-stu-id="a9738-204">That way, all of these items can be removed from the cache by simply removing the cache dependency.</span></span>

<span data-ttu-id="a9738-205">Let-s-Update die `AddCacheItem(key, value)` Methode, sodass jedes Element zum Cache, mit dieser Methode hinzugefügt mit einer einzelnen Cacheabhängigkeit zugeordnet ist:</span><span class="sxs-lookup"><span data-stu-id="a9738-205">Let s update the `AddCacheItem(key, value)` method so that each item added to the cache through this method is associated with a single cache dependency:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample9.cs)]

<span data-ttu-id="a9738-206">`MasterCacheKeyArray` ist ein Zeichenfolgenarray, das einen einzelnen Wert, der ProductsCache enthält.</span><span class="sxs-lookup"><span data-stu-id="a9738-206">`MasterCacheKeyArray` is a string array that holds a single value, ProductsCache.</span></span> <span data-ttu-id="a9738-207">Erstens wird ein Cacheelement dem Cache hinzugefügt und zugewiesen werden, das aktuelle Datum und die Uhrzeit.</span><span class="sxs-lookup"><span data-stu-id="a9738-207">First, a cache item is added to the cache and assigned the current date and time.</span></span> <span data-ttu-id="a9738-208">Wenn das Element im Cache bereits vorhanden ist, wird er aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="a9738-208">If the cache item already exists, it is updated.</span></span> <span data-ttu-id="a9738-209">Als Nächstes wird eine Cacheabhängigkeit erstellt.</span><span class="sxs-lookup"><span data-stu-id="a9738-209">Next, a cache dependency is created.</span></span> <span data-ttu-id="a9738-210">Die [ `CacheDependency` Klasse](https://msdn.microsoft.com/library/system.web.caching.cachedependency(VS.80).aspx) s Konstruktor weist eine Reihe von Überladungen, wird hier verwendet, erwartet jedoch, zwei `string` array-Eingaben.</span><span class="sxs-lookup"><span data-stu-id="a9738-210">The [`CacheDependency` class](https://msdn.microsoft.com/library/system.web.caching.cachedependency(VS.80).aspx) s constructor has a number of overloads, but the one being used in here expects two `string` array inputs.</span></span> <span data-ttu-id="a9738-211">Der erste gibt des Satz von Dateien, die als Abhängigkeiten verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="a9738-211">The first one specifies the set of files to be used as dependencies.</span></span> <span data-ttu-id="a9738-212">Da wir Raten t dateibasierten Abhängigkeiten, den Wert verwenden möchten `null` wird für den ersten Eingabeparameter verwendet.</span><span class="sxs-lookup"><span data-stu-id="a9738-212">Since we don t want to use any file-based dependencies, a value of `null` is used for the first input parameter.</span></span> <span data-ttu-id="a9738-213">Der zweite Eingabeparameter gibt an, den Satz von Cacheschlüsseln, die als Abhängigkeiten verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="a9738-213">The second input parameter specifies the set of cache keys to use as dependencies.</span></span> <span data-ttu-id="a9738-214">Hier geben wir unsere einzige Abhängigkeit, `MasterCacheKeyArray`.</span><span class="sxs-lookup"><span data-stu-id="a9738-214">Here we specify our single dependency, `MasterCacheKeyArray`.</span></span> <span data-ttu-id="a9738-215">Die `CacheDependency` wird dann übergeben werden, in der `Insert` Methode.</span><span class="sxs-lookup"><span data-stu-id="a9738-215">The `CacheDependency` is then passed into the `Insert` method.</span></span>

<span data-ttu-id="a9738-216">Dank dieser Änderung auf `AddCacheItem(key, value)`, invaliding der Cache ist so einfach wie das Entfernen der Abhängigkeits.</span><span class="sxs-lookup"><span data-stu-id="a9738-216">With this modification to `AddCacheItem(key, value)`, invaliding the cache is as simple as removing the dependency.</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample10.cs)]

## <a name="step-5-calling-the-caching-layer-from-the-presentation-layer"></a><span data-ttu-id="a9738-217">Schritt 5: Aufrufen der Caching-Schicht auf der Darstellungsschicht</span><span class="sxs-lookup"><span data-stu-id="a9738-217">Step 5: Calling the Caching Layer from the Presentation Layer</span></span>

<span data-ttu-id="a9738-218">Die Caching-Schicht-s-Klassen und Methoden können verwendet werden, mit Daten arbeiten mit den Verfahren wir in diesen Tutorials untersucht haben.</span><span class="sxs-lookup"><span data-stu-id="a9738-218">The Caching Layer s classes and methods can be used to work with data using the techniques we ve examined throughout these tutorials.</span></span> <span data-ttu-id="a9738-219">Um die Arbeit mit zwischengespeicherten Daten zu veranschaulichen, speichern Sie die Änderungen an der `ProductsCL` Klasse, und öffnen Sie dann die `FromTheArchitecture.aspx` auf der Seite die `Caching` Ordner und Hinzufügen einer GridView-Ansicht.</span><span class="sxs-lookup"><span data-stu-id="a9738-219">To illustrate working with cached data, save your changes to the `ProductsCL` class and then open the `FromTheArchitecture.aspx` page in the `Caching` folder and add a GridView.</span></span> <span data-ttu-id="a9738-220">Erstellen Sie von GridView s Smarttags eine neue "ObjectDataSource".</span><span class="sxs-lookup"><span data-stu-id="a9738-220">From the GridView s smart tag, create a new ObjectDataSource.</span></span> <span data-ttu-id="a9738-221">Im ersten Schritt Assistenten s sollte die `ProductsCL` Klasse als eine der Optionen aus der Dropdown-Liste.</span><span class="sxs-lookup"><span data-stu-id="a9738-221">In the wizard s first step you should see the `ProductsCL` class as one of the options from the drop-down list.</span></span>


<span data-ttu-id="a9738-222">[![Die ProductsCL-Klasse ist in der Dropdown-Liste Business enthalten.](caching-data-in-the-architecture-cs/_static/image5.png)](caching-data-in-the-architecture-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="a9738-222">[![The ProductsCL Class is Included in the Business Object Drop-Down List](caching-data-in-the-architecture-cs/_static/image5.png)](caching-data-in-the-architecture-cs/_static/image4.png)</span></span>

<span data-ttu-id="a9738-223">**Abbildung 4**: die `ProductsCL` Klasse befindet sich in der Dropdown-Liste Business ([klicken Sie, um das Bild in voller Größe anzeigen](caching-data-in-the-architecture-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="a9738-223">**Figure 4**: The `ProductsCL` Class is Included in the Business Object Drop-Down List ([Click to view full-size image](caching-data-in-the-architecture-cs/_static/image6.png))</span></span>


<span data-ttu-id="a9738-224">Nach der Auswahl `ProductsCL`, klicken Sie auf Weiter.</span><span class="sxs-lookup"><span data-stu-id="a9738-224">After selecting `ProductsCL`, click Next.</span></span> <span data-ttu-id="a9738-225">Die Dropdown-Liste in der Registerkarte "SELECT" verfügt über zwei Elemente - `GetProducts()` und `GetProductsByCategoryID(categoryID)` und die Registerkarte "Updates" ist der einzige `UpdateProduct` überladen.</span><span class="sxs-lookup"><span data-stu-id="a9738-225">The drop-down list in the SELECT tab has two items - `GetProducts()` and `GetProductsByCategoryID(categoryID)` and the UPDATE tab has the sole `UpdateProduct` overload.</span></span> <span data-ttu-id="a9738-226">Wählen Sie die `GetProducts()` Methode aus der Registerkarte "SELECT" und die `UpdateProducts` Methode aus der Registerkarte "Updates" und klicken Sie auf Fertig stellen.</span><span class="sxs-lookup"><span data-stu-id="a9738-226">Choose the `GetProducts()` method from the SELECT tab and the `UpdateProducts` method from the UPDATE tab and click Finish.</span></span>


<span data-ttu-id="a9738-227">[![Die s-Klasse für die ProductsCL-Methoden sind in den Dropdownlisten aufgelistet.](caching-data-in-the-architecture-cs/_static/image8.png)](caching-data-in-the-architecture-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="a9738-227">[![The ProductsCL Class s Methods are Listed in the Drop-Down Lists](caching-data-in-the-architecture-cs/_static/image8.png)](caching-data-in-the-architecture-cs/_static/image7.png)</span></span>

<span data-ttu-id="a9738-228">**Abbildung 5**: die `ProductsCL` s-Klassenmethoden finden Sie in den Dropdownlisten ([klicken Sie, um das Bild in voller Größe anzeigen](caching-data-in-the-architecture-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="a9738-228">**Figure 5**: The `ProductsCL` Class s Methods are Listed in the Drop-Down Lists ([Click to view full-size image](caching-data-in-the-architecture-cs/_static/image9.png))</span></span>


<span data-ttu-id="a9738-229">Nach Abschluss des Assistenten wird Visual Studio festgelegt, das "ObjectDataSource"-s `OldValuesParameterFormatString` Eigenschaft `original_{0}` und fügen Sie den entsprechenden Feldern hinzu, an die GridView.</span><span class="sxs-lookup"><span data-stu-id="a9738-229">After completing the wizard, Visual Studio will set the ObjectDataSource s `OldValuesParameterFormatString` property to `original_{0}` and add the appropriate fields to the GridView.</span></span> <span data-ttu-id="a9738-230">Ändern der `OldValuesParameterFormatString` -Eigenschaft wieder auf den Standardwert `{0}`, und konfigurieren die GridView zur Unterstützung von paging, Sortieren und bearbeiten.</span><span class="sxs-lookup"><span data-stu-id="a9738-230">Change the `OldValuesParameterFormatString` property back to its default value, `{0}`, and configure the GridView to support paging, sorting, and editing.</span></span> <span data-ttu-id="a9738-231">Da die `UploadProducts` Überladung, die verwendet werden, von dem CL akzeptiert nur die bearbeitete Produktname s und den Preis, beschränken die GridView, sodass nur diese Felder bearbeitet werden.</span><span class="sxs-lookup"><span data-stu-id="a9738-231">Since the `UploadProducts` overload used by the CL accepts only the edited product s name and price, limit the GridView so that only these fields are editable.</span></span>

<span data-ttu-id="a9738-232">Im vorherigen Tutorial definiert es einer GridView-Ansicht enthält Felder für die `ProductName`, `CategoryName`, und `UnitPrice` Felder.</span><span class="sxs-lookup"><span data-stu-id="a9738-232">In the preceding tutorial we defined a GridView to include fields for the `ProductName`, `CategoryName`, and `UnitPrice` fields.</span></span> <span data-ttu-id="a9738-233">Können Sie diese Formatierung und die Struktur zu replizieren, die in diesem Fall, dass Ihre deklarativen GridView und "ObjectDataSource" s-Markup sollte etwa wie folgt aussehen:</span><span class="sxs-lookup"><span data-stu-id="a9738-233">Feel free to replicate this formatting and structure, in which case your GridView and ObjectDataSource s declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](caching-data-in-the-architecture-cs/samples/sample11.aspx)]

<span data-ttu-id="a9738-234">An diesem Punkt haben wir eine Seite, die Caching-Schicht verwendet.</span><span class="sxs-lookup"><span data-stu-id="a9738-234">At this point we have a page that uses the Caching Layer.</span></span> <span data-ttu-id="a9738-235">Um den Cache in Aktion sehen zu können, legen Sie Haltepunkte in der `ProductsCL` Klasse s `GetProducts()` und `UpdateProduct` Methoden.</span><span class="sxs-lookup"><span data-stu-id="a9738-235">To see the cache in action, set breakpoints in the `ProductsCL` class s `GetProducts()` and `UpdateProduct` methods.</span></span> <span data-ttu-id="a9738-236">Finden Sie auf der Seite in einen Browser, und den Code schrittweise durchlaufen, die beim Sortieren und paging, um zu sehen, die Daten aus dem Cache abgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="a9738-236">Visit the page in a browser and step through the code when sorting and paging in order to see the data pulled from the cache.</span></span> <span data-ttu-id="a9738-237">Klicken Sie dann aktualisieren Sie einen Datensatz zu, und beachten Sie, dass der Cache ungültig ist, daher ist Abruf der BLL, wenn die Daten an die GridView neu gebunden werden.</span><span class="sxs-lookup"><span data-stu-id="a9738-237">Then update a record and note that the cache is invalidated and, consequently, it is retrieved from the BLL when the data is rebound to the GridView.</span></span>

> [!NOTE]
> <span data-ttu-id="a9738-238">Der Caching-Schicht bereitgestellt, die im Download zu diesem Artikel ist nicht abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="a9738-238">The Caching Layer provided in the download accompanying this article is not complete.</span></span> <span data-ttu-id="a9738-239">Sie enthält nur eine Klasse `ProductsCL`, die nur eine Handvoll Methoden glänzt.</span><span class="sxs-lookup"><span data-stu-id="a9738-239">It contains only one class, `ProductsCL`, which only sports a handful of methods.</span></span> <span data-ttu-id="a9738-240">Darüber hinaus nur eine einzelne ASP.NET-Seite verwendet die CL (`~/Caching/FromTheArchitecture.aspx`) alle anderen verweisen weiterhin die BLL direkt.</span><span class="sxs-lookup"><span data-stu-id="a9738-240">Moreover, only a single ASP.NET page uses the CL (`~/Caching/FromTheArchitecture.aspx`) all others still reference the BLL directly.</span></span> <span data-ttu-id="a9738-241">Wenn Sie eine CL in Ihrer Anwendung verwenden möchten, alle Aufrufe von der Darstellungsschicht sollte zum CL, die die müssten die CL s Klassen und Methoden behandelt, diese Klassen und Methoden in der BLL, die derzeit von der Darstellungsschicht verwendet.</span><span class="sxs-lookup"><span data-stu-id="a9738-241">If you plan on using a CL in your application, all calls from the Presentation Layer should go to the CL, which would require that the CL s classes and methods covered those classes and methods in the BLL currently used by the Presentation Layer.</span></span>


## <a name="summary"></a><span data-ttu-id="a9738-242">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="a9738-242">Summary</span></span>

<span data-ttu-id="a9738-243">Während der Zwischenspeicherung auf dem Darstellungsschicht mit ASP.NET 2.0 s SqlDataSource und ObjectDataSource-Steuerelement angewendet werden kann, würde im Idealfall Zwischenspeichern von Aufgaben an einer separaten Schicht in der Architektur delegiert werden.</span><span class="sxs-lookup"><span data-stu-id="a9738-243">While caching can be applied at the Presentation Layer with ASP.NET 2.0 s SqlDataSource and ObjectDataSource controls, ideally caching responsibilities would be delegated to a separate layer in the architecture.</span></span> <span data-ttu-id="a9738-244">In diesem Tutorial haben wir eine Caching-Schicht, die zwischen der Darstellungsschicht und den Geschäftslogikebene befindet.</span><span class="sxs-lookup"><span data-stu-id="a9738-244">In this tutorial we created a Caching Layer that resides between the Presentation Layer and the Business Logic Layer.</span></span> <span data-ttu-id="a9738-245">Der Caching-Schicht muss bieten den gleichen Satz von Klassen und Methoden, die in die BLL vorhanden sind und auf der Darstellungsschicht aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="a9738-245">The Caching Layer needs to provide the same set of classes and methods that exist in the BLL and are called from the Presentation Layer.</span></span>

<span data-ttu-id="a9738-246">Die Caching-Schicht-Beispiele in diesem und den vorherigen Tutorials behandelt wurde auf *reaktive laden*.</span><span class="sxs-lookup"><span data-stu-id="a9738-246">The Caching Layer examples we explored in this and the preceding tutorials exhibited *reactive loading*.</span></span> <span data-ttu-id="a9738-247">Reaktive Loading, werden die Daten in den Cache geladen, nur, wenn eine Anforderung für die Daten erfolgt und die Daten aus dem Cache nicht vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="a9738-247">With reactive loading, the data is loaded into the cache only when a request for the data is made and that data is missing from the cache.</span></span> <span data-ttu-id="a9738-248">Daten können auch sein *proaktiv geladenen* in den Cache eine Technik, die lädt die Daten in den Cache, bevor sie tatsächlich benötigt wird.</span><span class="sxs-lookup"><span data-stu-id="a9738-248">Data can also be *proactively loaded* into the cache, a technique that loads the data into the cache before it is actually needed.</span></span> <span data-ttu-id="a9738-249">Im nächsten Tutorial erfahren Sie, ein Beispiel für proaktive geladen werden, wenn wir betrachten wie statische Werte in den Cache beim Start der Anwendung gespeichert.</span><span class="sxs-lookup"><span data-stu-id="a9738-249">In the next tutorial we'll see an example of proactive loading when we look at how to store static values into the cache at application startup.</span></span>

<span data-ttu-id="a9738-250">Viel Spaß beim Programmieren!</span><span class="sxs-lookup"><span data-stu-id="a9738-250">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="a9738-251">Der Autor</span><span class="sxs-lookup"><span data-stu-id="a9738-251">About the Author</span></span>

<span data-ttu-id="a9738-252">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), Autor von sieben Büchern zu ASP/ASP.NET und Gründer von [4GuysFromRolla.com](http://www.4guysfromrolla.com), arbeitet mit Microsoft-Web-Technologien seit 1998.</span><span class="sxs-lookup"><span data-stu-id="a9738-252">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="a9738-253">Er ist als ein unabhängiger Berater, Schulungsleiter und Autor.</span><span class="sxs-lookup"><span data-stu-id="a9738-253">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="a9738-254">Sein neueste Buch wird [*Sams Schulen selbst ASP.NET 2.0 in 24 Stunden*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="a9738-254">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="a9738-255">Er ist unter [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a9738-255">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="a9738-256">oder über seinen Blog finden Sie unter [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="a9738-256">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="a9738-257">Besonderen Dank an</span><span class="sxs-lookup"><span data-stu-id="a9738-257">Special Thanks To</span></span>

<span data-ttu-id="a9738-258">Diese tutorialreihe wurde durch viele hilfreiche Reviewer überprüft.</span><span class="sxs-lookup"><span data-stu-id="a9738-258">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="a9738-259">Führendes Prüfer für dieses Tutorial wurde Teresa Murph.</span><span class="sxs-lookup"><span data-stu-id="a9738-259">Lead reviewer for this tutorial was Teresa Murph.</span></span> <span data-ttu-id="a9738-260">Meine zukünftigen MSDN-Artikeln überprüfen möchten?</span><span class="sxs-lookup"><span data-stu-id="a9738-260">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="a9738-261">Wenn dies der Fall ist, löschen Sie mir eine Linie an [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a9738-261">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="a9738-262">[Zurück](caching-data-with-the-objectdatasource-cs.md)
> [Weiter](caching-data-at-application-startup-cs.md)</span><span class="sxs-lookup"><span data-stu-id="a9738-262">[Previous](caching-data-with-the-objectdatasource-cs.md)
[Next](caching-data-at-application-startup-cs.md)</span></span>
