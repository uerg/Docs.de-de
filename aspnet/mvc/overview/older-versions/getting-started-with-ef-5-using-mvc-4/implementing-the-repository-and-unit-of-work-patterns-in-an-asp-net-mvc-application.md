---
uid: mvc/overview/older-versions/getting-started-with-ef-5-using-mvc-4/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application
title: Implementieren das Repository und Arbeitseinheitsmuster in einer ASP.NET MVC-Anwendung (9 von 10) | Microsoft-Dokumentation
author: tdykstra
description: Die Contoso University-Beispielwebanwendung veranschaulicht, wie ASP.NET MVC 4-Anwendungen, die mit dem Entity Framework 5 Code First "und" Visual Studio...
ms.author: riande
ms.date: 07/30/2013
ms.assetid: 44761193-04ba-4990-9f90-145d3c10a716
msc.legacyurl: /mvc/overview/older-versions/getting-started-with-ef-5-using-mvc-4/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application
msc.type: authoredcontent
ms.openlocfilehash: 20f82744582faddaffdc5b4785bf208ecf0955a7
ms.sourcegitcommit: 45ac74e400f9f2b7dbded66297730f6f14a4eb25
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/16/2018
ms.locfileid: "41836768"
---
<a name="implementing-the-repository-and-unit-of-work-patterns-in-an-aspnet-mvc-application-9-of-10"></a><span data-ttu-id="289a4-103">Implementieren das Repository und Arbeitseinheitsmuster in einer ASP.NET MVC-Anwendung (9 von 10)</span><span class="sxs-lookup"><span data-stu-id="289a4-103">Implementing the Repository and Unit of Work Patterns in an ASP.NET MVC Application (9 of 10)</span></span>
====================
<span data-ttu-id="289a4-104">durch [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="289a4-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="289a4-105">Abgeschlossenes Projekt herunterladen</span><span class="sxs-lookup"><span data-stu-id="289a4-105">Download Completed Project</span></span>](http://code.msdn.microsoft.com/Getting-Started-with-dd0e2ed8)

> <span data-ttu-id="289a4-106">Die Contoso University-Beispielwebanwendung veranschaulicht, wie ASP.NET MVC 4-Anwendungen, die mit dem Entity Framework 5 Code First "und" Visual Studio 2012.</span><span class="sxs-lookup"><span data-stu-id="289a4-106">The Contoso University sample web application demonstrates how to create ASP.NET MVC 4 applications using the Entity Framework 5 Code First and Visual Studio 2012.</span></span> <span data-ttu-id="289a4-107">Informationen zu dieser Tutorialreihe finden Sie im [ersten Tutorial der Reihe](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="289a4-107">For information about the tutorial series, see [the first tutorial in the series](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span> <span data-ttu-id="289a4-108">Sie können die tutorialreihe vom Anfang starten oder [Herunterladen eines Startprojekts für dieses Kapitel](building-the-ef5-mvc4-chapter-downloads.md) und beginnen Sie hier.</span><span class="sxs-lookup"><span data-stu-id="289a4-108">You can start the tutorial series from the beginning or [download a starter project for this chapter](building-the-ef5-mvc4-chapter-downloads.md) and start here.</span></span>
> 
> > [!NOTE] 
> > 
> > <span data-ttu-id="289a4-109">Wenn Sie auf ein Problem Sie nicht lösen stoßen, [herunterladen im Kapitel über das abgeschlossene](building-the-ef5-mvc4-chapter-downloads.md) und versuchen Sie es zum Reproduzieren des Problems an.</span><span class="sxs-lookup"><span data-stu-id="289a4-109">If you run into a problem you can't resolve, [download the completed chapter](building-the-ef5-mvc4-chapter-downloads.md) and try to reproduce your problem.</span></span> <span data-ttu-id="289a4-110">Die Lösung des Problems finden in der Regel durch Ihren Code, den vollständigen Code vergleichen.</span><span class="sxs-lookup"><span data-stu-id="289a4-110">You can generally find the solution to the problem by comparing your code to the completed code.</span></span> <span data-ttu-id="289a4-111">Einige häufige Fehler und zu deren Lösung finden Sie [Fehler und Problemumgehungen.](advanced-entity-framework-scenarios-for-an-mvc-web-application.md#errors)</span><span class="sxs-lookup"><span data-stu-id="289a4-111">For some common errors and how to solve them, see [Errors and Workarounds.](advanced-entity-framework-scenarios-for-an-mvc-web-application.md#errors)</span></span>


<span data-ttu-id="289a4-112">Im vorherigen Tutorial Sie Vererbung verwendet, um die redundanten Code im Verringern der `Student` und `Instructor` Entitätsklassen.</span><span class="sxs-lookup"><span data-stu-id="289a4-112">In the previous tutorial you used inheritance to reduce redundant code in the `Student` and `Instructor` entity classes.</span></span> <span data-ttu-id="289a4-113">In diesem Tutorial sehen Sie einige Möglichkeiten, um das Repository- und arbeitseinheitsmuster arbeitseinheitenmustern für CRUD-Vorgänge verwenden.</span><span class="sxs-lookup"><span data-stu-id="289a4-113">In this tutorial you'll see some ways to use the repository and unit of work patterns for CRUD operations.</span></span> <span data-ttu-id="289a4-114">Wie im vorherigen Tutorial in diesem ändern wie Sie Ihren Code mit Seiten funktioniert Sie bereits erstellt und nicht als neue Seiten erstellen.</span><span class="sxs-lookup"><span data-stu-id="289a4-114">As in the previous tutorial, in this one you'll change the way your code works with pages you already created rather than creating new pages.</span></span>

## <a name="the-repository-and-unit-of-work-patterns"></a><span data-ttu-id="289a4-115">Das Repository und Arbeitseinheitsmuster</span><span class="sxs-lookup"><span data-stu-id="289a4-115">The Repository and Unit of Work Patterns</span></span>

<span data-ttu-id="289a4-116">Die Repository- und arbeitseinheitsmuster Muster sollen eine Abstraktionsebene zwischen der Datenzugriffsebene und den Geschäftslogikebene einer Anwendung erstellen.</span><span class="sxs-lookup"><span data-stu-id="289a4-116">The repository and unit of work patterns are intended to create an abstraction layer between the data access layer and the business logic layer of an application.</span></span> <span data-ttu-id="289a4-117">Die Implementierung dieser Muster unterstützt die Isolation Ihrer Anwendung vor Änderungen im Datenspeicher und kann automatisierte Komponententests oder eine testgesteuerte Entwicklung (Test-Driven Development, TDD) erleichtern.</span><span class="sxs-lookup"><span data-stu-id="289a4-117">Implementing these patterns can help insulate your application from changes in the data store and can facilitate automated unit testing or test-driven development (TDD).</span></span>

<span data-ttu-id="289a4-118">In diesem Tutorial implementieren Sie eine repositoryklasse für jeden Entitätstyp.</span><span class="sxs-lookup"><span data-stu-id="289a4-118">In this tutorial you'll implement a repository class for each entity type.</span></span> <span data-ttu-id="289a4-119">Für die `Student` Entitätstyps, die Sie erstellen eine Repositoryschnittstelle und einer Repository-Klasse.</span><span class="sxs-lookup"><span data-stu-id="289a4-119">For the `Student` entity type you'll create a repository interface and a repository class.</span></span> <span data-ttu-id="289a4-120">Wenn Sie das Repository in Ihre Controller instanziieren, verwenden Sie die Schnittstelle, damit der Controller einen Verweis auf ein Objekt akzeptiert, der die Repositoryschnittstelle implementiert.</span><span class="sxs-lookup"><span data-stu-id="289a4-120">When you instantiate the repository in your controller, you'll use the interface so that the controller will accept a reference to any object that implements the repository interface.</span></span> <span data-ttu-id="289a4-121">Wenn der Controller in einen Webserver ausgeführt wird, erhält sie ein Repository, das mit dem Entity Framework arbeitet.</span><span class="sxs-lookup"><span data-stu-id="289a4-121">When the controller runs under a web server, it receives a repository that works with the Entity Framework.</span></span> <span data-ttu-id="289a4-122">Wenn der Controller unter einer Komponententestklasse ausgeführt wird, erhält sie ein Repository, das mit Daten in einer Weise, die Sie problemlos ändern können, für das Testen, wie z. B. eine in-Memory-Sammlung funktioniert.</span><span class="sxs-lookup"><span data-stu-id="289a4-122">When the controller runs under a unit test class, it receives a repository that works with data stored in a way that you can easily manipulate for testing, such as an in-memory collection.</span></span>

<span data-ttu-id="289a4-123">Später in diesem Tutorial verwenden Sie mehrere Repositorys und eine Einheit der Arbeitsaufgaben-Klasse für den `Course` und `Department` Entitätstypen der `Course` Controller.</span><span class="sxs-lookup"><span data-stu-id="289a4-123">Later in the tutorial you'll use multiple repositories and a unit of work class for the `Course` and `Department` entity types in the `Course` controller.</span></span> <span data-ttu-id="289a4-124">Die Einheit der Arbeit Klasse koordiniert die Arbeit von mehreren Repositorys durch Erstellen einer einzeldatenbank Kontext-Klasse, die von allen gemeinsam verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="289a4-124">The unit of work class coordinates the work of multiple repositories by creating a single database context class shared by all of them.</span></span> <span data-ttu-id="289a4-125">Falls gewünscht, um automatisierte Komponententests durchführen zu können, würden Sie das Erstellen und verwenden Sie Schnittstellen für diese Klassen, auf die gleiche Weise wie für die `Student` Repository.</span><span class="sxs-lookup"><span data-stu-id="289a4-125">If you wanted to be able to perform automated unit testing, you'd create and use interfaces for these classes in the same way you did for the `Student` repository.</span></span> <span data-ttu-id="289a4-126">Sie müssen jedoch zur Vereinfachung des Tutorials erstellen und verwenden Sie diese Klassen ohne Schnittstellen.</span><span class="sxs-lookup"><span data-stu-id="289a4-126">However, to keep the tutorial simple, you'll create and use these classes without interfaces.</span></span>

<span data-ttu-id="289a4-127">Die folgende Abbildung zeigt eine Möglichkeit, die Beziehungen zwischen den Controller und die im Vergleich zu nicht mit dem Repository oder das arbeitseinheitsmuster alle Kontextklassen konzeptualisieren.</span><span class="sxs-lookup"><span data-stu-id="289a4-127">The following illustration shows one way to conceptualize the relationships between the controller and context classes compared to not using the repository or unit of work pattern at all.</span></span>

![Repository_pattern_diagram](https://asp.net/media/2578149/Windows-Live-Writer_8c4963ba1fa3_CE3B_Repository_pattern_diagram_1df790d3-bdf2-4c11-9098-946ddd9cd884.png)

<span data-ttu-id="289a4-129">Sie wird nicht in dieser tutorialreihe Komponententests erstellen.</span><span class="sxs-lookup"><span data-stu-id="289a4-129">You won't create unit tests in this tutorial series.</span></span> <span data-ttu-id="289a4-130">Eine Einführung in die testgesteuerte Entwicklung mit einer MVC-Anwendung, die das Repository-Muster verwendet werden soll, finden Sie unter [Exemplarische Vorgehensweise: Verwenden von TDD mit ASP.NET MVC](https://msdn.microsoft.com/library/ff847525.aspx).</span><span class="sxs-lookup"><span data-stu-id="289a4-130">For an introduction to TDD with an MVC application that uses the repository pattern, see [Walkthrough: Using TDD with ASP.NET MVC](https://msdn.microsoft.com/library/ff847525.aspx).</span></span> <span data-ttu-id="289a4-131">Weitere Informationen über das Repositorymuster finden Sie unter den folgenden Ressourcen:</span><span class="sxs-lookup"><span data-stu-id="289a4-131">For more information about the repository pattern, see the following resources:</span></span>

- <span data-ttu-id="289a4-132">[Das Repositorymuster](https://msdn.microsoft.com/library/ff649690.aspx) auf MSDN.</span><span class="sxs-lookup"><span data-stu-id="289a4-132">[The Repository Pattern](https://msdn.microsoft.com/library/ff649690.aspx) on MSDN.</span></span>
- <span data-ttu-id="289a4-133">[Verwenden Muster für Repository und Arbeitseinheit mit Entity Framework 4.0](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) im Entity Framework-Team-Blog.</span><span class="sxs-lookup"><span data-stu-id="289a4-133">[Using Repository and Unit of Work patterns with Entity Framework 4.0](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) on the Entity Framework team blog.</span></span>
- <span data-ttu-id="289a4-134">[Agile Entity Framework 4-Repository](http://thedatafarm.com/blog/data-access/agile-entity-framework-4-repository-part-1-model-and-poco-classes/) -Serie von Posts auf Julie lermans Blog.</span><span class="sxs-lookup"><span data-stu-id="289a4-134">[Agile Entity Framework 4 Repository](http://thedatafarm.com/blog/data-access/agile-entity-framework-4-repository-part-1-model-and-poco-classes/) series of posts on Julie Lerman's blog.</span></span>
- <span data-ttu-id="289a4-135">[Erstellen das Konto auf einen Blick HTML5/jQuery-Anwendung](https://weblogs.asp.net/dwahlin/archive/2011/08/15/building-the-account-at-a-glance-html5-jquery-application.aspx) wahlin-Blog.</span><span class="sxs-lookup"><span data-stu-id="289a4-135">[Building the Account at a Glance HTML5/jQuery Application](https://weblogs.asp.net/dwahlin/archive/2011/08/15/building-the-account-at-a-glance-html5-jquery-application.aspx) on Dan Wahlin's blog.</span></span>

> [!NOTE]
> <span data-ttu-id="289a4-136">Es gibt viele Möglichkeiten, die Repository- und arbeitseinheitsmuster Muster zu implementieren.</span><span class="sxs-lookup"><span data-stu-id="289a4-136">There are many ways to implement the repository and unit of work patterns.</span></span> <span data-ttu-id="289a4-137">Sie können die Repository-Klassen mit oder ohne eine Einheit der Arbeitsaufgaben-Klasse verwenden.</span><span class="sxs-lookup"><span data-stu-id="289a4-137">You can use repository classes with or without a unit of work class.</span></span> <span data-ttu-id="289a4-138">Sie können ein zentrales Repository für alle Entitätstypen und eine für jeden Typ implementieren.</span><span class="sxs-lookup"><span data-stu-id="289a4-138">You can implement a single repository for all entity types, or one for each type.</span></span> <span data-ttu-id="289a4-139">Wenn Sie eine für jeden Typ implementieren, können Sie separate Klassen eine generische Basisklasse und abgeleitete Klassen oder eine abstrakte Basisklasse und abgeleitete Klassen.</span><span class="sxs-lookup"><span data-stu-id="289a4-139">If you implement one for each type, you can use separate classes, a generic base class and derived classes, or an abstract base class and derived classes.</span></span> <span data-ttu-id="289a4-140">Können Sie Geschäftslogik in Ihrem Repository enthalten oder auf die Logik für den Datenzugriff zu beschränken.</span><span class="sxs-lookup"><span data-stu-id="289a4-140">You can include business logic in your repository or restrict it to data access logic.</span></span> <span data-ttu-id="289a4-141">Sie können auch eine Abstraktionsebene in Ihrem Datenbankkontext-Klasse erstellen, mit [IDbSet](https://msdn.microsoft.com/library/gg679233(v=vs.103).aspx) Schnittstellen es anstelle von ["DbSet"](https://msdn.microsoft.com/library/system.data.entity.dbset(v=vs.103).aspx) -Typen für Ihre Entitätenmengen.</span><span class="sxs-lookup"><span data-stu-id="289a4-141">You can also build an abstraction layer into your database context class by using [IDbSet](https://msdn.microsoft.com/library/gg679233(v=vs.103).aspx) interfaces there instead of [DbSet](https://msdn.microsoft.com/library/system.data.entity.dbset(v=vs.103).aspx) types for your entity sets.</span></span> <span data-ttu-id="289a4-142">Der Ansatz für die Implementierung einer Abstraktionsschicht, die in diesem Tutorial gezeigt ist eine Option für berücksichtigt werden, nicht auf eine Empfehlung für alle Szenarien und Umgebungen.</span><span class="sxs-lookup"><span data-stu-id="289a4-142">The approach to implementing an abstraction layer shown in this tutorial is one option for you to consider, not a recommendation for all scenarios and environments.</span></span>


## <a name="creating-the-student-repository-class"></a><span data-ttu-id="289a4-143">Erstellen der Repository-Klasse "Student"</span><span class="sxs-lookup"><span data-stu-id="289a4-143">Creating the Student Repository Class</span></span>

<span data-ttu-id="289a4-144">In der *DAL* Ordner, erstellen Sie eine Klassendatei mit dem Namen *IStudentRepository.cs* , und Ersetzen Sie den vorhandenen Code durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="289a4-144">In the *DAL* folder, create a class file named *IStudentRepository.cs* and replace the existing code with the following code:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample1.cs)]

<span data-ttu-id="289a4-145">Dieser Code deklariert eine Reihe von CRUD-Methoden, einschließlich der zwei Methoden für das Lesen – eine, die alle zurückgibt `Student` Entitäten und eine, die eine einzelne findet `Student` Entität anhand der ID.</span><span class="sxs-lookup"><span data-stu-id="289a4-145">This code declares a typical set of CRUD methods, including two read methods — one that returns all `Student` entities, and one that finds a single `Student` entity by ID.</span></span>

<span data-ttu-id="289a4-146">In der *DAL* Ordner, erstellen Sie eine Klassendatei mit dem Namen *StudentRepository.cs* Datei.</span><span class="sxs-lookup"><span data-stu-id="289a4-146">In the *DAL* folder, create a class file named *StudentRepository.cs* file.</span></span> <span data-ttu-id="289a4-147">Ersetzen Sie den vorhandenen Code durch den folgenden Code, der implementiert die `IStudentRepository` Schnittstelle:</span><span class="sxs-lookup"><span data-stu-id="289a4-147">Replace the existing code with the following code, which implements the `IStudentRepository` interface:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample2.cs)]

<span data-ttu-id="289a4-148">Der Datenbankkontext in eine Klassenvariable definiert ist, und der Konstruktor erwartet das aufrufende Objekt eine Instanz des Kontext übergeben:</span><span class="sxs-lookup"><span data-stu-id="289a4-148">The database context is defined in a class variable, and the constructor expects the calling object to pass in an instance of the context:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample3.cs)]

<span data-ttu-id="289a4-149">Instanziieren Sie einen neuen Kontext in das Repository, aber wenn Sie über mehrere Repositorys in einem Controller verwendet, jede würde letztendlich mit einem separaten Kontext.</span><span class="sxs-lookup"><span data-stu-id="289a4-149">You could instantiate a new context in the repository, but then if you used multiple repositories in one controller, each would end up with a separate context.</span></span> <span data-ttu-id="289a4-150">Später verwenden Sie mehrere Repositorys in der `Course` Controller, und es erscheint wie eine Einheit der Arbeitsaufgaben-Klasse sicherstellen kann, dass alle Repositorys denselben Kontext verwenden.</span><span class="sxs-lookup"><span data-stu-id="289a4-150">Later you'll use multiple repositories in the `Course` controller, and you'll see how a unit of work class can ensure that all repositories use the same context.</span></span>

<span data-ttu-id="289a4-151">Implementiert das Repository ["IDisposable"](https://msdn.microsoft.com/library/system.idisposable.aspx) im Persistenzspeicher und entfernt Sie den Datenbankkontext aus, wie Sie gesehen, weiter oben in den Controller haben, und die CRUD-Methoden Aufrufe an den Datenbankkontext auf die gleiche Weise, die Sie zuvor gesehen haben.</span><span class="sxs-lookup"><span data-stu-id="289a4-151">The repository implements [IDisposable](https://msdn.microsoft.com/library/system.idisposable.aspx) and disposes the database context as you saw earlier in the controller, and its CRUD methods make calls to the database context in the same way that you saw earlier.</span></span>

## <a name="change-the-student-controller-to-use-the-repository"></a><span data-ttu-id="289a4-152">Ändern des Controllers für Schüler und Studenten, um das Repository zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="289a4-152">Change the Student Controller to Use the Repository</span></span>

<span data-ttu-id="289a4-153">In *StudentController.cs*, ersetzen Sie den Code derzeit in der Klasse durch den folgenden Code.</span><span class="sxs-lookup"><span data-stu-id="289a4-153">In *StudentController.cs*, replace the code currently in the class with the following code.</span></span> <span data-ttu-id="289a4-154">Die Änderungen werden hervorgehoben.</span><span class="sxs-lookup"><span data-stu-id="289a4-154">The changes are highlighted.</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample4.cs?highlight=13-18,44,75,77,102-103,120,137-138,159,172-174,186)]

<span data-ttu-id="289a4-155">Der Controller jetzt deklariert eine Klassenvariable für ein Objekt, implementiert die `IStudentRepository` Schnittstelle anstelle der Context-Klasse:</span><span class="sxs-lookup"><span data-stu-id="289a4-155">The controller now declares a class variable for an object that implements the `IStudentRepository` interface instead of the context class:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample5.cs)]

<span data-ttu-id="289a4-156">Der (parameterlose) Standardkonstruktor erstellt eine neue Kontextinstanz und ein optionale Konstruktor ermöglicht den Aufrufer die Übergabe in einem Context-Instanz.</span><span class="sxs-lookup"><span data-stu-id="289a4-156">The default (parameterless) constructor creates a new context instance, and an optional constructor allows the caller to pass in a context instance.</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample6.cs)]

<span data-ttu-id="289a4-157">(Bei der Verwendung *Abhängigkeitsinjektion*, oder Dependency Injection, wäre nicht der Standard-Konstruktor, da die DI-Software würde beispielsweise sicherstellen, dass die richtigen Repository-Objekt immer gestellt werden.)</span><span class="sxs-lookup"><span data-stu-id="289a4-157">(If you were using *dependency injection*, or DI, you wouldn't need the default constructor because the DI software would ensure that the correct repository object would always be provided.)</span></span>

<span data-ttu-id="289a4-158">In den CRUD-Methoden heißt das Repository jetzt anstelle des Kontexts:</span><span class="sxs-lookup"><span data-stu-id="289a4-158">In the CRUD methods, the repository is now called instead of the context:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample7.cs)]

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample8.cs)]

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample9.cs)]

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample10.cs)]

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample11.cs)]

<span data-ttu-id="289a4-159">Und die `Dispose` Methode entfernt jetzt das Repository anstelle des Kontexts:</span><span class="sxs-lookup"><span data-stu-id="289a4-159">And the `Dispose` method now disposes the repository instead of the context:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample12.cs)]

<span data-ttu-id="289a4-160">Führen Sie die Website, und klicken Sie auf die **Schüler/Studenten** Registerkarte.</span><span class="sxs-lookup"><span data-stu-id="289a4-160">Run the site and click the **Students** tab.</span></span>

![Students_Index_page](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/_static/image1.png)

<span data-ttu-id="289a4-162">Die Seite sieht aus, und es funktioniert genauso wie zuvor, bevor Sie den Code zur Verwendung des Repository geändert, und die anderen Student-Seiten auch funktionieren auf dieselbe Weise.</span><span class="sxs-lookup"><span data-stu-id="289a4-162">The page looks and works the same as it did before you changed the code to use the repository, and the other Student pages also work the same.</span></span> <span data-ttu-id="289a4-163">Es ist jedoch ein wichtiger Unterschied in der die `Index` -Methode des Controllers ist, Filtern und sortieren.</span><span class="sxs-lookup"><span data-stu-id="289a4-163">However, there's an important difference in the way the `Index` method of the controller does filtering and ordering.</span></span> <span data-ttu-id="289a4-164">Die ursprüngliche Version dieser Methode enthält den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="289a4-164">The original version of this method contained the following code:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample13.cs?highlight=1)]

<span data-ttu-id="289a4-165">Die aktualisierte `Index` Methode den folgenden Code enthält:</span><span class="sxs-lookup"><span data-stu-id="289a4-165">The updated `Index` method contains the following code:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample14.cs?highlight=1)]

<span data-ttu-id="289a4-166">Nur der hervorgehobene Code verändert wurde.</span><span class="sxs-lookup"><span data-stu-id="289a4-166">Only the highlighted code has changed.</span></span>

<span data-ttu-id="289a4-167">In der ursprünglichen Version des Codes `students` typisiert ist, als ein `IQueryable` Objekt.</span><span class="sxs-lookup"><span data-stu-id="289a4-167">In the original version of the code, `students` is typed as an `IQueryable` object.</span></span> <span data-ttu-id="289a4-168">Die Abfrage ist nicht an die Datenbank gesendet, bis zur Konvertierung in eine Sammlung mit einer Methode wie z. B. `ToList`, nicht auftreten, bis die Ansicht "Index" das Modell "Student" zugreift.</span><span class="sxs-lookup"><span data-stu-id="289a4-168">The query isn't sent to the database until it's converted into a collection using a method such as `ToList`, which doesn't occur until the Index view accesses the student model.</span></span> <span data-ttu-id="289a4-169">Die `Where` -Methode in den ursprünglichen Code oben wird eine `WHERE` -Klausel in der SQL-Abfrage, die an die Datenbank gesendet wird.</span><span class="sxs-lookup"><span data-stu-id="289a4-169">The `Where` method in the original code above becomes a `WHERE` clause in the SQL query that is sent to the database.</span></span> <span data-ttu-id="289a4-170">Das bedeutet wiederum, dass nur die ausgewählten Entitäten von der Datenbank zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="289a4-170">That in turn means that only the selected entities are returned by the database.</span></span> <span data-ttu-id="289a4-171">Allerdings Folge der Änderung `context.Students` zu `studentRepository.GetStudents()`, `students` Variable aus, nachdem Sie diese Anweisung ist ein `IEnumerable` -Auflistung, die alle Schüler/Studenten in der Datenbank enthält.</span><span class="sxs-lookup"><span data-stu-id="289a4-171">However, as a result of changing `context.Students` to `studentRepository.GetStudents()`, the `students` variable after this statement is an `IEnumerable` collection that includes all students in the database.</span></span> <span data-ttu-id="289a4-172">Das Ergebnis des Anwendens der `Where` Methode ist identisch, aber jetzt die Arbeit im Arbeitsspeicher auf dem Webserver und nicht von der Datenbank erfolgt.</span><span class="sxs-lookup"><span data-stu-id="289a4-172">The end result of applying the `Where` method is the same, but now the work is done in memory on the web server and not by the database.</span></span> <span data-ttu-id="289a4-173">Dies kann bei Abfragen, die große Mengen an Daten zurückgeben, ineffizient sein.</span><span class="sxs-lookup"><span data-stu-id="289a4-173">For queries that return large volumes of data, this can be inefficient.</span></span>

> [!TIP]
> 
> <span data-ttu-id="289a4-174">**"IQueryable" im Vergleich zu "IEnumerable"**</span><span class="sxs-lookup"><span data-stu-id="289a4-174">**IQueryable vs. IEnumerable**</span></span>
> 
> <span data-ttu-id="289a4-175">Nachdem Sie das Repository implementiert wie hier gezeigt, auch wenn Sie etwas in Geben Sie die **Suche** Feld der Abfrage an SQL Server gesendet werden alle Zeilen von "Student" zurückgegeben, da Ihre Suchkriterien nicht berücksichtigt:</span><span class="sxs-lookup"><span data-stu-id="289a4-175">After you implement the repository as shown here, even if you enter something in the **Search** box the query sent to SQL Server returns all Student rows because it doesn't include your search criteria:</span></span>
> 
> ![](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/_static/image2.png)
> 
> [!code-sql[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample15.sql)]
> 
> <span data-ttu-id="289a4-176">Diese Abfrage gibt alle Studentendaten für Schüler und, da das Repository die Abfrage ausgeführt, ohne zu wissen, zu den Suchkriterien entsprechen.</span><span class="sxs-lookup"><span data-stu-id="289a4-176">This query returns all of the student data because the repository executed the query without knowing about the search criteria.</span></span> <span data-ttu-id="289a4-177">Der Prozess der Sortierung, Suchkriterien angewendet werden und eine Teilmenge der Daten auswählen, für Paging (in diesem Fall zeigt nur 3 Zeilen) im Arbeitsspeicher erfolgt später, wenn die `ToPagedList` Methode wird aufgerufen, auf die `IEnumerable` Auflistung.</span><span class="sxs-lookup"><span data-stu-id="289a4-177">The process of sorting, applying search criteria, and selecting a subset of the data for paging (showing only 3 rows in this case) is done in memory later when the `ToPagedList` method is called on the `IEnumerable` collection.</span></span>
> 
> <span data-ttu-id="289a4-178">In der vorherigen Version des Codes (bevor Sie das Repository implementiert), die Abfrage ist nicht an die Datenbank gesendet erst nach dem Anwenden der Suchkriterien, wenn `ToPagedList` aufgerufen wird, auf die `IQueryable` Objekt.</span><span class="sxs-lookup"><span data-stu-id="289a4-178">In the previous version of the code (before you implemented the repository), the query is not sent to the database until after you apply the search criteria, when `ToPagedList` is called on the `IQueryable` object.</span></span>
> 
> ![](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/_static/image3.png)
> 
> <span data-ttu-id="289a4-179">Wenn ToPagedList aufgerufen wird, auf eine `IQueryable` Objekt, an SQL Server gesendete Abfrage gibt die Suchzeichenfolge, daher werden nur die Zeilen, die den Suchkriterien entsprechen zurückgegeben und keine Filterung im Arbeitsspeicher ausgeführt werden muss.</span><span class="sxs-lookup"><span data-stu-id="289a4-179">When ToPagedList is called on an `IQueryable` object, the query sent to SQL Server specifies the search string, and as a result only rows that meet the search criteria are returned, and no filtering needs to be done in memory.</span></span>
> 
> [!code-sql[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample16.sql)]
> 
> <span data-ttu-id="289a4-180">(Im folgende Tutorial wird erläutert, wie Abfragen mit SQL Server gesendet zu untersuchen.)</span><span class="sxs-lookup"><span data-stu-id="289a4-180">(The following tutorial explains how to examine queries sent to SQL Server.)</span></span>


<span data-ttu-id="289a4-181">Der folgende Abschnitt veranschaulicht, wie Repository-Methoden implementieren, mit denen Sie angeben, dass diese Arbeit von der Datenbank ausgeführt werden soll.</span><span class="sxs-lookup"><span data-stu-id="289a4-181">The following section shows how to implement repository methods that enable you to specify that this work should be done by the database.</span></span>

<span data-ttu-id="289a4-182">Sie haben nun eine Abstraktionsschicht zwischen dem Controller und der Datenbankkontext Entity Framework erstellt.</span><span class="sxs-lookup"><span data-stu-id="289a4-182">You've now created an abstraction layer between the controller and the Entity Framework database context.</span></span> <span data-ttu-id="289a4-183">Wenn Sie automatisierte Komponententests, die mit dieser Anwendung ausführen möchten, können Sie eine alternative repositoryklasse erstellen, in ein Komponententestprojekt, die implementiert `IStudentRepository` *.*</span><span class="sxs-lookup"><span data-stu-id="289a4-183">If you were going to perform automated unit testing with this application, you could create an alternative repository class in a unit test project that implements `IStudentRepository`*.*</span></span> <span data-ttu-id="289a4-184">Anstelle des Kontexts zum Lesen und Schreiben von Daten, konnte dieser pseudorepository-Klasse Auflistungen im Arbeitsspeicher bearbeiten, um die Controllerfunktionen zu testen.</span><span class="sxs-lookup"><span data-stu-id="289a4-184">Instead of calling the context to read and write data, this mock repository class could manipulate in-memory collections in order to test controller functions.</span></span>

## <a name="implement-a-generic-repository-and-a-unit-of-work-class"></a><span data-ttu-id="289a4-185">Implementieren eines generischen Repositorys und eine Einheit der Arbeitsaufgaben-Klasse</span><span class="sxs-lookup"><span data-stu-id="289a4-185">Implement a Generic Repository and a Unit of Work Class</span></span>

<span data-ttu-id="289a4-186">Erstellen einer repositoryklasse für jeden Entitätstyp in vielen redundanten Code verursachen, und es kann teilweise Updates zu.</span><span class="sxs-lookup"><span data-stu-id="289a4-186">Creating a repository class for each entity type could result in a lot of redundant code, and it could result in partial updates.</span></span> <span data-ttu-id="289a4-187">Nehmen wir beispielsweise an, dass Sie an zwei verschiedene Entitätstypen im Rahmen derselben Transaktion zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="289a4-187">For example, suppose you have to update two different entity types as part of the same transaction.</span></span> <span data-ttu-id="289a4-188">Wenn jeweils eine separate Datenbank Context-Instanz verwendet wird, eine möglicherweise erfolgreich, und die andere schlägt möglicherweise fehl.</span><span class="sxs-lookup"><span data-stu-id="289a4-188">If each uses a separate database context instance, one might succeed and the other might fail.</span></span> <span data-ttu-id="289a4-189">Eine Möglichkeit zum Minimieren der redundanten Codes ist die Verwendung eines generischen Repositorys, und eine Möglichkeit, sicherzustellen, dass alle Repositorys verwenden Sie den Kontext der gleichen Datenbank (und somit alle Updates zu koordinieren) ist eine Einheit der Arbeitsaufgaben-Klasse verwenden.</span><span class="sxs-lookup"><span data-stu-id="289a4-189">One way to minimize redundant code is to use a generic repository, and one way to ensure that all repositories use the same database context (and thus coordinate all updates) is to use a unit of work class.</span></span>

<span data-ttu-id="289a4-190">In diesem Abschnitt des Tutorials erstellen Sie eine `GenericRepository` Klasse und ein `UnitOfWork` Klasse, und verwenden sie in der `Course` Controller für den Zugriff auf die `Department` und `Course` Entitätenmengen.</span><span class="sxs-lookup"><span data-stu-id="289a4-190">In this section of the tutorial, you'll create a `GenericRepository` class and a `UnitOfWork` class, and use them in the `Course` controller to access both the `Department` and the `Course` entity sets.</span></span> <span data-ttu-id="289a4-191">Wie bereits erwähnt, sind nicht zur Vereinfachung dieser Teil des Tutorials Sie Schnittstellen für diese Klassen erstellen.</span><span class="sxs-lookup"><span data-stu-id="289a4-191">As explained earlier, to keep this part of the tutorial simple, you aren't creating interfaces for these classes.</span></span> <span data-ttu-id="289a4-192">Aber wenn Sie diese verwenden, um eine testgesteuerte Entwicklung zu vereinfachen möchten, in der Regel implementieren Sie diese mit Schnittstellen die gleiche Weise wie die `Student` Repository.</span><span class="sxs-lookup"><span data-stu-id="289a4-192">But if you were going to use them to facilitate TDD, you'd typically implement them with interfaces the same way you did the `Student` repository.</span></span>

### <a name="create-a-generic-repository"></a><span data-ttu-id="289a4-193">Erstellen eines generischen Repositorys</span><span class="sxs-lookup"><span data-stu-id="289a4-193">Create a Generic Repository</span></span>

<span data-ttu-id="289a4-194">In der *DAL* Ordner erstellen *GenericRepository.cs* , und Ersetzen Sie den vorhandenen Code durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="289a4-194">In the *DAL* folder, create *GenericRepository.cs* and replace the existing code with the following code:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample17.cs)]

<span data-ttu-id="289a4-195">Klassenvariablen deklariert werden, für den Datenbankkontext und für die Entitätenmenge, der für das Repository instanziiert wird:</span><span class="sxs-lookup"><span data-stu-id="289a4-195">Class variables are declared for the database context and for the entity set that the repository is instantiated for:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample18.cs)]

<span data-ttu-id="289a4-196">Der Konstruktor akzeptiert eine datenbankkontextinstanz und initialisiert die Entity-Variable festlegen:</span><span class="sxs-lookup"><span data-stu-id="289a4-196">The constructor accepts a database context instance and initializes the entity set variable:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample19.cs)]

<span data-ttu-id="289a4-197">Die `Get` Methode verwendet eine Lambda-Ausdrücke, den aufrufenden Code an eine filterbedingung und eine Spalte zum Sortieren der Ergebnisse von zuzulassen, und ein Zeichenfolgenparameter lässt den Aufrufer, die eine durch Trennzeichen getrennte Liste der Navigationseigenschaften für eager Loading bereitzustellen:</span><span class="sxs-lookup"><span data-stu-id="289a4-197">The `Get` method uses lambda expressions to allow the calling code to specify a filter condition and a column to order the results by, and a string parameter lets the caller provide a comma-delimited list of navigation properties for eager loading:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample20.cs)]

<span data-ttu-id="289a4-198">Der Code `Expression<Func<TEntity, bool>> filter` bedeutet, dass der Aufrufer erhalten einen Lambda-Ausdruck, der auf der Grundlage der `TEntity` Typ, und dieser Ausdruck gibt einen booleschen Wert zurück.</span><span class="sxs-lookup"><span data-stu-id="289a4-198">The code `Expression<Func<TEntity, bool>> filter` means the caller will provide a lambda expression based on the `TEntity` type, and this expression will return a Boolean value.</span></span> <span data-ttu-id="289a4-199">Z. B., wenn das Repository für instanziiert wird die `Student` Entitätstyp, der Code in der aufrufenden Methode möglicherweise geben `student => student.LastName == "Smith` &quot; für die `filter` Parameter.</span><span class="sxs-lookup"><span data-stu-id="289a4-199">For example, if the repository is instantiated for the `Student` entity type, the code in the calling method might specify `student => student.LastName == "Smith`&quot; for the `filter` parameter.</span></span>

<span data-ttu-id="289a4-200">Der Code `Func<IQueryable<TEntity>, IOrderedQueryable<TEntity>> orderBy` bedeutet auch, dass der Aufrufer wird einen Lambda-Ausdruck bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="289a4-200">The code `Func<IQueryable<TEntity>, IOrderedQueryable<TEntity>> orderBy` also means the caller will provide a lambda expression.</span></span> <span data-ttu-id="289a4-201">Die Eingabe für den Ausdruck in diesem Fall ist jedoch ein `IQueryable` -Objekt für die `TEntity` Typ.</span><span class="sxs-lookup"><span data-stu-id="289a4-201">But in this case, the input to the expression is an `IQueryable` object for the `TEntity` type.</span></span> <span data-ttu-id="289a4-202">Der Ausdruck gibt eine sortierte Version dieses `IQueryable` Objekt.</span><span class="sxs-lookup"><span data-stu-id="289a4-202">The expression will return an ordered version of that `IQueryable` object.</span></span> <span data-ttu-id="289a4-203">Z. B., wenn das Repository für instanziiert wird die `Student` Entitätstyp, der Code in der aufrufenden Methode möglicherweise geben `q => q.OrderBy(s => s.LastName)` für die `orderBy` Parameter.</span><span class="sxs-lookup"><span data-stu-id="289a4-203">For example, if the repository is instantiated for the `Student` entity type, the code in the calling method might specify `q => q.OrderBy(s => s.LastName)` for the `orderBy` parameter.</span></span>

<span data-ttu-id="289a4-204">Der Code in die `Get` -Methode erstellt eine `IQueryable` Objekt aus, und klicken Sie dann den Filterausdruck gilt, sofern vorhanden:</span><span class="sxs-lookup"><span data-stu-id="289a4-204">The code in the `Get` method creates an `IQueryable` object and then applies the filter expression if there is one:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample21.cs)]

<span data-ttu-id="289a4-205">Als Nächstes wird das Eager-Loading-Ausdrücke nach der Analyse der durch Trennzeichen getrennten Liste angewendet:</span><span class="sxs-lookup"><span data-stu-id="289a4-205">Next it applies the eager-loading expressions after parsing the comma-delimited list:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample22.cs)]

<span data-ttu-id="289a4-206">Schließlich gilt es die `orderBy` Ausdruck, sofern vorhanden und gibt die Ergebnisse; andernfalls wird von der Abfrage nicht sortiert die Ergebnisse zurückgegeben:</span><span class="sxs-lookup"><span data-stu-id="289a4-206">Finally, it applies the `orderBy` expression if there is one and returns the results; otherwise it returns the results from the unordered query:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample23.cs)]

<span data-ttu-id="289a4-207">Beim Aufrufen der `Get` -Methode können Sie tun, Filtern und Sortieren auf die `IEnumerable` Auflistung, die von der Methode statt die Parameter für diese Funktionen zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="289a4-207">When you call the `Get` method, you could do filtering and sorting on the `IEnumerable` collection returned by the method instead of providing parameters for these functions.</span></span> <span data-ttu-id="289a4-208">Jedoch werden das Sortieren und Filtern von Arbeitsaufgaben klicken Sie dann im Arbeitsspeicher auf dem Webserver ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="289a4-208">But the sorting and filtering work would then be done in memory on the web server.</span></span> <span data-ttu-id="289a4-209">Verwenden Sie diese Parameter an, stellen Sie sicher, dass die Arbeit von der Datenbank statt auf dem Webserver ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="289a4-209">By using these parameters, you ensure that the work is done by the database rather than the web server.</span></span> <span data-ttu-id="289a4-210">Alternativ kann zum Erstellen von abgeleiteten Klassen für bestimmten Entitätstypen und Hinzufügen von speziellen `Get` Methoden, wie z. B. `GetStudentsInNameOrder` oder `GetStudentsByName`.</span><span class="sxs-lookup"><span data-stu-id="289a4-210">An alternative is to create derived classes for specific entity types and add specialized `Get` methods, such as `GetStudentsInNameOrder` or `GetStudentsByName`.</span></span> <span data-ttu-id="289a4-211">Allerdings kann in einer komplexen Anwendung kann dadurch eine große Anzahl solcher abgeleiteten Klassen und spezielle Methoden, die mehr Aufgaben zu verwalten sein könnte.</span><span class="sxs-lookup"><span data-stu-id="289a4-211">However, in a complex application, this can result in a large number of such derived classes and specialized methods, which could be more work to maintain.</span></span>

<span data-ttu-id="289a4-212">Der Code in die `GetByID`, `Insert`, und `Update` Methoden ist ähnlich wie Sie im Repository nicht generische gesehen haben.</span><span class="sxs-lookup"><span data-stu-id="289a4-212">The code in the `GetByID`, `Insert`, and `Update` methods is similar to what you saw in the non-generic repository.</span></span> <span data-ttu-id="289a4-213">(Sie sind nicht bereitstellen, einen Eager Load-Parameter in der `GetByID` Signatur, da Sie eager Loading mit nicht der `Find` Methode.)</span><span class="sxs-lookup"><span data-stu-id="289a4-213">(You aren't providing an eager loading parameter in the `GetByID` signature, because you can't do eager loading with the `Find` method.)</span></span>

<span data-ttu-id="289a4-214">Zwei Überladungen stehen für die `Delete` Methode:</span><span class="sxs-lookup"><span data-stu-id="289a4-214">Two overloads are provided for the `Delete` method:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample24.cs)]

<span data-ttu-id="289a4-215">Eine der folgenden können Sie übergeben, nur die ID der Entität gelöscht werden soll, und eine Instanz einer Entität verwendet.</span><span class="sxs-lookup"><span data-stu-id="289a4-215">One of these lets you pass in just the ID of the entity to be deleted, and one takes an entity instance.</span></span> <span data-ttu-id="289a4-216">Wie in der [Behandeln von Parallelität](../../getting-started/getting-started-with-ef-using-mvc/handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application.md) Tutorial, das für Parallelität, die Sie behandeln muss eine `Delete` -Methode, die eine Instanz einer Entität, die akzeptiert umfasst den ursprünglichen Wert einer Eigenschaft für die nachverfolgung.</span><span class="sxs-lookup"><span data-stu-id="289a4-216">As you saw in the [Handling Concurrency](../../getting-started/getting-started-with-ef-using-mvc/handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application.md) tutorial, for concurrency handling you need a `Delete` method that takes an entity instance that includes the original value of a tracking property.</span></span>

<span data-ttu-id="289a4-217">Diese generischen Repositorys werden typische CRUD-Anforderungen verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="289a4-217">This generic repository will handle typical CRUD requirements.</span></span> <span data-ttu-id="289a4-218">Wenn ein bestimmten Entitätstyp besondere Voraussetzungen, z. B. eine komplexere Filterung oder Sortierung, hat können Sie eine abgeleitete Klasse erstellen, die über zusätzliche Methoden für diesen Typ verfügt.</span><span class="sxs-lookup"><span data-stu-id="289a4-218">When a particular entity type has special requirements, such as more complex filtering or ordering, you can create a derived class that has additional methods for that type.</span></span>

## <a name="creating-the-unit-of-work-class"></a><span data-ttu-id="289a4-219">Erstellen der Komponententestprojekte von Arbeit-Klasse</span><span class="sxs-lookup"><span data-stu-id="289a4-219">Creating the Unit of Work Class</span></span>

<span data-ttu-id="289a4-220">Die Einheit der Arbeitsaufgaben-Klasse dient einem Zweck: um sicherzustellen, dass bei der Verwendung von mehreren Repositorys, teilen sie einen einzeldatenbank-Kontext.</span><span class="sxs-lookup"><span data-stu-id="289a4-220">The unit of work class serves one purpose: to make sure that when you use multiple repositories, they share a single database context.</span></span> <span data-ttu-id="289a4-221">Wenn eine Arbeitseinheit abgeschlossen ist. auf diese Weise können Sie Aufrufen der `SaveChanges` Methode für diese Instanz des Kontexts und sicher sein, dass alle zugehörigen Änderungen koordiniert werden.</span><span class="sxs-lookup"><span data-stu-id="289a4-221">That way, when a unit of work is complete you can call the `SaveChanges` method on that instance of the context and be assured that all related changes will be coordinated.</span></span> <span data-ttu-id="289a4-222">Alle, die Anforderungen für die Klasse ist eine `Save` -Methode und eine Eigenschaft für jedes Repository.</span><span class="sxs-lookup"><span data-stu-id="289a4-222">All that the class needs is a `Save` method and a property for each repository.</span></span> <span data-ttu-id="289a4-223">Jedes Repository-Eigenschaft gibt eine Repository-Instanz, die mit der gleichen Kontextinstanz für die Datenbank als die anderen Repository-Instanzen instanziiert wurde.</span><span class="sxs-lookup"><span data-stu-id="289a4-223">Each repository property returns a repository instance that has been instantiated using the same database context instance as the other repository instances.</span></span>

<span data-ttu-id="289a4-224">In der *DAL* Ordner, erstellen Sie eine Klassendatei mit dem Namen *UnitOfWork.cs* , und Ersetzen Sie den Vorlagencode durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="289a4-224">In the *DAL* folder, create a class file named *UnitOfWork.cs* and replace the template code with the following code:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample25.cs)]

<span data-ttu-id="289a4-225">Der Code erstellt die Klassenvariablen für den Datenbankkontext und jedes Repository.</span><span class="sxs-lookup"><span data-stu-id="289a4-225">The code creates class variables for the database context and each repository.</span></span> <span data-ttu-id="289a4-226">Für die `context` Variable, ein neuer Kontext instanziiert wird:</span><span class="sxs-lookup"><span data-stu-id="289a4-226">For the `context` variable, a new context is instantiated:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample26.cs)]

<span data-ttu-id="289a4-227">Jedes Repository-Eigenschaft überprüft, ob das Repository bereits vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="289a4-227">Each repository property checks whether the repository already exists.</span></span> <span data-ttu-id="289a4-228">Wenn dies nicht der Fall ist, wird er instanziiert das Repository, in der Context-Instanz übergeben.</span><span class="sxs-lookup"><span data-stu-id="289a4-228">If not, it instantiates the repository, passing in the context instance.</span></span> <span data-ttu-id="289a4-229">Alle Repositorys wird daher die gleichen Kontextinstanz freigeben.</span><span class="sxs-lookup"><span data-stu-id="289a4-229">As a result, all repositories share the same context instance.</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample27.cs)]

<span data-ttu-id="289a4-230">Die `Save` Methodenaufrufe `SaveChanges` im Datenbankkontext.</span><span class="sxs-lookup"><span data-stu-id="289a4-230">The `Save` method calls `SaveChanges` on the database context.</span></span>

<span data-ttu-id="289a4-231">Wie alle Klassen, die einen Datenbankkontext in eine Klassenvariable, instanziiert die `UnitOfWork` -Klasse implementiert `IDisposable` und gibt den Kontext frei.</span><span class="sxs-lookup"><span data-stu-id="289a4-231">Like any class that instantiates a database context in a class variable, the `UnitOfWork` class implements `IDisposable` and disposes the context.</span></span>

### <a name="changing-the-course-controller-to-use-the-unitofwork-class-and-repositories"></a><span data-ttu-id="289a4-232">Ändern den Kurs-Controller, um die UnitOfWork-Klasse und die Repositorys verwenden</span><span class="sxs-lookup"><span data-stu-id="289a4-232">Changing the Course Controller to use the UnitOfWork Class and Repositories</span></span>

<span data-ttu-id="289a4-233">Ersetzen Sie den Code, der Sie augenblicklich *CourseController.cs* durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="289a4-233">Replace the code you currently have in *CourseController.cs* with the following code:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample28.cs?highlight=15,20,22,31,54-55,70,85-86,101-102,122-124,130)]

<span data-ttu-id="289a4-234">Dieser Code Fügt eine Klassenvariable für den `UnitOfWork` Klasse.</span><span class="sxs-lookup"><span data-stu-id="289a4-234">This code adds a class variable for the `UnitOfWork` class.</span></span> <span data-ttu-id="289a4-235">(Wenn Sie Schnittstellen hier verwendet haben, wäre nicht, initialisieren Sie die Variable hier; stattdessen, implementieren Sie ein Muster von zwei Konstruktoren verwenden wie für die `Student` Repository.)</span><span class="sxs-lookup"><span data-stu-id="289a4-235">(If you were using interfaces here, you wouldn't initialize the variable here; instead, you'd implement a pattern of two constructors just as you did for the `Student` repository.)</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample29.cs)]

<span data-ttu-id="289a4-236">In der Rest der Klasse werden alle Verweise auf den Datenbankkontext mit dem Verweis auf das entsprechende Repository ersetzt mit `UnitOfWork` Eigenschaften, die Zugriff auf das Repository.</span><span class="sxs-lookup"><span data-stu-id="289a4-236">In the rest of the class, all references to the database context are replaced by references to the appropriate repository, using `UnitOfWork` properties to access the repository.</span></span> <span data-ttu-id="289a4-237">Die `Dispose` -Methode verwirft die `UnitOfWork` Instanz.</span><span class="sxs-lookup"><span data-stu-id="289a4-237">The `Dispose` method disposes the `UnitOfWork` instance.</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample30.cs)]

<span data-ttu-id="289a4-238">Führen Sie die Website, und klicken Sie auf die **Kurse** Registerkarte.</span><span class="sxs-lookup"><span data-stu-id="289a4-238">Run the site and click the **Courses** tab.</span></span>

![Courses_Index_page](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/_static/image4.png)

<span data-ttu-id="289a4-240">Die Seite sieht aus, und es funktioniert genauso wie Ihre Änderungen gewohnt, und die andere Kursseiten auch funktionieren auf dieselbe Weise.</span><span class="sxs-lookup"><span data-stu-id="289a4-240">The page looks and works the same as it did before your changes, and the other Course pages also work the same.</span></span>

## <a name="summary"></a><span data-ttu-id="289a4-241">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="289a4-241">Summary</span></span>

<span data-ttu-id="289a4-242">Sie haben nun das Repository und die arbeitseinheitsmuster implementiert.</span><span class="sxs-lookup"><span data-stu-id="289a4-242">You have now implemented both the repository and unit of work patterns.</span></span> <span data-ttu-id="289a4-243">Sie haben die Lambda-Ausdrücke als Parameter der Methode in der generischen Repositorys verwendet.</span><span class="sxs-lookup"><span data-stu-id="289a4-243">You have used lambda expressions as method parameters in the generic repository.</span></span> <span data-ttu-id="289a4-244">Weitere Informationen dazu, wie diese Ausdrücke mit einem `IQueryable` Objekt, finden Sie unter [IQueryable(T)-Schnittstelle ("System.Linq")](https://msdn.microsoft.com/library/bb351562.aspx) in der MSDN Library.</span><span class="sxs-lookup"><span data-stu-id="289a4-244">For more information about how to use these expressions with an `IQueryable` object, see [IQueryable(T) Interface (System.Linq)](https://msdn.microsoft.com/library/bb351562.aspx) in the MSDN Library.</span></span> <span data-ttu-id="289a4-245">In den nächsten erweiterte Lernprogramms erfahren Sie, wie einige behandelt Szenarien.</span><span class="sxs-lookup"><span data-stu-id="289a4-245">In the next tutorial you'll learn how to handle some advanced scenarios.</span></span>

<span data-ttu-id="289a4-246">Links zu anderen Ressourcen des Entity Framework finden Sie in der [ASP.NET Data Access Content Map](../../../../whitepapers/aspnet-data-access-content-map.md).</span><span class="sxs-lookup"><span data-stu-id="289a4-246">Links to other Entity Framework resources can be found in the [ASP.NET Data Access Content Map](../../../../whitepapers/aspnet-data-access-content-map.md).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="289a4-247">[Zurück](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application.md)
> [Weiter](advanced-entity-framework-scenarios-for-an-mvc-web-application.md)</span><span class="sxs-lookup"><span data-stu-id="289a4-247">[Previous](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application.md)
[Next](advanced-entity-framework-scenarios-for-an-mvc-web-application.md)</span></span>
